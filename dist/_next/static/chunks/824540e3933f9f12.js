(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,5766,e=>{"use strict";let t,r;var n,i=e.i(71645);let s={data:""},a=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,o=/\/\*[^]*?\*\/|  +/g,l=/\n+/g,u=(e,t)=>{let r="",n="",i="";for(let s in e){let a=e[s];"@"==s[0]?"i"==s[1]?r=s+" "+a+";":n+="f"==s[1]?u(a,s):s+"{"+u(a,"k"==s[1]?"":t)+"}":"object"==typeof a?n+=u(a,t?t.replace(/([^,])+/g,e=>s.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,t=>/&/.test(t)?t.replace(/&/g,e):e?e+" "+t:t)):s):null!=a&&(s=/^--/.test(s)?s:s.replace(/[A-Z]/g,"-$&").toLowerCase(),i+=u.p?u.p(s,a):s+":"+a+";")}return r+(t&&i?t+"{"+i+"}":i)+n},h={},c=e=>{if("object"==typeof e){let t="";for(let r in e)t+=r+c(e[r]);return t}return e};function d(e){let t,r,n=this||{},i=e.call?e(n.p):e;return((e,t,r,n,i)=>{var s;let d=c(e),f=h[d]||(h[d]=(e=>{let t=0,r=11;for(;t<e.length;)r=101*r+e.charCodeAt(t++)>>>0;return"go"+r})(d));if(!h[f]){let t=d!==e?e:(e=>{let t,r,n=[{}];for(;t=a.exec(e.replace(o,""));)t[4]?n.shift():t[3]?(r=t[3].replace(l," ").trim(),n.unshift(n[0][r]=n[0][r]||{})):n[0][t[1]]=t[2].replace(l," ").trim();return n[0]})(e);h[f]=u(i?{["@keyframes "+f]:t}:t,r?"":"."+f)}let p=r&&h.g?h.g:null;return r&&(h.g=h[f]),s=h[f],p?t.data=t.data.replace(p,s):-1===t.data.indexOf(s)&&(t.data=n?s+t.data:t.data+s),f})(i.unshift?i.raw?(t=[].slice.call(arguments,1),r=n.p,i.reduce((e,n,i)=>{let s=t[i];if(s&&s.call){let e=s(r),t=e&&e.props&&e.props.className||/^go/.test(e)&&e;s=t?"."+t:e&&"object"==typeof e?e.props?"":u(e,""):!1===e?"":e}return e+n+(null==s?"":s)},"")):i.reduce((e,t)=>Object.assign(e,t&&t.call?t(n.p):t),{}):i,(e=>{if("object"==typeof window){let t=(e?e.querySelector("#_goober"):window._goober)||Object.assign(document.createElement("style"),{innerHTML:" ",id:"_goober"});return t.nonce=window.__nonce__,t.parentNode||(e||document.head).appendChild(t),t.firstChild}return e||s})(n.target),n.g,n.o,n.k)}d.bind({g:1});let f,p,g,m=d.bind({k:1});function y(e,t){let r=this||{};return function(){let n=arguments;function i(s,a){let o=Object.assign({},s),l=o.className||i.className;r.p=Object.assign({theme:p&&p()},o),r.o=/ *go\d+/.test(l),o.className=d.apply(r,n)+(l?" "+l:""),t&&(o.ref=a);let u=e;return e[0]&&(u=o.as||e,delete o.as),g&&u[0]&&g(o),f(u,o)}return t?t(i):i}}var w=(e,t)=>"function"==typeof e?e(t):e,v=(t=0,()=>(++t).toString()),b=()=>{if(void 0===r&&"u">typeof window){let e=matchMedia("(prefers-reduced-motion: reduce)");r=!e||e.matches}return r},_="default",I=(e,t)=>{let{toastLimit:r}=e.settings;switch(t.type){case 0:return{...e,toasts:[t.toast,...e.toasts].slice(0,r)};case 1:return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case 2:let{toast:n}=t;return I(e,{type:+!!e.toasts.find(e=>e.id===n.id),toast:n});case 3:let{toastId:i}=t;return{...e,toasts:e.toasts.map(e=>e.id===i||void 0===i?{...e,dismissed:!0,visible:!1}:e)};case 4:return void 0===t.toastId?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)};case 5:return{...e,pausedAt:t.time};case 6:let s=t.time-(e.pausedAt||0);return{...e,pausedAt:void 0,toasts:e.toasts.map(e=>({...e,pauseDuration:e.pauseDuration+s}))}}},E=[],T={toasts:[],pausedAt:void 0,settings:{toastLimit:20}},S={},C=(e,t=_)=>{S[t]=I(S[t]||T,e),E.forEach(([e,r])=>{e===t&&r(S[t])})},A=e=>Object.keys(S).forEach(t=>C(e,t)),k=(e=_)=>t=>{C(t,e)},x={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},D=(e={},t=_)=>{let[r,n]=(0,i.useState)(S[t]||T),s=(0,i.useRef)(S[t]);(0,i.useEffect)(()=>(s.current!==S[t]&&n(S[t]),E.push([t,n]),()=>{let e=E.findIndex(([e])=>e===t);e>-1&&E.splice(e,1)}),[t]);let a=r.toasts.map(t=>{var r,n,i;return{...e,...e[t.type],...t,removeDelay:t.removeDelay||(null==(r=e[t.type])?void 0:r.removeDelay)||(null==e?void 0:e.removeDelay),duration:t.duration||(null==(n=e[t.type])?void 0:n.duration)||(null==e?void 0:e.duration)||x[t.type],style:{...e.style,...null==(i=e[t.type])?void 0:i.style,...t.style}}});return{...r,toasts:a}},N=e=>(t,r)=>{let n,i=((e,t="blank",r)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:t,ariaProps:{role:"status","aria-live":"polite"},message:e,pauseDuration:0,...r,id:(null==r?void 0:r.id)||v()}))(t,e,r);return k(i.toasterId||(n=i.id,Object.keys(S).find(e=>S[e].toasts.some(e=>e.id===n))))({type:2,toast:i}),i.id},R=(e,t)=>N("blank")(e,t);R.error=N("error"),R.success=N("success"),R.loading=N("loading"),R.custom=N("custom"),R.dismiss=(e,t)=>{let r={type:3,toastId:e};t?k(t)(r):A(r)},R.dismissAll=e=>R.dismiss(void 0,e),R.remove=(e,t)=>{let r={type:4,toastId:e};t?k(t)(r):A(r)},R.removeAll=e=>R.remove(void 0,e),R.promise=(e,t,r)=>{let n=R.loading(t.loading,{...r,...null==r?void 0:r.loading});return"function"==typeof e&&(e=e()),e.then(e=>{let i=t.success?w(t.success,e):void 0;return i?R.success(i,{id:n,...r,...null==r?void 0:r.success}):R.dismiss(n),e}).catch(e=>{let i=t.error?w(t.error,e):void 0;i?R.error(i,{id:n,...r,...null==r?void 0:r.error}):R.dismiss(n)}),e};var O=1e3,P=(e,t="default")=>{let{toasts:r,pausedAt:n}=D(e,t),s=(0,i.useRef)(new Map).current,a=(0,i.useCallback)((e,t=O)=>{if(s.has(e))return;let r=setTimeout(()=>{s.delete(e),o({type:4,toastId:e})},t);s.set(e,r)},[]);(0,i.useEffect)(()=>{if(n)return;let e=Date.now(),i=r.map(r=>{if(r.duration===1/0)return;let n=(r.duration||0)+r.pauseDuration-(e-r.createdAt);if(n<0){r.visible&&R.dismiss(r.id);return}return setTimeout(()=>R.dismiss(r.id,t),n)});return()=>{i.forEach(e=>e&&clearTimeout(e))}},[r,n,t]);let o=(0,i.useCallback)(k(t),[t]),l=(0,i.useCallback)(()=>{o({type:5,time:Date.now()})},[o]),u=(0,i.useCallback)((e,t)=>{o({type:1,toast:{id:e,height:t}})},[o]),h=(0,i.useCallback)(()=>{n&&o({type:6,time:Date.now()})},[n,o]),c=(0,i.useCallback)((e,t)=>{let{reverseOrder:n=!1,gutter:i=8,defaultPosition:s}=t||{},a=r.filter(t=>(t.position||s)===(e.position||s)&&t.height),o=a.findIndex(t=>t.id===e.id),l=a.filter((e,t)=>t<o&&e.visible).length;return a.filter(e=>e.visible).slice(...n?[l+1]:[0,l]).reduce((e,t)=>e+(t.height||0)+i,0)},[r]);return(0,i.useEffect)(()=>{r.forEach(e=>{if(e.dismissed)a(e.id,e.removeDelay);else{let t=s.get(e.id);t&&(clearTimeout(t),s.delete(e.id))}})},[r,a]),{toasts:r,handlers:{updateHeight:u,startPause:l,endPause:h,calculateOffset:c}}},L=m`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,M=m`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,F=m`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,V=y("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${e=>e.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${L} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${M} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${e=>e.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${F} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,U=m`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,B=y("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${e=>e.secondary||"#e0e0e0"};
  border-right-color: ${e=>e.primary||"#616161"};
  animation: ${U} 1s linear infinite;
`,q=m`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,j=m`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,$=y("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${e=>e.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${q} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${j} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${e=>e.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,z=y("div")`
  position: absolute;
`,K=y("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,G=m`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,H=y("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${G} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,W=({toast:e})=>{let{icon:t,type:r,iconTheme:n}=e;return void 0!==t?"string"==typeof t?i.createElement(H,null,t):t:"blank"===r?null:i.createElement(K,null,i.createElement(B,{...n}),"loading"!==r&&i.createElement(z,null,"error"===r?i.createElement(V,{...n}):i.createElement($,{...n})))},Q=y("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,J=y("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,Y=i.memo(({toast:e,position:t,style:r,children:n})=>{let s=e.height?((e,t)=>{let r=e.includes("top")?1:-1,[n,i]=b()?["0%{opacity:0;} 100%{opacity:1;}","0%{opacity:1;} 100%{opacity:0;}"]:[`
0% {transform: translate3d(0,${-200*r}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${-150*r}%,-1px) scale(.6); opacity:0;}
`];return{animation:t?`${m(n)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${m(i)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}})(e.position||t||"top-center",e.visible):{opacity:0},a=i.createElement(W,{toast:e}),o=i.createElement(J,{...e.ariaProps},w(e.message,e));return i.createElement(Q,{className:e.className,style:{...s,...r,...e.style}},"function"==typeof n?n({icon:a,message:o}):i.createElement(i.Fragment,null,a,o))});n=i.createElement,u.p=void 0,f=n,p=void 0,g=void 0;var X=({id:e,className:t,style:r,onHeightUpdate:n,children:s})=>{let a=i.useCallback(t=>{if(t){let r=()=>{n(e,t.getBoundingClientRect().height)};r(),new MutationObserver(r).observe(t,{subtree:!0,childList:!0,characterData:!0})}},[e,n]);return i.createElement("div",{ref:a,className:t,style:r},s)},Z=d`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,ee=({reverseOrder:e,position:t="top-center",toastOptions:r,gutter:n,children:s,toasterId:a,containerStyle:o,containerClassName:l})=>{let{toasts:u,handlers:h}=P(r,a);return i.createElement("div",{"data-rht-toaster":a||"",style:{position:"fixed",zIndex:9999,top:16,left:16,right:16,bottom:16,pointerEvents:"none",...o},className:l,onMouseEnter:h.startPause,onMouseLeave:h.endPause},u.map(r=>{let a,o,l=r.position||t,u=h.calculateOffset(r,{reverseOrder:e,gutter:n,defaultPosition:t}),c=(a=l.includes("top"),o=l.includes("center")?{justifyContent:"center"}:l.includes("right")?{justifyContent:"flex-end"}:{},{left:0,right:0,display:"flex",position:"absolute",transition:b()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${u*(a?1:-1)}px)`,...a?{top:0}:{bottom:0},...o});return i.createElement(X,{id:r.id,key:r.id,onHeightUpdate:h.updateHeight,className:r.visible?Z:"",style:c},"custom"===r.type?w(r.message,r):s?s(r):i.createElement(Y,{toast:r,position:l}))}))};e.s(["CheckmarkIcon",()=>$,"ErrorIcon",()=>V,"LoaderIcon",()=>B,"ToastBar",()=>Y,"ToastIcon",()=>W,"Toaster",()=>ee,"default",()=>R,"resolveValue",()=>w,"toast",()=>R,"useToaster",()=>P,"useToasterStore",()=>D],5766)},51718,97427,8070,83877,44435,92953,18357,e=>{"use strict";let t,r,n;var i,s,a,o=e.i(47167);let l=function(e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:((64512&i)==55296&&n+1<e.length&&(64512&e.charCodeAt(n+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128):t[r++]=i>>12|224,t[r++]=i>>6&63|128),t[r++]=63&i|128)}return t},u=function(e){let t=[],r=0,n=0;for(;r<e.length;){let i=e[r++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[r++];t[n++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536;t[n++]=String.fromCharCode(55296+(s>>10)),t[n++]=String.fromCharCode(56320+(1023&s))}else{let s=e[r++],a=e[r++];t[n++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},h={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,h=(3&i)<<4|a>>4,c=(15&a)<<2|l>>6,d=63&l;!o&&(d=64,s||(c=64)),n.push(r[u],r[h],r[c],r[d])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(l(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):u(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let t=0;t<e.length;){let i=r[e.charAt(t++)],s=t<e.length?r[e.charAt(t)]:0,a=++t<e.length?r[e.charAt(t)]:64,o=++t<e.length?r[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new c;let l=i<<2|s>>4;if(n.push(l),64!==a){let e=s<<4&240|a>>2;if(n.push(e),64!==o){let e=a<<6&192|o;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class c extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let d=function(e){let t=l(e);return h.encodeByteArray(t,!0)},f=function(e){return d(e).replace(/\./g,"")},p=function(e){try{return h.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function g(){return"u">typeof self?self:"u">typeof window?window:e.g}let m=()=>{try{return g().__FIREBASE_DEFAULTS__||(()=>{if(void 0===o.default||void 0===o.default.env)return;let e=o.default.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)})()||(()=>{let e;if("u"<typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&p(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},y=e=>m()?.emulatorHosts?.[e],w=e=>{let t=y(e);if(!t)return;let r=t.lastIndexOf(":");if(r<=0||r+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let n=parseInt(t.substring(r+1),10);return"["===t[0]?[t.substring(1,r-1),n]:[t.substring(0,r),n]},v=()=>m()?.config,b=e=>m()?.[`_${e}`];class _{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function I(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function E(e){return(await fetch(e,{credentials:"include"})).ok}function T(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let r=t||"demo-project",n=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s={iss:`https://securetoken.google.com/${r}`,aud:r,iat:n,exp:n+3600,auth_time:n,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...e};return[f(JSON.stringify({alg:"none",type:"JWT"})),f(JSON.stringify(s)),""].join(".")}let S={},C=!1;function A(e,t){if("u"<typeof window||"u"<typeof document||!I(window.location.host)||S[e]===t||S[e]||C)return;function r(e){return`__firebase__banner__${e}`}S[e]=t;let n="__firebase__banner",i=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(S))S[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(n),t=!1,e||((e=document.createElement("div")).setAttribute("id",n),t=!0),{created:t,element:e}),a=r("text"),o=document.getElementById(a)||document.createElement("span"),l=r("learnmore"),u=document.getElementById(l)||document.createElement("a"),h=r("preprendIcon"),c=document.getElementById(h)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e,t=s.element;t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center",u.setAttribute("id",l),u.innerText="Learn more",u.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",u.setAttribute("target","__blank"),u.style.paddingLeft="5px",u.style.textDecoration="underline";let r=((e=document.createElement("span")).style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{let e;C=!0,(e=document.getElementById(n))&&e.remove()},e);c.setAttribute("width","24"),c.setAttribute("id",h),c.setAttribute("height","24"),c.setAttribute("viewBox","0 0 24 24"),c.setAttribute("fill","none"),c.style.marginLeft="-6px",t.append(c,o,u,r),document.body.appendChild(t)}i?(o.innerText="Preview backend disconnected.",c.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(c.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,o.innerText="Preview backend running in this workspace."),o.setAttribute("id",a)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}function k(){return"u">typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function x(){return"u">typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(k())}function D(){let t=m()?.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}function N(){return"u">typeof window||R()}function R(){return"u">typeof WorkerGlobalScope&&"u">typeof self&&self instanceof WorkerGlobalScope}function O(){return"u">typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function P(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function L(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function M(){let e=k();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function F(){return!D()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function V(){return!D()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function U(){try{return"object"==typeof indexedDB}catch(e){return!1}}function B(){return new Promise((e,t)=>{try{let r=!0,n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{r=!1},i.onerror=()=>{t(i.error?.message||"")}}catch(e){t(e)}})}function q(){return!("u"<typeof navigator)&&!!navigator.cookieEnabled}class j extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,j.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,$.prototype.create)}}class ${constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){var r,n;let i=t[0]||{},s=`${this.service}/${e}`,a=this.errors[e],o=a?(r=a,n=i,r.replace(z,(e,t)=>{let r=n[t];return null!=r?String(r):`<${t}?>`})):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new j(s,l,i)}}let z=/\{\$([^}]+)}/g;function K(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function G(e,t){if(e===t)return!0;let r=Object.keys(e),n=Object.keys(t);for(let i of r){if(!n.includes(i))return!1;let r=e[i],s=t[i];if(H(r)&&H(s)){if(!G(r,s))return!1}else if(r!==s)return!1}for(let e of n)if(!r.includes(e))return!1;return!0}function H(e){return null!==e&&"object"==typeof e}function W(e){let t=[];for(let[r,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function Q(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[r,n]=e.split("=");t[decodeURIComponent(r)]=decodeURIComponent(n)}}),t}function J(e){let t=e.indexOf("?");if(!t)return"";let r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}function Y(e,t){let r=new X(e,t);return r.subscribe.bind(r)}class X{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let n;if(void 0===e&&void 0===t&&void 0===r)throw Error("Missing Observer.");void 0===(n=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let r of t)if(r in e&&"function"==typeof e[r])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:r}:e).next&&(n.next=Z),void 0===n.error&&(n.error=Z),void 0===n.complete&&(n.complete=Z);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}}),this.observers.push(n),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"u">typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Z(){}function ee(e,t=1e3,r=2){let n=t*Math.pow(r,e),i=Math.round(.5*n*(Math.random()-.5)*2);return Math.min(144e5,n+i)}function et(e){return e&&e._delegate?e._delegate:e}e.s(["Deferred",()=>_,"ErrorFactory",()=>$,"FirebaseError",()=>j,"areCookiesEnabled",()=>q,"base64Decode",()=>p,"base64urlEncodeWithoutPadding",()=>f,"calculateBackoffMillis",()=>ee,"createMockUserToken",()=>T,"createSubscribe",()=>Y,"deepEqual",()=>G,"extractQuerystring",()=>J,"getDefaultAppConfig",()=>v,"getDefaultEmulatorHost",()=>y,"getDefaultEmulatorHostnameAndPort",()=>w,"getExperimentalSetting",()=>b,"getGlobal",()=>g,"getModularInstance",()=>et,"getUA",()=>k,"isBrowser",()=>N,"isBrowserExtension",()=>P,"isCloudWorkstation",()=>I,"isCloudflareWorker",()=>O,"isEmpty",()=>K,"isIE",()=>M,"isIndexedDBAvailable",()=>U,"isMobileCordova",()=>x,"isReactNative",()=>L,"isSafari",()=>F,"isSafariOrWebkit",()=>V,"isWebWorker",()=>R,"pingServer",()=>E,"querystring",()=>W,"querystringDecode",()=>Q,"updateEmulatorBanner",()=>A,"validateIndexedDBOpenable",()=>B],97427);class er{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let en="[DEFAULT]";class ei{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new _;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&e.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(r)return null;throw e}if(r)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:en})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:r});t.resolve(e)}catch(e){}}}}clearInstance(e=en){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=en){return this.instances.has(e)}getOptions(e=en){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let n=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[e,t]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(e)&&t.resolve(n);return n}onInit(e,t){let r=this.normalizeInstanceIdentifier(t),n=this.onInitCallbacks.get(r)??new Set;n.add(e),this.onInitCallbacks.set(r,n);let i=this.instances.get(r);return i&&e(i,r),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let n of r)try{n(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var r;let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e)===en?void 0:r,options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=en){return this.component?this.component.multipleInstances?e:en:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class es{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new ei(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}e.s(["Component",()=>er,"ComponentContainer",()=>es],8070);let ea=[];(i=a||(a={}))[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT";let eo={debug:a.DEBUG,verbose:a.VERBOSE,info:a.INFO,warn:a.WARN,error:a.ERROR,silent:a.SILENT},el=a.INFO,eu={[a.DEBUG]:"log",[a.VERBOSE]:"log",[a.INFO]:"info",[a.WARN]:"warn",[a.ERROR]:"error"},eh=(e,t,...r)=>{if(t<e.logLevel)return;let n=new Date().toISOString(),i=eu[t];if(i)console[i](`[${n}]  ${e.name}:`,...r);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class ec{constructor(e){this.name=e,this._logLevel=el,this._logHandler=eh,this._userLogHandler=null,ea.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in a))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?eo[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,a.DEBUG,...e),this._logHandler(this,a.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,a.VERBOSE,...e),this._logHandler(this,a.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,a.INFO,...e),this._logHandler(this,a.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,a.WARN,...e),this._logHandler(this,a.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,a.ERROR,...e),this._logHandler(this,a.ERROR,...e)}}function ed(e){ea.forEach(t=>{t.setLogLevel(e)})}function ef(e,t){for(let r of ea){let n=null;t&&t.level&&(n=eo[t.level]),null===e?r.userLogHandler=null:r.userLogHandler=(t,r,...i)=>{let s=i.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");r>=(n??t.logLevel)&&e({level:a[r].toLowerCase(),message:s,args:i,type:t.name})}}}e.s(["LogLevel",()=>a,"Logger",()=>ec,"setLogLevel",()=>ed,"setUserLogHandler",()=>ef],83877);let ep=new WeakMap,eg=new WeakMap,em=new WeakMap,ey=new WeakMap,ew=new WeakMap,ev={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return eg.get(e);if("objectStoreNames"===t)return e.objectStoreNames||em.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return eb(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function eb(e){if(e instanceof IDBRequest){let t;return(t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(eb(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",s)})).then(t=>{t instanceof IDBCursor&&ep.set(t,e)}).catch(()=>{}),ew.set(t,e),t}if(ey.has(e))return ey.get(e);let n=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(e_(this),t),eb(ep.get(this))}:function(...t){return eb(e.apply(e_(this),t))}:function(t,...r){let n=e.call(e_(this),t,...r);return em.set(n,t.sort?t.sort():[t]),eb(n)};return e instanceof IDBTransaction&&function(e){if(eg.has(e))return;let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});eg.set(e,t)}(e),(t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(e,ev):e}(e);return n!==e&&(ey.set(e,n),ew.set(n,e)),n}let e_=e=>ew.get(e);function eI(e,t,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){let a=indexedDB.open(e,t),o=eb(a);return n&&a.addEventListener("upgradeneeded",e=>{n(eb(a.result),e.oldVersion,e.newVersion,eb(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}let eE=["get","getKey","getAll","getAllKeys","count"],eT=["put","add","delete","clear"],eS=new Map;function eC(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(eS.get(t))return eS.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,i=eT.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||eE.includes(r)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),i&&s.done]))[0]};return eS.set(t,s),s}ev={...n=ev,get:(e,t,r)=>eC(e,t)||n.get(e,t,r),has:(e,t)=>!!eC(e,t)||n.has(e,t)},e.s(["openDB",()=>eI],44435);class eA{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{let t;if(t=e.getComponent(),t?.type!=="VERSION")return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let ek="@firebase/app",ex="0.14.8",eD=new ec("@firebase/app"),eN="[DEFAULT]",eR={[ek]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},eO=new Map,eP=new Map,eL=new Map;function eM(e,t){try{e.container.addComponent(t)}catch(r){eD.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function eF(e,t){e.container.addOrOverwriteComponent(t)}function eV(e){let t=e.name;if(eL.has(t))return eD.debug(`There were multiple attempts to register component ${t}.`),!1;for(let r of(eL.set(t,e),eO.values()))eM(r,e);for(let t of eP.values())eM(t,e);return!0}function eU(e,t){let r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function eB(e,t,r=eN){eU(e,t).clearInstance(r)}function eq(e){return void 0!==e.options}function ej(e){return!eq(e)&&("authIdToken"in e||"appCheckToken"in e||"releaseOnDeref"in e||"automaticDataCollectionEnabled"in e)}function e$(e){return null!=e&&void 0!==e.settings}function ez(){eL.clear()}let eK=new $("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class eG{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new er("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw eK.create("app-deleted",{appName:this._name})}}function eH(e,t){let r=p(e.split(".")[1]);null===r?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(r).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(r).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class eW extends eG{constructor(e,t,r,n){const i=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,s={name:r,automaticDataCollectionEnabled:i};void 0!==e.apiKey?super(e,s,n):super(e.options,s,n),this._serverConfig={automaticDataCollectionEnabled:i,...t},this._serverConfig.authIdToken&&eH(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&eH(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"u">typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,e1(ek,ex,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){e0(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw eK.create("server-app-deleted")}}let eQ="12.9.0";function eJ(e,t={}){let r=e;"object"!=typeof t&&(t={name:t});let n={name:eN,automaticDataCollectionEnabled:!0,...t},i=n.name;if("string"!=typeof i||!i)throw eK.create("bad-app-name",{appName:String(i)});if(r||(r=v()),!r)throw eK.create("no-options");let s=eO.get(i);if(s)if(G(r,s.options)&&G(n,s.config))return s;else throw eK.create("duplicate-app",{appName:i});let a=new es(i);for(let e of eL.values())a.addComponent(e);let o=new eG(r,n,a);return eO.set(i,o),o}function eY(e,t={}){let r;if(N()&&!R())throw eK.create("invalid-server-app-environment");let n=t||{};if(e&&(eq(e)?r=e.options:ej(e)?n=e:r=e),void 0===n.automaticDataCollectionEnabled&&(n.automaticDataCollectionEnabled=!0),r||(r=v()),!r)throw eK.create("no-options");let i={...n,...r};if(void 0!==i.releaseOnDeref&&delete i.releaseOnDeref,void 0!==n.releaseOnDeref&&"u"<typeof FinalizationRegistry)throw eK.create("finalization-registry-not-supported",{});let s=""+[...JSON.stringify(i)].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0),a=eP.get(s);if(a)return a.incRefCount(n.releaseOnDeref),a;let o=new es(s);for(let e of eL.values())o.addComponent(e);let l=new eW(r,n,s,o);return eP.set(s,l),l}function eX(e=eN){let t=eO.get(e);if(!t&&e===eN&&v())return eJ();if(!t)throw eK.create("no-app",{appName:e});return t}function eZ(){return Array.from(eO.values())}async function e0(e){let t=!1,r=e.name;eO.has(r)?(t=!0,eO.delete(r)):eP.has(r)&&0>=e.decRefCount()&&(eP.delete(r),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function e1(e,t,r){let n=eR[e]??e;r&&(n+=`-${r}`);let i=n.match(/\s|\//),s=t.match(/\s|\//);if(i||s){let e=[`Unable to register library "${n}" with version "${t}":`];i&&e.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),eD.warn(e.join(" "));return}eV(new er(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}function e2(e,t){if(null!==e&&"function"!=typeof e)throw eK.create("invalid-log-argument");ef(e,t)}function e6(e){ed(e)}let e3="firebase-heartbeat-store",e5=null;function e4(){return e5||(e5=eI("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(e3)}catch(e){console.warn(e)}}}).catch(e=>{throw eK.create("idb-open",{originalErrorMessage:e.message})})),e5}async function e8(e){try{let t=(await e4()).transaction(e3),r=await t.objectStore(e3).get(e9(e));return await t.done,r}catch(e){if(e instanceof j)eD.warn(e.message);else{let t=eK.create("idb-get",{originalErrorMessage:e?.message});eD.warn(t.message)}}}async function e7(e,t){try{let r=(await e4()).transaction(e3,"readwrite"),n=r.objectStore(e3);await n.put(t,e9(e)),await r.done}catch(e){if(e instanceof j)eD.warn(e.message);else{let t=eK.create("idb-set",{originalErrorMessage:e?.message});eD.warn(t.message)}}}function e9(e){return`${e.name}!${e.options.appId}`}class te{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new tr(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=tt();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,r=e[0].date;for(let n=1;n<e.length;n++)e[n].date<r&&(r=e[n].date,t=n);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){eD.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let e=tt(),{heartbeatsToSend:t,unsentEntries:r}=function(e,t=1024){let r=[],n=e.slice();for(let i of e){let e=r.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),tn(r)>t){e.dates.pop();break}}else if(r.push({agent:i.agent,dates:[i.date]}),tn(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}(this._heartbeatsCache.heartbeats),n=f(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}catch(e){return eD.warn(e),""}}}function tt(){return new Date().toISOString().substring(0,10)}class tr{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!U()&&B().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await e8(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return e7(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return e7(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function tn(e){return f(JSON.stringify({version:2,heartbeats:e})).length}function ti(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}eV(new er("platform-logger",e=>new eA(e),"PRIVATE")),eV(new er("heartbeat",e=>new te(e),"PRIVATE")),e1(ek,ex,""),e1(ek,ex,"esm2020"),e1("fire-js",""),e.s(["SDK_VERSION",()=>eQ,"_DEFAULT_ENTRY_NAME",()=>eN,"_addComponent",()=>eM,"_addOrOverwriteComponent",()=>eF,"_apps",()=>eO,"_clearComponents",()=>ez,"_components",()=>eL,"_getProvider",()=>eU,"_isFirebaseApp",()=>eq,"_isFirebaseServerApp",()=>e$,"_isFirebaseServerAppSettings",()=>ej,"_registerComponent",()=>eV,"_removeServiceInstance",()=>eB,"_serverApps",()=>eP,"deleteApp",()=>e0,"getApp",()=>eX,"getApps",()=>eZ,"initializeApp",()=>eJ,"initializeServerApp",()=>eY,"onLog",()=>e2,"registerVersion",()=>e1,"setLogLevel",()=>e6],92953);let ts=new $("auth","Firebase",ti()),ta=new ec("@firebase/auth");function to(e,...t){ta.logLevel<=a.ERROR&&ta.error(`Auth (${eQ}): ${e}`,...t)}function tl(e,...t){throw td(e,...t)}function tu(e,...t){return td(e,...t)}function th(e,t,r){return new $("auth","Firebase",{...ti(),[t]:r}).create(t,{appName:e.name})}function tc(e){return th(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function td(e,...t){if("string"!=typeof e){let r=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(r,...n)}return ts.create(e,...t)}function tf(e,t,...r){if(!e)throw td(t,...r)}function tp(e){let t="INTERNAL ASSERTION FAILED: "+e;throw to(t),Error(t)}function tg(){return"u">typeof self&&self.location?.href||""}function tm(){return"u">typeof self&&self.location?.protocol||null}class ty{constructor(e,t){this.shortDelay=e,this.longDelay=t,function(e,t){e||tp(t)}(t>e,"Short delay should be less than long delay!"),this.isMobile=x()||L()}get(){return!("u">typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===tm()||"https:"===tm()||P()||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function tw(e,t){var r,n;r=e.emulator,n="Emulator should always be set here",r||tp(n);let{url:i}=e.emulator;return t?`${i}${t.startsWith("/")?t.slice(1):t}`:i}class tv{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){return this.fetchImpl?this.fetchImpl:"u">typeof self&&"fetch"in self?self.fetch:"u">typeof globalThis&&globalThis.fetch?globalThis.fetch:"u">typeof fetch?fetch:void tp("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"u">typeof self&&"Headers"in self?self.Headers:"u">typeof globalThis&&globalThis.Headers?globalThis.Headers:"u">typeof Headers?Headers:void tp("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"u">typeof self&&"Response"in self?self.Response:"u">typeof globalThis&&globalThis.Response?globalThis.Response:"u">typeof Response?Response:void tp("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let tb={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},t_=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],tI=new ty(3e4,6e4);function tE(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function tT(e,t,r,n,i={}){return tS(e,i,async()=>{let i={},s={};n&&("GET"===t?s=n:i={body:JSON.stringify(n)});let a=W({key:e.config.apiKey,...s}).slice(1),o=await e._getAdditionalHeaders();o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode);let l={method:t,headers:o,...i};return O()||(l.referrerPolicy="no-referrer"),e.emulatorConfig&&I(e.emulatorConfig.host)&&(l.credentials="include"),tv.fetch()(await tA(e,e.config.apiHost,r,a),l)})}async function tS(e,t,r){e._canInitEmulator=!1;let n={...tb,...t};try{let t=new tk(e),i=await Promise.race([r(),t.promise]);t.clearNetworkTimeout();let s=await i.json();if("needConfirmation"in s)throw tx(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{let[t,r]=(i.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw tx(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw tx(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw tx(e,"user-disabled",s);let a=n[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(r)throw th(e,a,r);tl(e,a)}}catch(t){if(t instanceof j)throw t;tl(e,"network-request-failed",{message:String(t)})}}async function tC(e,t,r,n,i={}){let s=await tT(e,t,r,n,i);return"mfaPendingCredential"in s&&tl(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function tA(e,t,r,n){let i=`${t}${r}?${n}`,s=e.config.emulator?tw(e.config,i):`${e.config.apiScheme}://${i}`;return t_.includes(r)&&(await e._persistenceManagerAvailable,"COOKIE"===e._getPersistenceType())?e._getPersistence()._getFinalTarget(s).toString():s}class tk{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(tu(this.auth,"network-request-failed")),tI.get())})}}function tx(e,t,r){let n={appName:e.name};r.email&&(n.email=r.email),r.phoneNumber&&(n.phoneNumber=r.phoneNumber);let i=tu(e,t,n);return i.customData._tokenResponse=r,i}function tD(e){return void 0!==e&&void 0!==e.enterprise}class tN{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)switch(t.enforcementState){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function tR(e,t){return tT(e,"GET","/v2/recaptchaConfig",tE(e,t))}async function tO(e,t){return tT(e,"POST","/v1/accounts:delete",t)}async function tP(e,t){return tT(e,"POST","/v1/accounts:lookup",t)}function tL(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function tM(e,t=!1){let r=et(e),n=await r.getIdToken(t),i=tV(n);tf(i&&i.exp&&i.auth_time&&i.iat,r.auth,"internal-error");let s="object"==typeof i.firebase?i.firebase:void 0,a=s?.sign_in_provider;return{claims:i,token:n,authTime:tL(tF(i.auth_time)),issuedAtTime:tL(tF(i.iat)),expirationTime:tL(tF(i.exp)),signInProvider:a||null,signInSecondFactor:s?.sign_in_second_factor||null}}function tF(e){return 1e3*Number(e)}function tV(e){let[t,r,n]=e.split(".");if(void 0===t||void 0===r||void 0===n)return to("JWT malformed, contained fewer than 3 sections"),null;try{let e=p(r);if(!e)return to("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return to("Caught error parsing JWT payload as JSON",e?.toString()),null}}function tU(e){let t=tV(e);return tf(t,"internal-error"),tf(void 0!==t.exp,"internal-error"),tf(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function tB(e,t,r=!1){if(r)return t;try{return await t}catch(t){throw t instanceof j&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class tq{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(!e)return this.errorBackoff=3e4,Math.max(0,(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class tj{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=tL(this.lastLoginAt),this.creationTime=tL(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function t$(e){var t,r;let n=e.auth,i=await e.getIdToken(),s=await tB(e,tP(n,{idToken:i}));tf(s?.users.length,n,"internal-error");let a=s.users[0];e._notifyReloadListener(a);let o=a.providerUserInfo?.length?tK(a.providerUserInfo):[],l=(t=e.providerData,r=o,[...t.filter(e=>!r.some(t=>t.providerId===e.providerId)),...r]),u=e.isAnonymous,h=!(e.email&&a.passwordHash)&&!l?.length;Object.assign(e,{uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:l,metadata:new tj(a.createdAt,a.lastLoginAt),isAnonymous:!!u&&h})}async function tz(e){let t=et(e);await t$(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function tK(e){return e.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function tG(e,t){let r=await tS(e,{},async()=>{let r=W({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:i}=e.config,s=await tA(e,n,"/v1/token",`key=${i}`),a=await e._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";let o={method:"POST",headers:a,body:r};return e.emulatorConfig&&I(e.emulatorConfig.host)&&(o.credentials="include"),tv.fetch()(s,o)});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}async function tH(e,t){return tT(e,"POST","/v2/accounts:revokeToken",tE(e,t))}class tW{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){tf(e.idToken,"internal-error"),tf(void 0!==e.idToken,"internal-error"),tf(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):tU(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){tf(0!==e.length,"internal-error");let t=tU(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(tf(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:r,refreshToken:n,expiresIn:i}=await tG(e,t);this.updateTokensAndExpiration(r,n,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*r}static fromJSON(e,t){let{refreshToken:r,accessToken:n,expirationTime:i}=t,s=new tW;return r&&(tf("string"==typeof r,"internal-error",{appName:e}),s.refreshToken=r),n&&(tf("string"==typeof n,"internal-error",{appName:e}),s.accessToken=n),i&&(tf("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new tW,this.toJSON())}_performRefresh(){return tp("not implemented")}}function tQ(e,t){tf("string"==typeof e||void 0===e,"internal-error",{appName:t})}class tJ{constructor({uid:e,auth:t,stsTokenManager:r,...n}){this.providerId="firebase",this.proactiveRefresh=new tq(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=n.displayName||null,this.email=n.email||null,this.emailVerified=n.emailVerified||!1,this.phoneNumber=n.phoneNumber||null,this.photoURL=n.photoURL||null,this.isAnonymous=n.isAnonymous||!1,this.tenantId=n.tenantId||null,this.providerData=n.providerData?[...n.providerData]:[],this.metadata=new tj(n.createdAt||void 0,n.lastLoginAt||void 0)}async getIdToken(e){let t=await tB(this,this.stsTokenManager.getToken(this.auth,e));return tf(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return tM(this,e)}reload(){return tz(this)}_assign(e){this!==e&&(tf(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new tJ({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){tf(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await t$(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(e$(this.auth.app))return Promise.reject(tc(this.auth));let e=await this.getIdToken();return await tB(this,tO(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){let r=t.displayName??void 0,n=t.email??void 0,i=t.phoneNumber??void 0,s=t.photoURL??void 0,a=t.tenantId??void 0,o=t._redirectEventId??void 0,l=t.createdAt??void 0,u=t.lastLoginAt??void 0,{uid:h,emailVerified:c,isAnonymous:d,providerData:f,stsTokenManager:p}=t;tf(h&&p,e,"internal-error");let g=tW.fromJSON(this.name,p);tf("string"==typeof h,e,"internal-error"),tQ(r,e.name),tQ(n,e.name),tf("boolean"==typeof c,e,"internal-error"),tf("boolean"==typeof d,e,"internal-error"),tQ(i,e.name),tQ(s,e.name),tQ(a,e.name),tQ(o,e.name),tQ(l,e.name),tQ(u,e.name);let m=new tJ({uid:h,auth:e,email:n,emailVerified:c,displayName:r,isAnonymous:d,photoURL:s,phoneNumber:i,tenantId:a,stsTokenManager:g,createdAt:l,lastLoginAt:u});return f&&Array.isArray(f)&&(m.providerData=f.map(e=>({...e}))),o&&(m._redirectEventId=o),m}static async _fromIdTokenResponse(e,t,r=!1){let n=new tW;n.updateFromServerResponse(t);let i=new tJ({uid:t.localId,auth:e,stsTokenManager:n,isAnonymous:r});return await t$(i),i}static async _fromGetAccountInfoResponse(e,t,r){let n=t.users[0];tf(void 0!==n.localId,"internal-error");let i=void 0!==n.providerUserInfo?tK(n.providerUserInfo):[],s=!(n.email&&n.passwordHash)&&!i?.length,a=new tW;a.updateFromIdToken(r);let o=new tJ({uid:n.localId,auth:e,stsTokenManager:a,isAnonymous:s});return Object.assign(o,{uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:i,metadata:new tj(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash)&&!i?.length}),o}}let tY=new Map;function tX(e){var t,r;t="Expected a class definition",e instanceof Function||tp(t);let n=tY.get(e);return n?(r="Instance stored in cache mismatched with class",n instanceof e||tp(r)):(n=new e,tY.set(e,n)),n}class tZ{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}function t0(e,t,r){return`firebase:${e}:${t}:${r}`}tZ.type="NONE";class t1{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:n,name:i}=this.auth;this.fullUserKey=t0(this.userKey,n.apiKey,i),this.fullPersistenceKey=t0("persistence",n.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){let t=await tP(this.auth,{idToken:e}).catch(()=>void 0);return t?tJ._fromGetAccountInfoResponse(this.auth,t,e):null}return tJ._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new t1(tX(tZ),e,r);let n=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),i=n[0]||tX(tZ),s=t0(r,e.config.apiKey,e.name),a=null;for(let r of t)try{let t=await r._get(s);if(t){let n;if("string"==typeof t){let r=await tP(e,{idToken:t}).catch(()=>void 0);if(!r)break;n=await tJ._fromGetAccountInfoResponse(e,r,t)}else n=tJ._fromJSON(e,t);r!==i&&(a=n),i=r;break}}catch{}let o=n.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&o.length&&(i=o[0],a&&await i._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch{}}))),new t1(i,e,r)}}function t2(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";{if(t4(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(t6(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(t7(t))return"Blackberry";if(t9(t))return"Webos";if(t3(t))return"Safari";if((t.includes("chrome/")||t5(t))&&!t.includes("edge/"))return"Chrome";if(t8(t))return"Android";let r=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(r?.length===2)return r[1]}return"Other"}function t6(e=k()){return/firefox\//i.test(e)}function t3(e=k()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function t5(e=k()){return/crios\//i.test(e)}function t4(e=k()){return/iemobile/i.test(e)}function t8(e=k()){return/android/i.test(e)}function t7(e=k()){return/blackberry/i.test(e)}function t9(e=k()){return/webos/i.test(e)}function re(e=k()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function rt(e=k()){return re(e)||t8(e)||t9(e)||t7(e)||/windows phone/i.test(e)||t4(e)}function rr(e,t=[]){let r;switch(e){case"Browser":r=t2(k());break;case"Worker":r=`${t2(k())}-${e}`;break;default:r=e}let n=t.length?t.join(","):"FirebaseCore-web";return`${r}/JsCore/${eQ}/${n}`}class rn{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=t=>new Promise((r,n)=>{try{let n=e(t);r(n)}catch(e){n(e)}});r.onAbort=t,this.queue.push(r);let n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:e?.message})}}}async function ri(e,t={}){return tT(e,"GET","/v2/passwordPolicy",tE(e,t))}class rs{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??6,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),void 0!==t.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),void 0!==t.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),void 0!==t.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),void 0!==t.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){let t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),n&&(t.meetsMaxPasswordLength=e.length<=n)}validatePasswordCharacterOptions(e,t){let r;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let n=0;n<e.length;n++)r=e.charAt(n),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,n,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class ra{constructor(e,t,r,n){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ro(this),this.idTokenSubscription=new ro(this),this.beforeStateQueue=new rn(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ts,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=tX(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted){if(this.persistenceManager=await t1.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await tP(this,{idToken:e}),r=await tJ._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(e$(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let t=await this.assertedPersistence.getCurrentUser(),r=t,n=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let t=this.redirectUser?._redirectEventId,i=r?._redirectEventId,s=await this.tryRedirectSignIn(e);(!t||t===i)&&s?.user&&(r=s.user,n=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(n)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return(tf(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId)?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await t$(e)}catch(e){if(e?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("u"<typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(e$(this.app))return Promise.reject(tc(this));let t=e?et(e):null;return t&&tf(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&tf(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return e$(this.app)?Promise.reject(tc(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return e$(this.app)?Promise.reject(tc(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(tX(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new rs(await ri(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new $("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await tH(this,t)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){let r=await this.getOrInitRedirectPersistenceManager(t);return null===e?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&tX(e)||this._popupRedirectResolver;tf(t,this,"argument-error"),this.redirectPersistenceManager=await t1.create(this,[tX(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return(this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e)?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,n){if(this._deleted)return()=>{};let i="function"==typeof t?t:t.next.bind(t),s=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(tf(a,this,"internal-error"),a.then(()=>{s||i(this.currentUser)}),"function"==typeof t){let i=e.addObserver(t,r,n);return()=>{s=!0,i()}}{let r=e.addObserver(t);return()=>{s=!0,r()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return tf(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=rr(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);let r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(e$(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&function(e,...t){ta.logLevel<=a.WARN&&ta.warn(`Auth (${eQ}): ${e}`,...t)}(`Error while retrieving App Check token: ${e.error}`),e?.token}}class ro{constructor(e){this.auth=e,this.observer=null,this.addObserver=Y(e=>this.observer=e)}get next(){return tf(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let rl={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function ru(e){return`__${e}${Math.floor(1e6*Math.random())}`}class rh{constructor(){this.enterprise=new rc}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class rc{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}let rd="NO_RECAPTCHA";class rf{constructor(e){this.type="recaptcha-enterprise",this.auth=function(e){return et(e)}(e)}async verify(e="verify",t=!1){async function r(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,r)=>{tR(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(n=>{if(void 0===n.recaptchaKey)r(Error("recaptcha Enterprise site key undefined"));else{let r=new tN(n);return null==e.tenantId?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,t(r.siteKey)}}).catch(e=>{r(e)})})}function n(t,r,n){let i=window.grecaptcha;tD(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{r(e)}).catch(()=>{r(rd)})}):n(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new rh().execute("siteKey",{action:"verify"}):new Promise((e,i)=>{r(this.auth).then(r=>{if(!t&&tD(window.grecaptcha))n(r,e,i);else{var s;if("u"<typeof window)return void i(Error("RecaptchaVerifier is only supported in browser"));let t=rl.recaptchaEnterpriseScript;0!==t.length&&(t+=r),(s=t,rl.loadJS(s)).then(()=>{n(r,e,i)}).catch(e=>{i(e)})}}).catch(e=>{i(e)})})}}async function rp(e,t,r,n=!1,i=!1){let s,a=new rf(e);if(i)s=rd;else try{s=await a.verify(r)}catch(e){s=await a.verify(r,!0)}let o={...t};if("mfaSmsEnrollment"===r||"mfaSmsSignIn"===r){if("phoneEnrollmentInfo"in o){let e=o.phoneEnrollmentInfo.phoneNumber,t=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){let e=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return n?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function rg(e,t,r,n,i){if("EMAIL_PASSWORD_PROVIDER"===i)if(!e._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return n(e,t).catch(async i=>{if("auth/missing-recaptcha-token"!==i.code)return Promise.reject(i);{console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let i=await rp(e,t,r,"getOobCode"===r);return n(e,i)}});else{let i=await rp(e,t,r,"getOobCode"===r);return n(e,i)}if("PHONE_PROVIDER"!==i)return Promise.reject(i+" provider is not supported.");if(e._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){let i=await rp(e,t,r);return n(e,i).catch(async i=>{if(e._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&("auth/missing-recaptcha-token"===i.code||"auth/invalid-app-credential"===i.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${r} flow.`);let i=await rp(e,t,r,!1,!0);return n(e,i)}return Promise.reject(i)})}{let i=await rp(e,t,r,!1,!0);return n(e,i)}}async function rm(e){let t=et(e),r=new tN(await tR(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}));null==t.tenantId?t._agentRecaptchaConfig=r:t._tenantRecaptchaConfigs[t.tenantId]=r,r.isAnyProviderEnabled()&&new rf(t).verify()}function ry(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function rw(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}class rv{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return tp("not implemented")}_getIdTokenResponse(e){return tp("not implemented")}_linkToIdToken(e,t){return tp("not implemented")}_getReauthenticationResolver(e){return tp("not implemented")}}async function rb(e,t){return tT(e,"POST","/v1/accounts:signUp",t)}async function r_(e,t){return tC(e,"POST","/v1/accounts:signInWithPassword",tE(e,t))}async function rI(e,t){return tC(e,"POST","/v1/accounts:signInWithEmailLink",tE(e,t))}async function rE(e,t){return tC(e,"POST","/v1/accounts:signInWithEmailLink",tE(e,t))}class rT extends rv{constructor(e,t,r,n=null){super("password",r),this._email=e,this._password=t,this._tenantId=n}static _fromEmailAndPassword(e,t){return new rT(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new rT(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);else if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return rg(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",r_,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return rI(e,{email:this._email,oobCode:this._password});default:tl(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return rg(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",rb,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return rE(e,{idToken:t,email:this._email,oobCode:this._password});default:tl(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function rS(e,t){return tC(e,"POST","/v1/accounts:signInWithIdp",tE(e,t))}class rC extends rv{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new rC(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):tl("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let{providerId:t,signInMethod:r,...n}="string"==typeof e?JSON.parse(e):e;if(!t||!r)return null;let i=new rC(t,r);return i.idToken=n.idToken||void 0,i.accessToken=n.accessToken||void 0,i.secret=n.secret,i.nonce=n.nonce,i.pendingToken=n.pendingToken||null,i}_getIdTokenResponse(e){return rS(e,this.buildRequest())}_linkToIdToken(e,t){let r=this.buildRequest();return r.idToken=t,rS(e,r)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,rS(e,t)}buildRequest(){let e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=W(t)}return e}}async function rA(e,t){return tT(e,"POST","/v1/accounts:sendVerificationCode",tE(e,t))}async function rk(e,t){return tC(e,"POST","/v1/accounts:signInWithPhoneNumber",tE(e,t))}async function rx(e,t){let r=await tC(e,"POST","/v1/accounts:signInWithPhoneNumber",tE(e,t));if(r.temporaryProof)throw tx(e,"account-exists-with-different-credential",r);return r}let rD={USER_NOT_FOUND:"user-not-found"};async function rN(e,t){return tC(e,"POST","/v1/accounts:signInWithPhoneNumber",tE(e,{...t,operation:"REAUTH"}),rD)}class rR extends rv{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new rR({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new rR({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return rk(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return rx(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return rN(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:n}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:n}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:i}=e;return r||t||n||i?new rR({verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:i}):null}}class rO{constructor(e){const t=Q(J(e)),r=t.apiKey??null,n=t.oobCode??null,i=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(t.mode??null);tf(r&&n&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=n,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){let t,r,n,i=(r=(t=Q(J(e)).link)?Q(J(t)).deep_link_id:null,((n=Q(J(e)).deep_link_id)?Q(J(n)).link:null)||n||r||t||e);try{return new rO(i)}catch{return null}}}class rP{constructor(){this.providerId=rP.PROVIDER_ID}static credential(e,t){return rT._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let r=rO.parseLink(t);return tf(r,"argument-error"),rT._fromEmailAndCode(e,r.code,r.tenantId)}}rP.PROVIDER_ID="password",rP.EMAIL_PASSWORD_SIGN_IN_METHOD="password",rP.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class rL{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class rM extends rL{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class rF extends rM{constructor(){super("facebook.com")}static credential(e){return rC._fromParams({providerId:rF.PROVIDER_ID,signInMethod:rF.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return rF.credentialFromTaggedObject(e)}static credentialFromError(e){return rF.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return rF.credential(e.oauthAccessToken)}catch{return null}}}rF.FACEBOOK_SIGN_IN_METHOD="facebook.com",rF.PROVIDER_ID="facebook.com";class rV extends rM{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return rC._fromParams({providerId:rV.PROVIDER_ID,signInMethod:rV.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return rV.credentialFromTaggedObject(e)}static credentialFromError(e){return rV.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return rV.credential(t,r)}catch{return null}}}rV.GOOGLE_SIGN_IN_METHOD="google.com",rV.PROVIDER_ID="google.com";class rU extends rM{constructor(){super("github.com")}static credential(e){return rC._fromParams({providerId:rU.PROVIDER_ID,signInMethod:rU.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return rU.credentialFromTaggedObject(e)}static credentialFromError(e){return rU.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return rU.credential(e.oauthAccessToken)}catch{return null}}}rU.GITHUB_SIGN_IN_METHOD="github.com",rU.PROVIDER_ID="github.com";class rB extends rM{constructor(){super("twitter.com")}static credential(e,t){return rC._fromParams({providerId:rB.PROVIDER_ID,signInMethod:rB.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return rB.credentialFromTaggedObject(e)}static credentialFromError(e){return rB.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return rB.credential(t,r)}catch{return null}}}async function rq(e,t){return tC(e,"POST","/v1/accounts:signUp",tE(e,t))}rB.TWITTER_SIGN_IN_METHOD="twitter.com",rB.PROVIDER_ID="twitter.com";class rj{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,n=!1){return new rj({user:await tJ._fromIdTokenResponse(e,r,n),providerId:r$(r),_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){return await e._updateTokensIfNecessary(r,!0),new rj({user:e,providerId:r$(r),_tokenResponse:r,operationType:t})}}function r$(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class rz extends j{constructor(e,t,r,n){super(t.code,t.message),this.operationType=r,this.user=n,Object.setPrototypeOf(this,rz.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,n){return new rz(e,t,r,n)}}function rK(e,t,r,n){return("reauthenticate"===t?r._getReauthenticationResolver(e):r._getIdTokenResponse(e)).catch(r=>{if("auth/multi-factor-auth-required"===r.code)throw rz._fromErrorAndOperation(e,r,t,n);throw r})}async function rG(e,t,r=!1){let n=await tB(e,t._linkToIdToken(e.auth,await e.getIdToken()),r);return rj._forOperation(e,"link",n)}async function rH(e,t,r=!1){let{auth:n}=e;if(e$(n.app))return Promise.reject(tc(n));let i="reauthenticate";try{let s=await tB(e,rK(n,i,t,e),r);tf(s.idToken,n,"internal-error");let a=tV(s.idToken);tf(a,n,"internal-error");let{sub:o}=a;return tf(e.uid===o,n,"user-mismatch"),rj._forOperation(e,i,s)}catch(e){throw e?.code==="auth/user-not-found"&&tl(n,"user-mismatch"),e}}async function rW(e,t,r=!1){if(e$(e.app))return Promise.reject(tc(e));let n="signIn",i=await rK(e,n,t),s=await rj._fromIdTokenResponse(e,n,i);return r||await e._updateCurrentUser(s.user),s}async function rQ(e,t){return rW(et(e),t)}class rJ{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?rY._fromServerResponse(e,t):"totpInfo"in t?rX._fromServerResponse(e,t):tl(e,"internal-error")}}class rY extends rJ{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new rY(t)}}class rX extends rJ{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new rX(t)}}async function rZ(e){let t=et(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function r0(e,t,r){if(e$(e.app))return Promise.reject(tc(e));let n=et(e),i=rg(n,{returnSecureToken:!0,email:t,password:r,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",rq,"EMAIL_PASSWORD_PROVIDER"),s=await i.catch(t=>{throw"auth/password-does-not-meet-requirements"===t.code&&rZ(e),t}),a=await rj._fromIdTokenResponse(n,"signIn",s);return await n._updateCurrentUser(a.user),a}function r1(e,t,r){return e$(e.app)?Promise.reject(tc(e)):rQ(et(e),rP.credential(t,r)).catch(async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&rZ(e),t})}async function r2(e,t){return tT(e,"POST","/v1/accounts:update",t)}async function r6(e,{displayName:t,photoURL:r}){if(void 0===t&&void 0===r)return;let n=et(e),i=await n.getIdToken(),s=await tB(n,r2(n.auth,{idToken:i,displayName:t,photoUrl:r,returnSecureToken:!0}));n.displayName=s.displayName||null,n.photoURL=s.photoUrl||null;let a=n.providerData.find(({providerId:e})=>"password"===e);a&&(a.displayName=n.displayName,a.photoURL=n.photoURL),await n._updateTokensIfNecessary(s)}function r3(e,t,r,n){return et(e).onAuthStateChanged(t,r,n)}function r5(e){return et(e).signOut()}function r4(e,t){return tT(e,"POST","/v2/accounts/mfaEnrollment:start",tE(e,t))}new WeakMap;let r8="__sak";class r7{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{if(!this.storage)return Promise.resolve(!1);return this.storage.setItem(r8,"1"),this.storage.removeItem(r8),Promise.resolve(!0)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class r9 extends r7{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=rt(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let r=this.storage.getItem(t),n=this.localCache[t];r!==n&&e(t,n,r)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,r)=>{this.notifyListeners(e,r)});let r=e.key;t?this.detachListener():this.stopPolling();let n=()=>{let e=this.storage.getItem(r);(t||this.localCache[r]!==e)&&this.notifyListeners(r,e)},i=this.storage.getItem(r);M()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(n,10):n()}notifyListeners(e,t){this.localCache[e]=t;let r=this.listeners[e];if(r)for(let e of Array.from(r))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}r9.type="LOCAL";class ne extends r7{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}ne.type="SESSION";class nt{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;let r=new nt(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let{eventId:t,eventType:r,data:n}=e.data,i=this.handlersMap[r];if(!i?.size)return;e.ports[0].postMessage({status:"ack",eventId:t,eventType:r});let s=Array.from(i).map(async t=>t(e.origin,n)),a=await Promise.all(s.map(async e=>{try{let t=await e;return{fulfilled:!0,value:t}}catch(e){return{fulfilled:!1,reason:e}}}));e.ports[0].postMessage({status:"done",eventId:t,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function nr(e="",t=10){let r="";for(let e=0;e<t;e++)r+=Math.floor(10*Math.random());return e+r}nt.receivers=[];class nn{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){let n,i,s="u">typeof MessageChannel?new MessageChannel:null;if(!s)throw Error("connection_unavailable");return new Promise((a,o)=>{let l=nr("",20);s.port1.start();let u=setTimeout(()=>{o(Error("unsupported_event"))},r);i={messageChannel:s,onMessage(e){if(e.data.eventId===l)switch(e.data.status){case"ack":clearTimeout(u),n=setTimeout(()=>{o(Error("timeout"))},3e3);break;case"done":clearTimeout(n),a(e.data.response);break;default:clearTimeout(u),clearTimeout(n),o(Error("invalid_response"))}}},this.handlers.add(i),s.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[s.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function ni(){return window}function ns(){return void 0!==ni().WorkerGlobalScope&&"function"==typeof ni().importScripts}async function na(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}let no="firebaseLocalStorageDb",nl="firebaseLocalStorage",nu="fbase_key";class nh{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function nc(e,t){return e.transaction([nl],t?"readwrite":"readonly").objectStore(nl)}function nd(){let e=indexedDB.open(no,1);return new Promise((t,r)=>{e.addEventListener("error",()=>{r(e.error)}),e.addEventListener("upgradeneeded",()=>{let t=e.result;try{t.createObjectStore(nl,{keyPath:nu})}catch(e){r(e)}}),e.addEventListener("success",async()=>{let r=e.result;r.objectStoreNames.contains(nl)?t(r):(r.close(),await new nh(indexedDB.deleteDatabase(no)).toPromise(),t(await nd()))})})}async function nf(e,t,r){return new nh(nc(e,!0).put({[nu]:t,value:r})).toPromise()}async function np(e,t){let r=nc(e,!1).get(t),n=await new nh(r).toPromise();return void 0===n?null:n.value}function ng(e,t){return new nh(nc(e,!0).delete(t)).toPromise()}class nm{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await nd()),this.db}async _withRetries(e){let t=0;for(;;)try{let t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ns()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=nt._getInstance(ns()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await na(),!this.activeServiceWorker)return;this.sender=new nn(this.activeServiceWorker);let e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&(navigator?.serviceWorker?.controller||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await nd();return await nf(e,r8,"1"),await ng(e,r8),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>nf(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(t=>np(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>ng(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(e=>new nh(nc(e,!1).getAll()).toPromise());if(!e||0!==this.pendingWrites)return[];let t=[],r=new Set;if(0!==e.length)for(let{fbase_key:n,value:i}of e)r.add(n),JSON.stringify(this.localCache[n])!==JSON.stringify(i)&&(this.notifyListeners(n,i),t.push(n));for(let e of Object.keys(this.localCache))this.localCache[e]&&!r.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;let r=this.listeners[e];if(r)for(let e of Array.from(r))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}function ny(e,t){return tT(e,"POST","/v2/accounts/mfaSignIn:start",tE(e,t))}nm.type="LOCAL",ru("rcb"),new ty(3e4,6e4);let nw="recaptcha";async function nv(e,t,r){if(!e._getRecaptchaConfig())try{await rm(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let n;if(n="string"==typeof t?{phoneNumber:t}:t,"session"in n){let t=n.session;if("phoneNumber"in n){tf("enroll"===t.type,e,"internal-error");let i={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:n.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},s=async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===rd){tf(r?.type===nw,e,"argument-error");let n=await nb(e,t,r);return r4(e,n)}return r4(e,t)},a=rg(e,i,"mfaSmsEnrollment",s,"PHONE_PROVIDER");return(await a.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{tf("signin"===t.type,e,"internal-error");let i=n.multiFactorHint?.uid||n.multiFactorUid;tf(i,e,"missing-multi-factor-info");let s={mfaPendingCredential:t.credential,mfaEnrollmentId:i,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},a=async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===rd){tf(r?.type===nw,e,"argument-error");let n=await nb(e,t,r);return ny(e,n)}return ny(e,t)},o=rg(e,s,"mfaSmsSignIn",a,"PHONE_PROVIDER");return(await o.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{let t={phoneNumber:n.phoneNumber,clientType:"CLIENT_TYPE_WEB"},i=async(e,t)=>{if(t.captchaResponse===rd){tf(r?.type===nw,e,"argument-error");let n=await nb(e,t,r);return rA(e,n)}return rA(e,t)},s=rg(e,t,"sendVerificationCode",i,"PHONE_PROVIDER");return(await s.catch(e=>Promise.reject(e))).sessionInfo}}finally{r?._reset()}}async function nb(e,t,r){tf(r.type===nw,e,"argument-error");let n=await r.verify();tf("string"==typeof n,e,"argument-error");let i={...t};if("phoneEnrollmentInfo"in i){let e=i.phoneEnrollmentInfo.phoneNumber,t=i.phoneEnrollmentInfo.captchaResponse,r=i.phoneEnrollmentInfo.clientType,s=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:n,captchaResponse:t,clientType:r,recaptchaVersion:s}}),i}if(!("phoneSignInInfo"in i))return Object.assign(i,{recaptchaToken:n}),i;{let e=i.phoneSignInInfo.captchaResponse,t=i.phoneSignInInfo.clientType,r=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:n,captchaResponse:e,clientType:t,recaptchaVersion:r}}),i}}class n_{constructor(e){this.providerId=n_.PROVIDER_ID,this.auth=function(e){return et(e)}(e)}verifyPhoneNumber(e,t){return nv(this.auth,e,et(t))}static credential(e,t){return rR._fromVerification(e,t)}static credentialFromResult(e){return n_.credentialFromTaggedObject(e)}static credentialFromError(e){return n_.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:r}=e;return t&&r?rR._fromTokenResponse(t,r):null}}function nI(e,t){return t?tX(t):(tf(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}n_.PROVIDER_ID="phone",n_.PHONE_SIGN_IN_METHOD="phone";class nE extends rv{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return rS(e,this._buildIdpRequest())}_linkToIdToken(e,t){return rS(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return rS(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function nT(e){return rW(e.auth,new nE(e),e.bypassAuthState)}function nS(e){let{auth:t,user:r}=e;return tf(r,t,"internal-error"),rH(r,new nE(e),e.bypassAuthState)}async function nC(e){let{auth:t,user:r}=e;return tf(r,t,"internal-error"),rG(r,new nE(e),e.bypassAuthState)}class nA{constructor(e,t,r,n,i=!1){this.auth=e,this.resolver=r,this.user=n,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:r,postBody:n,tenantId:i,error:s,type:a}=e;if(s)return void this.reject(s);let o={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:n||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return nT;case"linkViaPopup":case"linkViaRedirect":return nC;case"reauthViaPopup":case"reauthViaRedirect":return nS;default:tl(this.auth,"internal-error")}}resolve(e){var t,r;t=this.pendingPromise,r="Pending promise was never set",t||tp(r),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){var t,r;t=this.pendingPromise,r="Pending promise was never set",t||tp(r),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}let nk=new ty(2e3,1e4);async function nx(e,t,r){if(e$(e.app))return Promise.reject(tu(e,"operation-not-supported-in-this-environment"));let n=et(e);if(!(t instanceof rL))throw rL.name!==t.constructor.name&&tl(e,"argument-error"),th(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`);let i=nI(n,r);return new nD(n,"signInViaPopup",t,i).executeNotNull()}class nD extends nA{constructor(e,t,r,n,i){super(e,t,n,i),this.provider=r,this.authWindow=null,this.pollId=null,nD.currentPopupAction&&nD.currentPopupAction.cancel(),nD.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return tf(e,this.auth,"internal-error"),e}async onExecution(){var e,t;e=1===this.filter.length,t="Popup operations only handle one event",e||tp(t);let r=nr();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],r),this.authWindow.associatedEvent=r,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(tu(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(tu(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,nD.currentPopupAction=null}pollUserCancellation(){let e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(tu(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,nk.get())};e()}}nD.currentPopupAction=null;let nN=new Map;class nR extends nA{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=nN.get(this.auth._key());if(!e){try{let t=await nO(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}nN.set(this.auth._key(),e)}return this.bypassAuthState||nN.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type)return void this.resolve(null);if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function nO(e,t){var r;let n=t0("pendingRedirect",(r=t).config.apiKey,r.name),i=tX(e._redirectPersistence);if(!await i._isAvailable())return!1;let s=await i._get(n)==="true";return await i._remove(n),s}function nP(e,t){nN.set(e._key(),t)}async function nL(e,t,r=!1){if(e$(e.app))return Promise.reject(tc(e));let n=et(e),i=nI(n,t),s=new nR(n,i,r),a=await s.execute();return a&&!r&&(delete a.user._redirectEventId,await n._persistUserIfCurrent(a.user),await n._setRedirectUser(null,t)),a}class nM{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return nV(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!nV(e)){let r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(tu(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(nF(e))}saveEventToCache(e){this.cachedEventUids.add(nF(e)),this.lastProcessedEventTime=Date.now()}}function nF(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function nV({type:e,error:t}){return"unknown"===e&&t?.code==="auth/no-auth-event"}async function nU(e,t={}){return tT(e,"GET","/v1/projects",t)}let nB=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,nq=/^https?/;async function nj(e){if(e.config.emulator)return;let{authorizedDomains:t}=await nU(e);for(let e of t)try{if(function(e){let t=tg(),{protocol:r,hostname:n}=new URL(t);if(e.startsWith("chrome-extension://")){let i=new URL(e);return""===i.hostname&&""===n?"chrome-extension:"===r&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===r&&i.hostname===n}if(!nq.test(r))return!1;if(nB.test(e))return n===e;let i=e.replace(/\./g,"\\.");return RegExp("^(.+\\."+i+"|"+i+")$","i").test(n)}(e))return}catch{}tl(e,"unauthorized-domain")}let n$=new ty(3e4,6e4);function nz(){let e=ni().___jsl;if(e?.H){for(let t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}}let nK=null,nG=new ty(5e3,15e3),nH={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},nW=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function nQ(e){let t,r,n,i,s,a=await (nK=nK||new Promise((t,r)=>{function n(){nz(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{nz(),r(tu(e,"network-request-failed"))},timeout:n$.get()})}if(ni().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else if(ni().gapi?.load)n();else{var i;let t=ru("iframefcb");return ni()[t]=()=>{gapi.load?n():r(tu(e,"network-request-failed"))},(i=`${rl.gapiScript}?onload=${t}`,rl.loadJS(i)).catch(e=>r(e))}}).catch(e=>{throw nK=null,e})),o=ni().gapi;return tf(o,e,"internal-error"),a.open({where:document.body,url:(tf((t=e.config).authDomain,e,"auth-domain-config-required"),r=t.emulator?tw(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,n={apiKey:t.apiKey,appName:e.name,v:eQ},(i=nW.get(e.config.apiHost))&&(n.eid=i),(s=e._getFrameworks()).length&&(n.fw=s.join(",")),`${r}?${W(n).slice(1)}`),messageHandlersFilter:o.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:nH,dontclear:!0},t=>new Promise(async(r,n)=>{await t.restyle({setHideOnLeave:!1});let i=tu(e,"network-request-failed"),s=ni().setTimeout(()=>{n(i)},nG.get());function a(){ni().clearTimeout(s),r(t)}t.ping(a).then(a,()=>{n(i)})}))}let nJ={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class nY{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}let nX=encodeURIComponent("fac");async function nZ(e,t,r,n,i,s){tf(e.config.authDomain,e,"auth-domain-config-required"),tf(e.config.apiKey,e,"invalid-api-key");let a={apiKey:e.config.apiKey,appName:e.name,authType:r,redirectUrl:n,v:eQ,eventId:i};if(t instanceof rL)for(let[r,n]of(t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",K(t.getCustomParameters())||(a.customParameters=JSON.stringify(t.getCustomParameters())),Object.entries(s||{})))a[r]=n;if(t instanceof rM){let e=t.getScopes().filter(e=>""!==e);e.length>0&&(a.scopes=e.join(","))}for(let t of(e.tenantId&&(a.tid=e.tenantId),Object.keys(a)))void 0===a[t]&&delete a[t];let o=await e._getAppCheckToken(),l=o?`#${nX}=${encodeURIComponent(o)}`:"";return`${function({config:e}){return e.emulator?tw(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${W(a).slice(1)}${l}`}let n0="webStorageSupport",n1=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ne,this._completeRedirectFn=nL,this._overrideRedirectResult=nP}async _openPopup(e,t,r,n){var i,s;i=this.eventManagers[e._key()]?.manager,s="_initialize() not called before _openPopup()",i||tp(s);let a=await nZ(e,t,r,tg(),n);return function(e,t,r,n=500,i=600){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-n)/2,0).toString(),o="",l={...nJ,width:n.toString(),height:i.toString(),top:s,left:a},u=k().toLowerCase();r&&(o=t5(u)?"_blank":r),t6(u)&&(t=t||"http://localhost",l.scrollbars="yes");let h=Object.entries(l).reduce((e,[t,r])=>`${e}${t}=${r},`,"");if(function(e=k()){return re(e)&&!!window.navigator?.standalone}(u)&&"_self"!==o){var c,d;let e,r;return c=t||"",d=o,(e=document.createElement("a")).href=c,e.target=d,(r=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),e.dispatchEvent(r),new nY(null)}let f=window.open(t||"",o,h);tf(f,e,"popup-blocked");try{f.focus()}catch(e){}return new nY(f)}(e,a,nr())}async _openRedirect(e,t,r,n){var i;return await this._originValidation(e),i=await nZ(e,t,r,tg(),n),ni().location.href=i,new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){var r;let{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(r="If manager is not set, promise should be",n||tp(r),n)}let n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){let t=await nQ(e),r=new nM(e);return t.register("authEvent",t=>(tf(t?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(n0,{type:n0},r=>{let n=r?.[0]?.[n0];void 0!==n&&t(!!n),tl(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=nj(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return rt()||t3()||re()}};var n2="@firebase/auth",n6="1.12.0";class n3{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e(t?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){tf(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}let n5=b("authIdTokenMaxAge")||300,n4=null;function n8(e=eX()){let t=eU(e,"auth");if(t.isInitialized())return t.getImmediate();let r=function(e,t){let r=eU(e,"auth");if(r.isInitialized()){let e=r.getImmediate();if(G(r.getOptions(),t??{}))return e;tl(e,"already-initialized")}return r.initialize({options:t})}(e,{popupRedirectResolver:n1,persistence:[nm,r9,ne]}),n=b("authTokenSyncURL");if(n&&"boolean"==typeof isSecureContext&&isSecureContext){let e=new URL(n,location.origin);if(location.origin===e.origin){let t,n=(t=e.toString(),async e=>{let r=e&&await e.getIdTokenResult(),n=r&&(new Date().getTime()-Date.parse(r.issuedAtTime))/1e3;if(n&&n>n5)return;let i=r?.token;n4!==i&&(n4=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});et(r).beforeAuthStateChanged(n,()=>n(r.currentUser)),et(r).onIdTokenChanged(e=>n(e),void 0,void 0)}}let i=y("auth");return i&&function(e,t,r){let n=et(e);tf(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");let i=ry(t),{host:s,port:a}=function(e){let t=ry(e),r=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!r)return{host:"",port:null};let n=r[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){let e=i[1];return{host:e,port:rw(n.substr(e.length+1))}}{let[e,t]=n.split(":");return{host:e,port:rw(t)}}}(t),o=null===a?"":`:${a}`,l={url:`${i}//${s}${o}/`},u=Object.freeze({host:s,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!n._canInitEmulator){tf(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),tf(G(l,n.config.emulator)&&G(u,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=l,n.emulatorConfig=u,n.settings.appVerificationDisabledForTesting=!0,I(s)?(E(`${i}//${s}${o}`),A("Auth",!0)):function(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"u">typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"u">typeof window&&"u">typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(r,`http://${i}`),r}rl={loadJS:e=>new Promise((t,r)=>{let n=document.createElement("script");n.setAttribute("src",e),n.onload=t,n.onerror=e=>{let t=tu("internal-error");t.customData=e,r(t)},n.type="text/javascript",n.charset="UTF-8",(document.getElementsByTagName("head")?.[0]??document).appendChild(n)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},s="Browser",eV(new er("auth",(e,{options:t})=>{let r,n,i=e.getProvider("app").getImmediate(),a=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:l,authDomain:u}=i.options;tf(l&&!l.includes(":"),"invalid-api-key",{appName:i.name});let h=new ra(i,a,o,{apiKey:l,authDomain:u,clientPlatform:s,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:rr(s)});return n=(Array.isArray(r=t?.persistence||[])?r:[r]).map(tX),t?.errorMap&&h._updateErrorMap(t.errorMap),h._initializeWithPersistence(n,t?.popupRedirectResolver),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),eV(new er("auth-internal",e=>new n3(et(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),e1(n2,n6,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(s)),e1(n2,n6,"esm2020"),e.s([],58556),e.s([],51718),e.i(58556),e.s(["GithubAuthProvider",()=>rU,"GoogleAuthProvider",()=>rV,"createUserWithEmailAndPassword",()=>r0,"getAuth",()=>n8,"onAuthStateChanged",()=>r3,"signInWithEmailAndPassword",()=>r1,"signInWithPopup",()=>nx,"signOut",()=>r5,"updateProfile",()=>r6],18357)},14539,76510,e=>{"use strict";var t=e.i(92953);(0,t.registerVersion)("firebase","12.9.0","app"),e.s([],14539),e.i(97427),e.s(["getApp",()=>t.getApp,"getApps",()=>t.getApps,"initializeApp",()=>t.initializeApp],76510)},67034,(e,t,r)=>{var n={675:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),r=t[0],n=t[1];return(r+n)*3/4-n},t.toByteArray=function(e){var t,r,s=l(e),a=s[0],o=s[1],u=new i((a+o)*3/4-o),h=0,c=o>0?a-4:a;for(r=0;r<c;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],u[h++]=t>>16&255,u[h++]=t>>8&255,u[h++]=255&t;return 2===o&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,u[h++]=255&t),1===o&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,u[h++]=t>>8&255,u[h++]=255&t),u},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,s=[],a=0,o=n-i;a<o;a+=16383)s.push(function(e,t,n){for(var i,s=[],a=t;a<n;a+=3)i=(e[a]<<16&0xff0000)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(r[i>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return s.join("")}(e,a,a+16383>o?o:a+16383));return 1===i?s.push(r[(t=e[n-1])>>2]+r[t<<4&63]+"=="):2===i&&s.push(r[(t=(e[n-2]<<8)+e[n-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),s.join("")};for(var r=[],n=[],i="u">typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=s.length;a<o;++a)r[a]=s[a],n[s.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var n=r===t?0:4-r%4;return[r,n]}n[45]=62,n[95]=63},72:function(e,t,r){"use strict";var n=r(675),i=r(783),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function a(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return h(e)}return l(e,t,r)}function l(e,t,r){if("string"==typeof e){var n=e,i=t;if(("string"!=typeof i||""===i)&&(i="utf8"),!o.isEncoding(i))throw TypeError("Unknown encoding: "+i);var s=0|f(n,i),l=a(s),u=l.write(n,i);return u!==s&&(l=l.slice(0,u)),l}if(ArrayBuffer.isView(e))return c(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(x(e,ArrayBuffer)||e&&x(e.buffer,ArrayBuffer)||"u">typeof SharedArrayBuffer&&(x(e,SharedArrayBuffer)||e&&x(e.buffer,SharedArrayBuffer)))return function(e,t,r){var n;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),o.prototype),n}(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var h=e.valueOf&&e.valueOf();if(null!=h&&h!==e)return o.from(h,t,r);var p=function(e){if(o.isBuffer(e)){var t=0|d(e.length),r=a(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?a(0):c(e):"Buffer"===e.type&&Array.isArray(e.data)?c(e.data):void 0}(e);if(p)return p;if("u">typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return u(e),a(e<0?0:0|d(e))}function c(e){for(var t=e.length<0?0:0|d(e.length),r=a(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),!o.TYPED_ARRAY_SUPPORT&&"u">typeof console&&"function"==typeof console.error&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,r){return l(e,t,r)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,r){return(u(e),e<=0)?a(e):void 0!==t?"string"==typeof r?a(e).fill(t,r):a(e).fill(t):a(e)},o.allocUnsafe=function(e){return h(e)},o.allocUnsafeSlow=function(e){return h(e)};function d(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function f(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||x(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return S(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return A(e).length;default:if(i)return n?-1:S(e).length;t=(""+t).toLowerCase(),i=!0}}function p(e,t,r){var i,s,a,o=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",s=t;s<r;++s)i+=D[e[s]];return i}(this,t,r);case"utf8":case"utf-8":return w(this,t,r);case"ascii":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}(this,t,r);case"latin1":case"binary":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}(this,t,r);case"base64":return i=this,s=t,a=r,0===s&&a===i.length?n.fromByteArray(i):n.fromByteArray(i.slice(s,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,r){for(var n=e.slice(t,r),i="",s=0;s<n.length;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}(this,t,r);default:if(o)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function g(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function m(e,t,r,n,i){var s;if(0===e.length)return -1;if("string"==typeof r?(n=r,r=0):r>0x7fffffff?r=0x7fffffff:r<-0x80000000&&(r=-0x80000000),(s=r*=1)!=s&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length)if(i)return -1;else r=e.length-1;else if(r<0)if(!i)return -1;else r=0;if("string"==typeof t&&(t=o.from(t,n)),o.isBuffer(t))return 0===t.length?-1:y(e,t,r,n,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,r);else return Uint8Array.prototype.lastIndexOf.call(e,t,r);return y(e,[t],r,n,i)}throw TypeError("val must be string, number or Buffer")}function y(e,t,r,n,i){var s,a=1,o=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,r/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var h=-1;for(s=r;s<o;s++)if(u(e,s)===u(t,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===l)return h*a}else -1!==h&&(s-=s-h),h=-1}else for(r+l>o&&(r=o-l),s=r;s>=0;s--){for(var c=!0,d=0;d<l;d++)if(u(e,s+d)!==u(t,d)){c=!1;break}if(c)return s}return -1}o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(x(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),x(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:+(n<r)},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);if(void 0===t)for(r=0,t=0;r<e.length;++r)t+=e[r].length;var r,n=o.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var s=e[r];if(x(s,Uint8Array)&&(s=o.from(s)),!o.isBuffer(s))throw TypeError('"list" argument must be an Array of Buffers');s.copy(n,i),i+=s.length}return n},o.byteLength=f,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?w(this,0,e):p.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},s&&(o.prototype[s]=o.prototype.inspect),o.prototype.compare=function(e,t,r,n,i){if(x(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var s=i-n,a=r-t,l=Math.min(s,a),u=this.slice(n,i),h=e.slice(t,r),c=0;c<l;++c)if(u[c]!==h[c]){s=u[c],a=h[c];break}return s<a?-1:+(a<s)},o.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return m(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return m(this,e,t,r,!1)};function w(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var s,a,o,l,u=e[i],h=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c<=r)switch(c){case 1:u<128&&(h=u);break;case 2:(192&(s=e[i+1]))==128&&(l=(31&u)<<6|63&s)>127&&(h=l);break;case 3:s=e[i+1],a=e[i+2],(192&s)==128&&(192&a)==128&&(l=(15&u)<<12|(63&s)<<6|63&a)>2047&&(l<55296||l>57343)&&(h=l);break;case 4:s=e[i+1],a=e[i+2],o=e[i+3],(192&s)==128&&(192&a)==128&&(192&o)==128&&(l=(15&u)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(h=l)}null===h?(h=65533,c=1):h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),i+=c}var d=n,f=d.length;if(f<=4096)return String.fromCharCode.apply(String,d);for(var p="",g=0;g<f;)p+=String.fromCharCode.apply(String,d.slice(g,g+=4096));return p}function v(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function b(e,t,r,n,i,s){if(!o.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw RangeError('"value" argument is out of bounds');if(r+n>e.length)throw RangeError("Index out of range")}function _(e,t,r,n,i,s){if(r+n>e.length||r<0)throw RangeError("Index out of range")}function I(e,t,r,n,s){return t*=1,r>>>=0,s||_(e,t,r,4,34028234663852886e22,-34028234663852886e22),i.write(e,t,r,n,23,4),r+4}function E(e,t,r,n,s){return t*=1,r>>>=0,s||_(e,t,r,8,17976931348623157e292,-17976931348623157e292),i.write(e,t,r,n,52,8),r+8}o.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,s,a,o,l,u,h,c,d=this.length-t;if((void 0===r||r>d)&&(r=d),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var f=!1;;)switch(n){case"hex":return function(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var s=t.length;n>s/2&&(n=s/2);for(var a=0;a<n;++a){var o,l=parseInt(t.substr(2*a,2),16);if((o=l)!=o)break;e[r+a]=l}return a}(this,e,t,r);case"utf8":case"utf-8":return i=t,s=r,k(S(e,this.length-i),this,i,s);case"ascii":return a=t,o=r,k(C(e),this,a,o);case"latin1":case"binary":return function(e,t,r,n){return k(C(t),e,r,n)}(this,e,t,r);case"base64":return l=t,u=r,k(A(e),this,l,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h=t,c=r,k(function(e,t){for(var r,n,i=[],s=0;s<e.length&&!((t-=2)<0);++s)n=(r=e.charCodeAt(s))>>8,i.push(r%256),i.push(n);return i}(e,this.length-h),this,h,c);default:if(f)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),f=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,o.prototype),n},o.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||v(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n},o.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||v(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},o.prototype.readUInt8=function(e,t){return e>>>=0,t||v(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||v(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||v(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||v(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||v(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||v(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},o.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||v(e,t,this.length);for(var n=t,i=1,s=this[e+--n];n>0&&(i*=256);)s+=this[e+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},o.prototype.readInt8=function(e,t){return(e>>>=0,t||v(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||v(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt16BE=function(e,t){e>>>=0,t||v(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||v(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||v(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||v(e,4,this.length),i.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||v(e,4,this.length),i.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||v(e,8,this.length),i.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||v(e,8,this.length),i.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;b(this,e,t,r,i,0)}var s=1,a=0;for(this[t]=255&e;++a<r&&(s*=256);)this[t+a]=e/s&255;return t+r},o.prototype.writeUIntBE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;b(this,e,t,r,i,0)}var s=r-1,a=1;for(this[t+s]=255&e;--s>=0&&(a*=256);)this[t+s]=e/a&255;return t+r},o.prototype.writeUInt8=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUInt16BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUInt32LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUInt32BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,r,n){if(e*=1,t>>>=0,!n){var i=Math.pow(2,8*r-1);b(this,e,t,r,i-1,-i)}var s=0,a=1,o=0;for(this[t]=255&e;++s<r&&(a*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},o.prototype.writeIntBE=function(e,t,r,n){if(e*=1,t>>>=0,!n){var i=Math.pow(2,8*r-1);b(this,e,t,r,i-1,-i)}var s=r-1,a=1,o=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,r){return I(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return I(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return E(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return E(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,n){if(!o.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var s=i-1;s>=0;--s)e[s+t]=this[s+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return i},o.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!o.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===e.length){var i,s=e.charCodeAt(0);("utf8"===n&&s<128||"latin1"===n)&&(e=s)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var a=o.isBuffer(e)?e:o.from(e,n),l=a.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=a[i%l]}return this};var T=/[^+/0-9A-Za-z-_]/g;function S(e,t){t=t||1/0;for(var r,n=e.length,i=null,s=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319||a+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return s}function C(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function A(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(T,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function k(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length)&&!(i>=e.length);++i)t[i+r]=e[i];return i}function x(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var D=function(){for(var e="0123456789abcdef",t=Array(256),r=0;r<16;++r)for(var n=16*r,i=0;i<16;++i)t[n+i]=e[r]+e[i];return t}()},783:function(e,t){t.read=function(e,t,r,n,i){var s,a,o=8*i-n-1,l=(1<<o)-1,u=l>>1,h=-7,c=r?i-1:0,d=r?-1:1,f=e[t+c];for(c+=d,s=f&(1<<-h)-1,f>>=-h,h+=o;h>0;s=256*s+e[t+c],c+=d,h-=8);for(a=s&(1<<-h)-1,s>>=-h,h+=n;h>0;a=256*a+e[t+c],c+=d,h-=8);if(0===s)s=1-u;else{if(s===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),s-=u}return(f?-1:1)*a*Math.pow(2,s-n)},t.write=function(e,t,r,n,i,s){var a,o,l,u=8*s-i-1,h=(1<<u)-1,c=h>>1,d=5960464477539062e-23*(23===i),f=n?0:s-1,p=n?1:-1,g=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),a=h):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+c>=1?t+=d/l:t+=d*Math.pow(2,1-c),t*l>=2&&(a++,l/=2),a+c>=h?(o=0,a=h):a+c>=1?(o=(t*l-1)*Math.pow(2,i),a+=c):(o=t*Math.pow(2,c-1)*Math.pow(2,i),a=0));i>=8;e[r+f]=255&o,f+=p,o/=256,i-=8);for(a=a<<i|o,u+=i;u>0;e[r+f]=255&a,f+=p,a/=256,u-=8);e[r+f-p]|=128*g}}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}},a=!0;try{n[e](r,r.exports,s),a=!1}finally{a&&delete i[e]}return r.exports}s.ab="/ROOT/node_modules/next/dist/compiled/buffer/",t.exports=s(72)},36180,98925,e=>{"use strict";var t,r,n,i,s,a,o,l,u,h,c,d,f,p,g=e.i(92953),m=e.i(8070),y=e.i(47167),w=e.i(67034),v=e.i(97427),b="u">typeof globalThis?globalThis:"u">typeof window?window:e.g,_={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}var n=function(){this.blockSize=-1};function i(){}function s(e,t,r){r||(r=0);let n=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)n[i]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(i=0;i<16;++i)n[i]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],i=e.g[2];let s=e.g[3],a;a=t+(s^r&(i^s))+n[0]+0xd76aa478|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[1]+0xe8c7b756|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[2]+0x242070db|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[3]+0xc1bdceee|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[4]+0xf57c0faf|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[5]+0x4787c62a|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[6]+0xa8304613|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[7]+0xfd469501|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[8]+0x698098d8|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[9]+0x8b44f7af|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[10]+0xffff5bb1|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[11]+0x895cd7be|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[12]+0x6b901122|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[13]+0xfd987193|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[14]+0xa679438e|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[15]+0x49b40821|0,r=i+(a<<22|a>>>10),a=t+(i^s&(r^i))+n[1]+0xf61e2562|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[0]+0xe9b6c7aa|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[5]+0xd62f105d|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[4]+0xe7d3fbc8|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[9]+0x21e1cde6|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[8]+0x455a14ed|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[13]+0xa9e3e905|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[12]+0x8d2a4c8a|0,a=t+((r=i+(a<<20|a>>>12))^i^s)+n[5]+0xfffa3942|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[11]+0x6d9d6122|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[14]+0xfde5380c|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[1]+0xa4beea44|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[7]+0xf6bb4b60|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[10]+0xbebfbc70|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[13]+0x289b7ec6|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[3]+0xd4ef3085|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[6]+0x4881d05|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[9]+0xd9d4d039|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[15]+0x1fa27cf8|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[2]+0xc4ac5665|0,r=i+(a<<23|a>>>9),a=t+(i^(r|~s))+n[0]+0xf4292244|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[5]+0xfc93a039|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[12]+0x655b59c3|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[1]+0x85845dd1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[8]+0x6fa87e4f|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[13]+0x4e0811a1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[4]+0xf7537e82|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function a(e,t){this.h=t;let r=[],n=!0;for(let i=e.length-1;i>=0;i--){let s=0|e[i];n&&s==t||(r[i]=s,n=!1)}this.g=r}i.prototype=n.prototype,e.F=n.prototype,e.prototype=new i,e.prototype.constructor=e,e.D=function(e,t,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return n.prototype[t].apply(e,i)},e.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.v=function(e,t){void 0===t&&(t=e.length);let r=t-this.blockSize,n=this.C,i=this.h,a=0;for(;a<t;){if(0==i)for(;a<=r;)s(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(n[i++]=e.charCodeAt(a++),i==this.blockSize){s(this,n),i=0;break}}else for(;a<t;)if(n[i++]=e[a++],i==this.blockSize){s(this,n),i=0;break}}this.h=i,this.o+=t},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var r=e.length-8;r<e.length;++r)e[r]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,r=0;r<4;++r)for(let n=0;n<32;n+=8)e[t++]=this.g[r]>>>n&255;return e};var o,l={};function u(e){var t;return -128<=e&&e<128?(t=function(e){return new a([0|e],e<0?-1:0)},Object.prototype.hasOwnProperty.call(l,e)?l[e]:l[e]=t(e)):new a([0|e],e<0?-1:0)}function h(e){if(isNaN(e)||!isFinite(e))return c;if(e<0)return m(h(-e));let t=[],r=1;for(let n=0;e>=r;n++)t[n]=e/r|0,r*=0x100000000;return new a(t,0)}var c=u(0),d=u(1),f=u(0x1000000);function p(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function g(e){return -1==e.h}function m(e){let t=e.g.length,r=[];for(let n=0;n<t;n++)r[n]=~e.g[n];return new a(r,~e.h).add(d)}function y(e,t){return e.add(m(t))}function w(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function v(e,t){this.g=e,this.h=t}function b(e,t){if(p(t))throw Error("division by zero");if(p(e))return new v(c,c);if(g(e))return t=b(m(e),t),new v(m(t.g),m(t.h));if(g(t))return t=b(e,m(t)),new v(m(t.g),t.h);if(e.g.length>30){if(g(e)||g(t))throw Error("slowDivide_ only works with positive integers.");for(var r=d,n=t;0>=n.l(e);)r=I(r),n=I(n);var i=E(r,1),s=E(n,1);for(n=E(n,2),r=E(r,2);!p(n);){var a=s.add(n);0>=a.l(e)&&(i=i.add(r),s=a),n=E(n,1),r=E(r,1)}return t=y(e,i.j(t)),new v(i,t)}for(i=c;e.l(t)>=0;){for(n=(n=Math.ceil(Math.log(r=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,n-48),a=(s=h(r)).j(t);g(a)||a.l(e)>0;)r-=n,a=(s=h(r)).j(t);p(s)&&(s=d),i=i.add(s),e=y(e,a)}return new v(i,e)}function I(e){let t=e.g.length+1,r=[];for(let n=0;n<t;n++)r[n]=e.i(n)<<1|e.i(n-1)>>>31;return new a(r,e.h)}function E(e,t){let r=t>>5;t%=32;let n=e.g.length-r,i=[];for(let s=0;s<n;s++)i[s]=t>0?e.i(s+r)>>>t|e.i(s+r+1)<<32-t:e.i(s+r);return new a(i,e.h)}(o=a.prototype).m=function(){if(g(this))return-m(this).m();let e=0,t=1;for(let r=0;r<this.g.length;r++){let n=this.i(r);e+=(n>=0?n:0x100000000+n)*t,t*=0x100000000}return e},o.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(p(this))return"0";if(g(this))return"-"+m(this).toString(e);let t=h(Math.pow(e,6));var r=this;let n="";for(;;){let i=b(r,t).g,s=(((r=y(r,i.j(t))).g.length>0?r.g[0]:r.h)>>>0).toString(e);if(p(r=i))return s+n;for(;s.length<6;)s="0"+s;n=s+n}},o.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},o.l=function(e){return g(e=y(this,e))?-1:+!p(e)},o.abs=function(){return g(this)?m(this):this},o.add=function(e){let t=Math.max(this.g.length,e.g.length),r=[],n=0;for(let i=0;i<=t;i++){let t=n+(65535&this.i(i))+(65535&e.i(i)),s=(t>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);n=s>>>16,t&=65535,s&=65535,r[i]=s<<16|t}return new a(r,-0x80000000&r[r.length-1]?-1:0)},o.j=function(e){if(p(this)||p(e))return c;if(g(this))return g(e)?m(this).j(m(e)):m(m(this).j(e));if(g(e))return m(this.j(m(e)));if(0>this.l(f)&&0>e.l(f))return h(this.m()*e.m());let t=this.g.length+e.g.length,r=[];for(var n=0;n<2*t;n++)r[n]=0;for(n=0;n<this.g.length;n++)for(let t=0;t<e.g.length;t++){let i=this.i(n)>>>16,s=65535&this.i(n),a=e.i(t)>>>16,o=65535&e.i(t);r[2*n+2*t]+=s*o,w(r,2*n+2*t),r[2*n+2*t+1]+=i*o,w(r,2*n+2*t+1),r[2*n+2*t+1]+=s*a,w(r,2*n+2*t+1),r[2*n+2*t+2]+=i*a,w(r,2*n+2*t+2)}for(e=0;e<t;e++)r[e]=r[2*e+1]<<16|r[2*e];for(e=t;e<2*t;e++)r[e]=0;return new a(r,0)},o.B=function(e){return b(this,e).h},o.and=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)&e.i(n);return new a(r,this.h&e.h)},o.or=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)|e.i(n);return new a(r,this.h|e.h)},o.xor=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)^e.i(n);return new a(r,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,r=_.Md5=e,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=function e(t,r){if(0==t.length)throw Error("number format error: empty string");if((r=r||10)<2||36<r)throw Error("radix out of range: "+r);if("-"==t.charAt(0))return m(e(t.substring(1),r));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');let n=h(Math.pow(r,8)),i=c;for(let e=0;e<t.length;e+=8){var s=Math.min(8,t.length-e);let a=parseInt(t.substring(e,e+s),r);s<8?(s=h(Math.pow(r,s)),i=i.j(s).add(h(a))):i=(i=i.j(n)).add(h(a))}return i},t=_.Integer=a}).apply(void 0!==b?b:"u">typeof self?self:"u">typeof window?window:{});var I=e.i(83877),E="u">typeof globalThis?globalThis:"u">typeof window?window:e.g,T={};(function(){var e,t,r=Object.defineProperty,c=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof E&&E];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function d(e,t){if(t)e:{var n=c;e=e.split(".");for(var i=0;i<e.length-1;i++){var s=e[i];if(!(s in n))break e;n=n[s]}(t=t(i=n[e=e[e.length-1]]))!=i&&null!=t&&r(n,e,{configurable:!0,writable:!0,value:t})}}d("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),d("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),d("Object.entries",function(e){return e||function(e){var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push([t,e[t]]);return r}});var f=f||{},p=this||self;function g(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function m(e,t,r){return e.call.apply(e.bind,arguments)}function y(e,t,r){return(y=m).apply(null,arguments)}function w(e,t){var r=Array.prototype.slice.call(arguments,1);return function(){var t=r.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function v(e,t){function r(){}r.prototype=t.prototype,e.Z=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.Ob=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)}}var b="u">typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function _(e){let t=e.length;if(t>0){let r=Array(t);for(let n=0;n<t;n++)r[n]=e[n];return r}return[]}function I(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];var r=typeof n;if("array"==(r="object"!=r?r:n?Array.isArray(n)?"array":r:"null")||"object"==r&&"number"==typeof n.length){r=e.length||0;let t=n.length||0;e.length=r+t;for(let i=0;i<t;i++)e[r+i]=n[i]}else e.push(n)}}var S=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new C,e=>e.reset());class C{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let A,k=!1,x=new class{constructor(){this.h=this.g=null}add(e,t){let r=S.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},D=()=>{let e=Promise.resolve(void 0);A=()=>{e.then(N)}};function N(){let e;for(var t;e=null,x.g&&(e=x.g,x.g=x.g.next,x.g||(x.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){p.setTimeout(()=>{throw e},0)}(e)}S.j(t),S.h<100&&(S.h++,t.next=S.g,S.g=t)}k=!1}function R(){this.u=this.u,this.C=this.C}function O(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}R.prototype.u=!1,R.prototype.dispose=function(){this.u||(this.u=!0,this.N())},R.prototype[Symbol.dispose]=function(){this.dispose()},R.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},O.prototype.h=function(){this.defaultPrevented=!0};var P=function(){if(!p.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};p.addEventListener("test",e,t),p.removeEventListener("test",e,t)}catch(e){}return e}();function L(e){return/^[\s\xa0]*$/.test(e)}function M(e,t){O.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}v(M,O),M.prototype.init=function(e,t){let r=this.type=e.type,n=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==r?t=e.fromElement:"mouseout"==r&&(t=e.toElement)),this.relatedTarget=t,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&M.Z.h.call(this)},M.prototype.h=function(){M.Z.h.call(this);let e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var F="closure_listenable_"+(1e6*Math.random()|0),V=0;function U(e,t,r,n,i){this.listener=e,this.proxy=null,this.src=t,this.type=r,this.capture=!!n,this.ha=i,this.key=++V,this.da=this.fa=!1}function B(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function q(e,t,r){for(let n in e)t.call(r,e[n],n,e)}function j(e){let t={};for(let r in e)t[r]=e[r];return t}let $="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function z(e,t){let r,n;for(let t=1;t<arguments.length;t++){for(r in n=arguments[t])e[r]=n[r];for(let t=0;t<$.length;t++)r=$[t],Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}}function K(e){this.src=e,this.g={},this.h=0}function G(e,t){let r=t.type;if(r in e.g){var n,i=e.g[r],s=Array.prototype.indexOf.call(i,t,void 0);(n=s>=0)&&Array.prototype.splice.call(i,s,1),n&&(B(t),0==e.g[r].length&&(delete e.g[r],e.h--))}}function H(e,t,r,n){for(let i=0;i<e.length;++i){let s=e[i];if(!s.da&&s.listener==t&&!!r==s.capture&&s.ha==n)return i}return -1}K.prototype.add=function(e,t,r,n,i){let s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);let a=H(e,t,n,i);return a>-1?(t=e[a],r||(t.fa=!1)):((t=new U(t,this.src,s,!!n,i)).fa=r,e.push(t)),t};var W="closure_lm_"+(1e6*Math.random()|0),Q={};function J(e,t,r,n,i,s){if(!t)throw Error("Invalid event type");let a=g(i)?!!i.capture:!!i,o=ee(e);if(o||(e[W]=o=new K(e)),(r=o.add(t,r,n,a,s)).proxy)return r;if(n=function e(t){return Z.call(e.src,e.listener,t)},r.proxy=n,n.src=e,n.listener=r,e.addEventListener)P||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),n,i);else if(e.attachEvent)e.attachEvent(X(t.toString()),n);else if(e.addListener&&e.removeListener)e.addListener(n);else throw Error("addEventListener and attachEvent are unavailable.");return r}function Y(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[F])G(t.i,e);else{var r=e.type,n=e.proxy;t.removeEventListener?t.removeEventListener(r,n,e.capture):t.detachEvent?t.detachEvent(X(r),n):t.addListener&&t.removeListener&&t.removeListener(n),(r=ee(t))?(G(r,e),0==r.h&&(r.src=null,t[W]=null)):B(e)}}}function X(e){return e in Q?Q[e]:Q[e]="on"+e}function Z(e,t){if(e.da)e=!0;else{t=new M(t,this);let r=e.listener,n=e.ha||e.src;e.fa&&Y(e),e=r.call(n,t)}return e}function ee(e){return(e=e[W])instanceof K?e:null}var et="__closure_events_fn_"+(1e9*Math.random()>>>0);function er(e){return"function"==typeof e?e:(e[et]||(e[et]=function(t){return e.handleEvent(t)}),e[et])}function en(){R.call(this),this.i=new K(this),this.M=this,this.G=null}function ei(e,t){let r,n;var i,s=e.G;if(s)for(i=[];s;s=s.G)i.push(s);if(e=e.M,s=t.type||t,"string"==typeof t)t=new O(t,e);else if(t instanceof O)t.target=t.target||e;else{var a=t;z(t=new O(s,e),a)}if(a=!0,i)for(n=i.length-1;n>=0;n--)a=es(r=t.g=i[n],s,!0,t)&&a;if(a=es(r=t.g=e,s,!0,t)&&a,a=es(r,s,!1,t)&&a,i)for(n=0;n<i.length;n++)a=es(r=t.g=i[n],s,!1,t)&&a}function es(e,t,r,n){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let i=!0;for(let s=0;s<t.length;++s){let a=t[s];if(a&&!a.da&&a.capture==r){let t=a.listener,r=a.ha||a.src;a.fa&&G(e.i,a),i=!1!==t.call(r,n)&&i}}return i&&!n.defaultPrevented}v(en,R),en.prototype[F]=!0,en.prototype.removeEventListener=function(e,t,r,n){!function e(t,r,n,i,s){if(Array.isArray(r))for(var a=0;a<r.length;a++)e(t,r[a],n,i,s);else(i=g(i)?!!i.capture:!!i,n=er(n),t&&t[F])?(t=t.i,(a=String(r).toString())in t.g&&(n=H(r=t.g[a],n,i,s))>-1&&(B(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete t.g[a],t.h--))):t&&(t=ee(t))&&(r=t.g[r.toString()],t=-1,r&&(t=H(r,n,i,s)),(n=t>-1?r[t]:null)&&Y(n))}(this,e,t,r,n)},en.prototype.N=function(){if(en.Z.N.call(this),this.i){var e=this.i;for(let t in e.g){let r=e.g[t];for(let e=0;e<r.length;e++)B(r[e]);delete e.g[t],e.h--}}this.G=null},en.prototype.J=function(e,t,r,n){return this.i.add(String(e),t,!1,r,n)},en.prototype.K=function(e,t,r,n){return this.i.add(String(e),t,!0,r,n)};class ea extends R{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=function(e,t){if("function"!=typeof e)if(e&&"function"==typeof e.handleEvent)e=y(e.handleEvent,e);else throw Error("Invalid listener argument");return Number(t)>0x7fffffff?-1:p.setTimeout(e,t||0)}(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let r=t.h;t.h=null,t.m.apply(null,r)}(this)}N(){super.N(),this.g&&(p.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function eo(e){R.call(this),this.h=e,this.g={}}v(eo,R);var el=[];function eu(e){q(e.g,function(e,t){this.g.hasOwnProperty(t)&&Y(e)},e),e.g={}}eo.prototype.N=function(){eo.Z.N.call(this),eu(this)},eo.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var eh=p.JSON.stringify,ec=p.JSON.parse,ed=class{stringify(e){return p.JSON.stringify(e,void 0)}parse(e){return p.JSON.parse(e,void 0)}};function ef(){}function ep(){}var eg={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function em(){O.call(this,"d")}function ey(){O.call(this,"c")}v(em,O),v(ey,O);var ew={},ev=null;function eb(){return ev=ev||new en}function e_(e){O.call(this,ew.Ia,e)}function eI(e){let t=eb();ei(t,new e_(t))}function eE(e,t){O.call(this,ew.STAT_EVENT,e),this.stat=t}function eT(e){let t=eb();ei(t,new eE(t,e))}function eS(e,t){O.call(this,ew.Ja,e),this.size=t}function eC(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return p.setTimeout(function(){e()},t)}function eA(){this.g=!0}function ek(e,t,r,n){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{let s=JSON.parse(t);if(s){for(e=0;e<s.length;e++)if(Array.isArray(s[e])){var r=s[e];if(!(r.length<2)){var n=r[1];if(Array.isArray(n)&&!(n.length<1)){var i=n[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(let e=1;e<n.length;e++)n[e]=""}}}}return eh(s)}catch(e){return t}}(e,r)+(n?" "+n:"")})}ew.Ia="serverreachability",v(e_,O),ew.STAT_EVENT="statevent",v(eE,O),ew.Ja="timingevent",v(eS,O),eA.prototype.ua=function(){this.g=!1},eA.prototype.info=function(){};var ex={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},eD={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function eN(){}function eR(e){return encodeURIComponent(String(e))}function eO(e,t,r,n){this.j=e,this.i=t,this.l=r,this.S=n||1,this.V=new eo(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new eP}function eP(){this.i=null,this.g="",this.h=!1}v(eN,ef),eN.prototype.g=function(){return new XMLHttpRequest},e=new eN;var eL={},eM={};function eF(e,t,r){e.M=1,e.A=e8(e2(t)),e.u=r,e.R=!0,eV(e,null)}function eV(e,t){e.F=Date.now(),eB(e),e.B=e2(e.A);var r,n,i,s,a,o,l=e.B,u=e.S;Array.isArray(u)||(u=[String(u)]),tc(l.i,"t",u),e.C=0,l=e.j.L,e.h=new eP,e.g=tY(e.j,l?t:null,!e.u),e.P>0&&(e.O=new ea(y(e.Y,e,e.g),e.P)),t=e.V,l=e.g,u=e.ba;var h="readystatechange";Array.isArray(h)||(h&&(el[0]=h.toString()),h=el);for(let e=0;e<h.length;e++){let r=function e(t,r,n,i,s){if(i&&i.once)return function e(t,r,n,i,s){if(Array.isArray(r)){for(let a=0;a<r.length;a++)e(t,r[a],n,i,s);return null}return n=er(n),t&&t[F]?t.K(r,n,g(i)?!!i.capture:!!i,s):J(t,r,n,!0,i,s)}(t,r,n,i,s);if(Array.isArray(r)){for(let a=0;a<r.length;a++)e(t,r[a],n,i,s);return null}return n=er(n),t&&t[F]?t.J(r,n,g(i)?!!i.capture:!!i,s):J(t,r,n,!1,i,s)}(l,h[e],u||t.handleEvent,!1,t.h||t);if(!r)break;t.g[r.key]=r}t=e.J?j(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),eI(),r=e.i,n=e.v,i=e.B,s=e.l,a=e.S,o=e.u,r.info(function(){if(r.g)if(o){var e="",t=o.split("&");for(let r=0;r<t.length;r++){var l=t[r].split("=");if(l.length>1){let t=l[0];l=l[1];let r=t.split("_");e=r.length>=2&&"type"==r[1]?e+(t+"=")+l+"&":e+(t+"=redacted&")}}}else e=null;else e=o;return"XMLHTTP REQ ("+s+") [attempt "+a+"]: "+n+"\n"+i+"\n"+e})}function eU(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function eB(e){e.T=Date.now()+e.H,eq(e,e.H)}function eq(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=eC(y(e.aa,e),t)}function ej(e){e.D&&(p.clearTimeout(e.D),e.D=null)}function e$(e){0==e.j.I||e.K||tG(e.j,e)}function ez(e){ej(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,eu(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function eK(e,t){try{var r=e.j;if(0!=r.I&&(r.g==e||eJ(r.h,e))){if(!e.L&&eJ(r.h,e)&&3==r.I){try{var n=r.Ba.g.parse(t)}catch(e){n=null}if(Array.isArray(n)&&3==n.length){var i=n;if(0==i[0]){e:if(!r.v){if(r.g)if(r.g.F+3e3<e.F)tK(r),tL(r);else break e;tj(r),eT(18)}}else r.xa=i[1],0<r.xa-r.K&&i[2]<37500&&r.F&&0==r.A&&!r.C&&(r.C=eC(y(r.Va,r),6e3));1>=eQ(r.h)&&r.ta&&(r.ta=void 0)}else tW(r,11)}else if((e.L||r.g==e)&&tK(r),!L(t))for(i=r.Ba.g.parse(t),t=0;t<i.length;t++){let o=i[t],l=o[0];if(!(l<=r.K))if(r.K=l,o=o[1],2==r.I)if("c"==o[0]){r.M=o[1],r.ba=o[2];let t=o[3];null!=t&&(r.ka=t,r.j.info("VER="+r.ka));let i=o[4];null!=i&&(r.za=i,r.j.info("SVER="+r.za));let l=o[5];null!=l&&"number"==typeof l&&l>0&&(r.O=n=1.5*l,r.j.info("backChannelRequestTimeoutMs_="+n)),n=r;let u=e.g;if(u){let e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=n.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(eY(s,s.h),s.h=null))}if(n.G){let e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(n.wa=e,e4(n.J,n.G,e))}}if(r.I=3,r.l&&r.l.ra(),r.aa&&(r.T=Date.now()-e.F,r.j.info("Handshake RTT: "+r.T+"ms")),(n=r).na=tJ(n,n.L?n.ba:null,n.W),e.L){eX(n.h,e);var a=n.O;a&&(e.H=a),e.D&&(ej(e),eB(e)),n.g=e}else tq(n);r.i.length>0&&tF(r)}else"stop"!=o[0]&&"close"!=o[0]||tW(r,7);else 3==r.I&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?tW(r,7):tP(r):"noop"!=o[0]&&r.l&&r.l.qa(o),r.A=0)}}eI(4)}catch(e){}}eO.prototype.ba=function(e){e=e.target;let t=this.O;t&&3==tD(e)?t.j():this.Y(e)},eO.prototype.Y=function(e){try{if(e==this.g)e:{let d=tD(this.g),f=this.g.ya(),g=this.g.ca();if(!(d<3)&&(3!=d||this.g&&(this.h.h||this.g.la()||tN(this.g)))){this.K||4!=d||7==f||(8==f||g<=0?eI(3):eI(2)),ej(this);var t=this.g.ca();this.X=t;var r=function(e){if(!eU(e))return e.g.la();let t=tN(e.g);if(""===t)return"";let r="",n=t.length,i=4==tD(e.g);if(!e.h.i){if("u"<typeof TextDecoder)return ez(e),e$(e),"";e.h.i=new p.TextDecoder}for(let s=0;s<n;s++)e.h.h=!0,r+=e.h.i.decode(t[s],{stream:!(i&&s==n-1)});return t.length=0,e.h.g+=r,e.C=0,e.h.g}(this);if(this.o=200==t,n=this.i,i=this.v,s=this.B,a=this.l,o=this.S,n.info(function(){return"XMLHTTP RESP ("+a+") [ attempt "+o+"]: "+i+"\n"+s+"\n"+d+" "+t}),this.o){if(this.U&&!this.L){t:{if(this.g){var n,i,s,a,o,l,u=this.g;if((l=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!L(l)){var h=l;break t}}h=null}if(e=h)ek(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,eK(this,e);else{this.o=!1,this.m=3,eT(12),ez(this),e$(this);break e}}if(this.R){let t;for(e=!0;!this.K&&this.C<r.length;)if((t=function(e,t){var r=e.C,n=t.indexOf("\n",r);return -1==n?eM:isNaN(r=Number(t.substring(r,n)))?eL:(n+=1)+r>t.length?eM:(t=t.slice(n,n+r),e.C=n+r,t)}(this,r))==eM){4==d&&(this.m=4,eT(14),e=!1),ek(this.i,this.l,null,"[Incomplete Response]");break}else if(t==eL){this.m=4,eT(15),ek(this.i,this.l,r,"[Invalid Chunk]"),e=!1;break}else ek(this.i,this.l,t,null),eK(this,t);if(eU(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=r.length||this.h.h||(this.m=1,eT(16),e=!1),this.o=this.o&&e,e){if(r.length>0&&!this.W){this.W=!0;var c=this.j;c.g==this&&c.aa&&!c.P&&(c.j.info("Great, no buffering proxy detected. Bytes received: "+r.length),t$(c),c.P=!0,eT(11))}}else ek(this.i,this.l,r,"[Invalid Chunked Response]"),ez(this),e$(this)}else ek(this.i,this.l,r,null),eK(this,r);4==d&&ez(this),this.o&&!this.K&&(4==d?tG(this.j,this):(this.o=!1,eB(this)))}else(function(e){let t={};e=(e.g&&tD(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let n=0;n<e.length;n++){if(L(e[n]))continue;var r=function(e){var t=1;e=e.split(":");let r=[];for(;t>0&&e.length;)r.push(e.shift()),t--;return e.length&&r.push(e.join(":")),r}(e[n]);let i=r[0];if("string"!=typeof(r=r[1]))continue;r=r.trim();let s=t[i]||[];t[i]=s,s.push(r)}var n=function(e){return e.join(", ")};for(let e in t)n.call(void 0,t[e],e,t)})(this.g),400==t&&r.indexOf("Unknown SID")>0?(this.m=3,eT(12)):(this.m=0,eT(13)),ez(this),e$(this)}}}catch(e){}finally{}},eO.prototype.cancel=function(){this.K=!0,ez(this)},eO.prototype.aa=function(){var e,t;this.D=null;let r=Date.now();r-this.T>=0?(e=this.i,t=this.B,e.info(function(){return"TIMEOUT: "+t}),2!=this.M&&(eI(),eT(17)),ez(this),this.m=2,e$(this)):eq(this,this.T-r)};var eG=class{constructor(e,t){this.g=e,this.map=t}};function eH(e){this.l=e||10,e=p.PerformanceNavigationTiming?(e=p.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(p.chrome&&p.chrome.loadTimes&&p.chrome.loadTimes()&&p.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function eW(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eQ(e){return e.h?1:e.g?e.g.size:0}function eJ(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function eY(e,t){e.g?e.g.add(t):e.h=t}function eX(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function eZ(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let r of e.g.values())t=t.concat(r.G);return t}return _(e.i)}eH.prototype.cancel=function(){if(this.i=eZ(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var e0=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function e1(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof e1?(this.l=e.l,e6(this,e.j),this.o=e.o,this.g=e.g,e3(this,e.u),this.h=e.h,e5(this,td(e.i)),this.m=e.m):e&&(t=String(e).match(e0))?(this.l=!1,e6(this,t[1]||"",!0),this.o=e7(t[2]||""),this.g=e7(t[3]||"",!0),e3(this,t[4]),this.h=e7(t[5]||"",!0),e5(this,t[6]||"",!0),this.m=e7(t[7]||"")):(this.l=!1,this.i=new ta(null,this.l))}function e2(e){return new e1(e)}function e6(e,t,r){e.j=r?e7(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function e3(e,t){if(t){if(isNaN(t=Number(t))||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function e5(e,t,r){var n,i;t instanceof ta?(e.i=t,n=e.i,(i=e.l)&&!n.j&&(to(n),n.i=null,n.g.forEach(function(e,t){let r=t.toLowerCase();t!=r&&(tl(this,t),tc(this,r,e))},n)),n.j=i):(r||(t=e9(t,ti)),e.i=new ta(t,e.l))}function e4(e,t,r){e.i.set(t,r)}function e8(e){return e4(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function e7(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function e9(e,t,r){return"string"==typeof e?(e=encodeURI(e).replace(t,te),r&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function te(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}e1.prototype.toString=function(){let e=[];var t=this.j;t&&e.push(e9(t,tt,!0),":");var r=this.g;return(r||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(e9(t,tt,!0),"@"),e.push(eR(r).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(r=this.u)&&e.push(":",String(r))),(r=this.h)&&(this.g&&"/"!=r.charAt(0)&&e.push("/"),e.push(e9(r,"/"==r.charAt(0)?tn:tr,!0))),(r=this.i.toString())&&e.push("?",r),(r=this.m)&&e.push("#",e9(r,ts)),e.join("")},e1.prototype.resolve=function(e){let t=e2(this),r=!!e.j;r?e6(t,e.j):r=!!e.o,r?t.o=e.o:r=!!e.g,r?t.g=e.g:r=null!=e.u;var n=e.h;if(r)e3(t,e.u);else if(r=!!e.h){if("/"!=n.charAt(0))if(this.g&&!this.h)n="/"+n;else{var i=t.h.lastIndexOf("/");-1!=i&&(n=t.h.slice(0,i+1)+n)}if(".."==(i=n)||"."==i)n="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){n=0==i.lastIndexOf("/",0),i=i.split("/");let e=[];for(let t=0;t<i.length;){let r=i[t++];"."==r?n&&t==i.length&&e.push(""):".."==r?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),n&&t==i.length&&e.push("")):(e.push(r),n=!0)}n=e.join("/")}else n=i}return r?t.h=n:r=""!==e.i.toString(),r?e5(t,td(e.i)):r=!!e.m,r&&(t.m=e.m),t};var tt=/[#\/\?@]/g,tr=/[#\?:]/g,tn=/[#\?]/g,ti=/[#\?@]/g,ts=/#/g;function ta(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function to(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let r=0;r<e.length;r++){let n=e[r].indexOf("="),i,s=null;n>=0?(i=e[r].substring(0,n),s=e[r].substring(n+1)):i=e[r],t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,r){e.add(decodeURIComponent(t.replace(/\+/g," ")),r)}))}function tl(e,t){to(e),t=tf(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tu(e,t){return to(e),t=tf(e,t),e.g.has(t)}function th(e,t){to(e);let r=[];if("string"==typeof t)tu(e,t)&&(r=r.concat(e.g.get(tf(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)r=r.concat(e[t]);return r}function tc(e,t,r){tl(e,t),r.length>0&&(e.i=null,e.g.set(tf(e,t),_(r)),e.h+=r.length)}function td(e){let t=new ta;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function tf(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function tp(e,t,r,n,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),n(r)}catch(e){}}function tg(){this.g=new ed}function tm(e){this.i=e.Sb||null,this.h=e.ab||!1}function ty(e,t){en.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function tw(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function tv(e){e.readyState=4,e.l=null,e.j=null,e.B=null,tb(e)}function tb(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function t_(e){let t="";return q(e,function(e,r){t+=r,t+=":",t+=e,t+="\r\n"}),t}function tI(e,t,r){e:{for(n in r){var n=!1;break e}n=!0}n||(r=t_(r),"string"==typeof e?null!=r&&eR(r):e4(e,t,r))}function tE(e){en.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=ta.prototype).add=function(e,t){to(this),this.i=null,e=tf(this,e);let r=this.g.get(e);return r||this.g.set(e,r=[]),r.push(t),this.h+=1,this},t.forEach=function(e,t){to(this),this.g.forEach(function(r,n){r.forEach(function(r){e.call(t,r,n,this)},this)},this)},t.set=function(e,t){return to(this),this.i=null,tu(this,e=tf(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},t.get=function(e,t){return e&&(e=th(this,e)).length>0?String(e[0]):t},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(let n=0;n<t.length;n++){var r=t[n];let i=eR(r);r=th(this,r);for(let t=0;t<r.length;t++){let n=i;""!==r[t]&&(n+="="+eR(r[t])),e.push(n)}}return this.i=e.join("&")},v(tm,ef),tm.prototype.g=function(){return new ty(this.i,this.h)},v(ty,en),(t=ty.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,tb(this)},t.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||p).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,tv(this)),this.readyState=0},t.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tb(this)),this.g&&(this.readyState=3,tb(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==p.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;tw(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?tv(this):tb(this),3==this.readyState&&tw(this)}},t.Oa=function(e){this.g&&(this.response=this.responseText=e,tv(this))},t.Na=function(e){this.g&&(this.response=e,tv(this))},t.ga=function(){this.g&&tv(this)},t.setRequestHeader=function(e,t){this.A.append(e,t)},t.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var r=t.next();!r.done;)e.push((r=r.value)[0]+": "+r[1]),r=t.next();return e.join("\r\n")},Object.defineProperty(ty.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),v(tE,en);var tT=/^https?$/i,tS=["POST","PUT"];function tC(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,tA(e),tx(e)}function tA(e){e.A||(e.A=!0,ei(e,"complete"),ei(e,"error"))}function tk(e){if(e.h&&void 0!==f){if(e.v&&4==tD(e))setTimeout(e.Ca.bind(e),0);else if(ei(e,"readystatechange"),4==tD(e)){e.h=!1;try{let s=e.ca();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,r,n=!0;break;default:n=!1}if(!(t=n)){if(r=0===s){let t=String(e.D).match(e0)[1]||null;!t&&p.self&&p.self.location&&(t=p.self.location.protocol.slice(0,-1)),r=!tT.test(t?t.toLowerCase():"")}t=r}if(t)ei(e,"complete"),ei(e,"success");else{e.o=6;try{var i=tD(e)>2?e.g.statusText:""}catch(e){i=""}e.l=i+" ["+e.ca()+"]",tA(e)}}finally{tx(e)}}}}function tx(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);let r=e.g;e.g=null,t||ei(e,"ready");try{r.onreadystatechange=null}catch(e){}}}function tD(e){return e.g?e.g.readyState:0}function tN(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tR(e,t,r){return r&&r.internalChannelParams&&r.internalChannelParams[e]||t}function tO(e){this.za=0,this.i=[],this.j=new eA,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=tR("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=tR("baseRetryDelayMs",5e3,e),this.Za=tR("retryDelaySeedMs",1e4,e),this.Ta=tR("forwardChannelMaxRetries",2,e),this.va=tR("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new eH(e&&e.concurrentRequestLimit),this.Ba=new tg,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function tP(e){if(tM(e),3==e.I){var t=e.V++,r=e2(e.J);if(e4(r,"SID",e.M),e4(r,"RID",t),e4(r,"TYPE","terminate"),tU(e,r),(t=new eO(e,e.j,t)).M=2,t.A=e8(e2(r)),r=!1,p.navigator&&p.navigator.sendBeacon)try{r=p.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!r&&p.Image&&((new Image).src=t.A,r=!0),r||(t.g=tY(t.j,null),t.g.ea(t.A)),t.F=Date.now(),eB(t)}tQ(e)}function tL(e){e.g&&(t$(e),e.g.cancel(),e.g=null)}function tM(e){tL(e),e.v&&(p.clearTimeout(e.v),e.v=null),tK(e),e.h.cancel(),e.m&&("number"==typeof e.m&&p.clearTimeout(e.m),e.m=null)}function tF(e){if(!eW(e.h)&&!e.m){e.m=!0;var t=e.Ea;A||D(),k||(A(),k=!0),x.add(t,e),e.D=0}}function tV(e,t){var r;r=t?t.l:e.V++;let n=e2(e.J);e4(n,"SID",e.M),e4(n,"RID",r),e4(n,"AID",e.K),tU(e,n),e.u&&e.o&&tI(n,e.u,e.o),r=new eO(e,e.j,r,e.D+1),null===e.u&&(r.J=e.o),t&&(e.i=t.G.concat(e.i)),t=tB(e,r,1e3),r.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),eY(e.h,r),eF(r,n,t)}function tU(e,t){e.H&&q(e.H,function(e,r){e4(t,r,e)}),e.l&&q({},function(e,r){e4(t,r,e)})}function tB(e,t,r){r=Math.min(e.i.length,r);let n=e.l?y(e.l.Ka,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+r];-1==t?r>0?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let o=!0;for(let l=0;l<r;l++){var s=i[l].g;let r=i[l].map;if((s-=t)<0)t=Math.max(0,i[l].g-100),o=!1;else try{s="req"+s+"_";try{var a=r instanceof Map?r:Object.entries(r);for(let[t,r]of a){let n=r;g(r)&&(n=eh(r)),e.push(s+t+"="+encodeURIComponent(n))}}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}catch(e){n&&n(r)}}if(o){a=e.join("&");break e}}a=void 0}return t.G=e=e.i.splice(0,r),a}function tq(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;A||D(),k||(A(),k=!0),x.add(t,e),e.A=0}}function tj(e){return!e.g&&!e.v&&!(e.A>=3)&&(e.Y++,e.v=eC(y(e.Da,e),tH(e,e.A)),e.A++,!0)}function t$(e){null!=e.B&&(p.clearTimeout(e.B),e.B=null)}function tz(e){e.g=new eO(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=e2(e.na);e4(t,"RID","rpc"),e4(t,"SID",e.M),e4(t,"AID",e.K),e4(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&e4(t,"TO",e.ia),e4(t,"TYPE","xmlhttp"),tU(e,t),e.u&&e.o&&tI(t,e.u,e.o),e.O&&(e.g.H=e.O);var r=e.g;e=e.ba,r.M=1,r.A=e8(e2(t)),r.u=null,r.R=!0,eV(r,e)}function tK(e){null!=e.C&&(p.clearTimeout(e.C),e.C=null)}function tG(e,t){var r,n=null;if(e.g==t){tK(e),t$(e),e.g=null;var i=2}else{if(!eJ(e.h,t))return;n=t.G,eX(e.h,t),i=1}if(0!=e.I){if(t.o)if(1==i){n=t.u?t.u.length:0,t=Date.now()-t.F;var s=e.D;ei(i=eb(),new eS(i,n)),tF(e)}else tq(e);else if(3==(s=t.m)||0==s&&t.X>0||!(1==i&&(r=t,!(eQ(e.h)>=e.h.j-!!e.m)&&(e.m?(e.i=r.G.concat(e.i),!0):1!=e.I&&2!=e.I&&!(e.D>=(e.Sa?0:e.Ta))&&(e.m=eC(y(e.Ea,e,r),tH(e,e.D)),e.D++,!0)))||2==i&&tj(e)))switch(n&&n.length>0&&((t=e.h).i=t.i.concat(n)),s){case 1:tW(e,5);break;case 4:tW(e,10);break;case 3:tW(e,6);break;default:tW(e,2)}}}function tH(e,t){let r=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(r*=2),r*t}function tW(e,t){if(e.j.info("Error code "+t),2==t){let t,s,a;var r,n=y(e.bb,e),i=e.Ua;let o=!i;i=new e1(i||"//www.google.com/images/cleardot.gif"),p.location&&"http"==p.location.protocol||e6(i,"https"),e8(i),o?function(e,t){let r=new eA;if(p.Image){let n=new Image;n.onload=w(tp,r,"TestLoadImage: loaded",!0,t,n),n.onerror=w(tp,r,"TestLoadImage: error",!1,t,n),n.onabort=w(tp,r,"TestLoadImage: abort",!1,t,n),n.ontimeout=w(tp,r,"TestLoadImage: timeout",!1,t,n),p.setTimeout(function(){n.ontimeout&&n.ontimeout()},1e4),n.src=e}else t(!1)}(i.toString(),n):(r=i.toString(),t=new eA,s=new AbortController,a=setTimeout(()=>{s.abort(),tp(t,"TestPingServer: timeout",!1,n)},1e4),fetch(r,{signal:s.signal}).then(e=>{clearTimeout(a),e.ok?tp(t,"TestPingServer: ok",!0,n):tp(t,"TestPingServer: server error",!1,n)}).catch(()=>{clearTimeout(a),tp(t,"TestPingServer: error",!1,n)}))}else eT(2);e.I=0,e.l&&e.l.pa(t),tQ(e),tM(e)}function tQ(e){if(e.I=0,e.ja=[],e.l){let t=eZ(e.h);(0!=t.length||0!=e.i.length)&&(I(e.ja,t),I(e.ja,e.i),e.h.i.length=0,_(e.i),e.i.length=0),e.l.oa()}}function tJ(e,t,r){var n=r instanceof e1?e2(r):new e1(r);if(""!=n.g)t&&(n.g=t+"."+n.g),e3(n,n.u);else{var i=p.location;n=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;let e=new e1(null);n&&e6(e,n),t&&(e.g=t),i&&e3(e,i),r&&(e.h=r),n=e}return r=e.G,t=e.wa,r&&t&&e4(n,r,t),e4(n,"VER",e.ka),tU(e,n),n}function tY(e,t,r){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tE(e.Aa&&!e.ma?new tm({ab:r}):e.ma)).Fa(e.L),t}function tX(){}function tZ(){}function t0(e,t){en.call(this),this.g=new tO(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!L(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!L(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t6(this)}function t1(e){em.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let r in t){e=r;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t2(){ey.call(this),this.status=1}function t6(e){this.g=e}(t=tE.prototype).Fa=function(e){this.H=e},t.ea=function(t,r,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);r=r?r.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():e.g(),this.g.onreadystatechange=b(y(this.Ca,this));try{this.B=!0,this.g.open(r,String(t),!0),this.B=!1}catch(e){tC(this,e);return}if(t=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)n.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())n.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[e,a]of(i=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=p.FormData&&t instanceof p.FormData,!(Array.prototype.indexOf.call(tS,r,void 0)>=0)||i||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n))this.g.setRequestHeader(e,a);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(e){tC(this,e)}},t.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,ei(this,"complete"),ei(this,"abort"),tx(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tx(this,!0)),tE.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?tk(this):this.Xa())},t.Xa=function(){tk(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return tD(this)>2?this.g.status:-1}catch(e){return -1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},t.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),ec(t)}},t.ya=function(){return this.o},t.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=tO.prototype).ka=8,t.I=1,t.connect=function(e,t,r,n){eT(0),this.W=e,this.H=t||{},r&&void 0!==n&&(this.H.OSID=r,this.H.OAID=n),this.F=this.X,this.J=tJ(this,null,this.W),tF(this)},t.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;let i=new eO(this,this.j,e),s=this.o;if(this.U&&(s?z(s=j(s),this.U):s=this.U),null!==this.u||this.R||(i.J=s,s=null),this.S)e:{for(var t=0,r=0;r<this.i.length;r++){t:{var n=this.i[r];if("__data__"in n.map&&"string"==typeof(n=n.map.__data__)){n=n.length;break t}n=void 0}if(void 0===n)break;if((t+=n)>4096){t=r;break e}if(4096===t||r===this.i.length-1){t=r+1;break e}}t=1e3}else t=1e3;t=tB(this,i,t),e4(r=e2(this.J),"RID",e),e4(r,"CVER",22),this.G&&e4(r,"X-HTTP-Session-Id",this.G),tU(this,r),s&&(this.R?t="headers="+eR(t_(s))+"&"+t:this.u&&tI(r,this.u,s)),eY(this.h,i),this.Ra&&e4(r,"TYPE","init"),this.S?(e4(r,"$req",t),e4(r,"SID","null"),i.U=!0,eF(i,r,null)):eF(i,r,t),this.I=2}}else 3==this.I&&(e?tV(this,e):0==this.i.length||eW(this.h)||tV(this))},t.Da=function(){if(this.v=null,tz(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=eC(y(this.Wa,this),e)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,eT(10),tL(this),tz(this))},t.Va=function(){null!=this.C&&(this.C=null,tL(this),tj(this),eT(19))},t.bb=function(e){e?(this.j.info("Successfully pinged google.com"),eT(2)):(this.j.info("Failed to ping google.com"),eT(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=tX.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},tZ.prototype.g=function(e,t){return new t0(e,t)},v(t0,en),t0.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},t0.prototype.close=function(){tP(this.g)},t0.prototype.o=function(e){var t=this.g;if("string"==typeof e){var r={};r.__data__=e,e=r}else this.v&&((r={}).__data__=eh(e),e=r);t.i.push(new eG(t.Ya++,e)),3==t.I&&tF(t)},t0.prototype.N=function(){this.g.l=null,delete this.j,tP(this.g),delete this.g,t0.Z.N.call(this)},v(t1,em),v(t2,ey),v(t6,tX),t6.prototype.ra=function(){ei(this.g,"a")},t6.prototype.qa=function(e){ei(this.g,new t1(e))},t6.prototype.pa=function(e){ei(this.g,new t2)},t6.prototype.oa=function(){ei(this.g,"b")},tZ.prototype.createWebChannel=tZ.prototype.g,t0.prototype.send=t0.prototype.o,t0.prototype.open=t0.prototype.m,t0.prototype.close=t0.prototype.close,h=T.createWebChannelTransport=function(){return new tZ},u=T.getStatEventTarget=function(){return eb()},l=T.Event=ew,o=T.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ex.NO_ERROR=0,ex.TIMEOUT=8,ex.HTTP_ERROR=6,a=T.ErrorCode=ex,eD.COMPLETE="complete",s=T.EventType=eD,ep.EventType=eg,eg.OPEN="a",eg.CLOSE="b",eg.ERROR="c",eg.MESSAGE="d",en.prototype.listen=en.prototype.J,i=T.WebChannel=ep,T.FetchXmlHttpFactory=tm,tE.prototype.listenOnce=tE.prototype.K,tE.prototype.getLastError=tE.prototype.Ha,tE.prototype.getLastErrorCode=tE.prototype.ya,tE.prototype.getStatus=tE.prototype.ca,tE.prototype.getResponseJson=tE.prototype.La,tE.prototype.getResponseText=tE.prototype.la,tE.prototype.send=tE.prototype.ea,tE.prototype.setWithCredentials=tE.prototype.Fa,n=T.XhrIo=tE}).apply(void 0!==E?E:"u">typeof self?self:"u">typeof window?window:{});class S{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}S.UNAUTHENTICATED=new S(null),S.GOOGLE_CREDENTIALS=new S("google-credentials-uid"),S.FIRST_PARTY=new S("first-party-uid"),S.MOCK_USER=new S("mock-user");let C="12.9.0",A=new I.Logger("@firebase/firestore");function k(){return A.logLevel}function x(e,...t){if(A.logLevel<=I.LogLevel.DEBUG){let r=t.map(R);A.debug(`Firestore (${C}): ${e}`,...r)}}function D(e,...t){if(A.logLevel<=I.LogLevel.ERROR){let r=t.map(R);A.error(`Firestore (${C}): ${e}`,...r)}}function N(e,...t){if(A.logLevel<=I.LogLevel.WARN){let r=t.map(R);A.warn(`Firestore (${C}): ${e}`,...r)}}function R(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function O(e,t,r){let n="Unexpected state";"string"==typeof t?n=t:r=t,P(e,n,r)}function P(e,t,r){let n=`FIRESTORE (${C}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==r)try{n+=" CONTEXT: "+JSON.stringify(r)}catch(e){n+=" CONTEXT: "+r}throw D(n),Error(n)}function L(e,t,r,n){let i="Unexpected state";"string"==typeof r?i=r:n=r,e||P(t,i,n)}let M={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class F extends v.FirebaseError{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class V{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class U{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class B{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(S.UNAUTHENTICATED))}shutdown(){}}class q{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class j{constructor(e){this.t=e,this.currentUser=S.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){L(void 0===this.o,42304);let r=this.i,n=e=>this.i!==r?(r=this.i,t(e)):Promise.resolve(),i=new V;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new V,e.enqueueRetryable(()=>n(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},a=e=>{x("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(x("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new V)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(x("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(L("string"==typeof t.accessToken,31837,{l:t}),new U(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return L(null===e||"string"==typeof e,2055,{h:e}),new S(e)}}class ${constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=S.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);let e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class z{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new $(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(S.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class K{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class G{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,(0,g._isFirebaseServerApp)(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){L(void 0===this.o,3512);let r=e=>{null!=e.error&&x("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let r=e.token!==this.m;return this.m=e.token,x("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>r(t))};let n=e=>{x("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?n(e):x("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new K(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(L("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new K(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class H{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let r=function(e){let t="u">typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(r);else for(let e=0;e<40;e++)r[e]=Math.floor(256*Math.random());return r}(0);for(let n=0;n<r.length;++n)t.length<20&&r[n]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(r[n]%62))}return t}}function W(e,t){return e<t?-1:+(e>t)}function Q(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=e.charAt(n),i=t.charAt(n);if(r!==i)return J(r)===J(i)?W(r,i):J(r)?1:-1}return W(e.length,t.length)}function J(e){let t=e.charCodeAt(0);return t>=55296&&t<=57343}function Y(e,t,r){return e.length===t.length&&e.every((e,n)=>r(e,t[n]))}let X="__name__";class Z{constructor(e,t,r){void 0===t?t=0:t>e.length&&O(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&O(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===Z.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof Z?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=Z.compareSegments(e.get(n),t.get(n));if(0!==r)return r}return W(e.length,t.length)}static compareSegments(e,t){let r=Z.isNumericId(e),n=Z.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?Z.extractNumericId(e).compare(Z.extractNumericId(t)):Q(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return t.fromString(e.substring(4,e.length-2))}}class ee extends Z{construct(e,t,r){return new ee(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new F(M.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>e.length>0))}return new ee(t)}static emptyPath(){return new ee([])}}let et=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class er extends Z{construct(e,t,r){return new er(e,t,r)}static isValidIdentifier(e){return et.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),er.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===X}static keyField(){return new er([X])}static fromServerFormat(e){let t=[],r="",n=0,i=()=>{if(0===r.length)throw new F(M.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},s=!1;for(;n<e.length;){let t=e[n];if("\\"===t){if(n+1===e.length)throw new F(M.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new F(M.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?s=!s:"."!==t||s?r+=t:i(),n++}if(i(),s)throw new F(M.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new er(t)}static emptyPath(){return new er([])}}class en{constructor(e){this.path=e}static fromPath(e){return new en(ee.fromString(e))}static fromName(e){return new en(ee.fromString(e).popFirst(5))}static empty(){return new en(ee.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ee.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ee.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new en(new ee(e.slice()))}}function ei(e){if(!en.isDocumentKey(e))throw new F(M.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function es(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function ea(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let r=(t=e).constructor?t.constructor.name:null;return r?`a custom ${r} object`:"an object"}}return"function"==typeof e?"a function":O(12329,{type:typeof e})}function eo(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new F(M.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let r=ea(e);throw new F(M.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${r}`)}}return e}function el(e,t){if(t<=0)throw new F(M.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}function eu(e,t){let r={typeString:e};return t&&(r.value=t),r}function eh(e,t){let r;if(!es(e))throw new F(M.INVALID_ARGUMENT,"JSON must be an object");for(let n in t)if(t[n]){let i=t[n].typeString,s="value"in t[n]?{value:t[n].value}:void 0;if(!(n in e)){r=`JSON missing required field: '${n}'`;break}let a=e[n];if(i&&typeof a!==i){r=`JSON field '${n}' must be a ${i}.`;break}if(void 0!==s&&a!==s.value){r=`Expected '${n}' field to equal '${s.value}'`;break}}if(r)throw new F(M.INVALID_ARGUMENT,r);return!0}class ec{static now(){return ec.fromMillis(Date.now())}static fromDate(e){return ec.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*1e6);return new ec(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new F(M.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new F(M.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?W(this.nanoseconds,e.nanoseconds):W(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ec._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(eh(e,ec._jsonSchema))return new ec(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ec._jsonSchemaVersion="firestore/timestamp/1.0",ec._jsonSchema={type:eu("string",ec._jsonSchemaVersion),seconds:eu("number"),nanoseconds:eu("number")};class ed{static fromTimestamp(e){return new ed(e)}static min(){return new ed(new ec(0,0))}static max(){return new ed(new ec(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ef{constructor(e,t,r,n){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=n}}function ep(e){return e.fields.find(e=>2===e.kind)}function eg(e){return e.fields.filter(e=>2!==e.kind)}function em(e,t){let r=W(e.collectionGroup,t.collectionGroup);if(0!==r)return r;for(let n=0;n<Math.min(e.fields.length,t.fields.length);++n)if(0!==(r=function(e,t){let r=er.comparator(e.fieldPath,t.fieldPath);return 0!==r?r:W(e.kind,t.kind)}(e.fields[n],t.fields[n])))return r;return W(e.fields.length,t.fields.length)}ef.UNKNOWN_ID=-1;class ey{constructor(e,t){this.fieldPath=e,this.kind=t}}class ew{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new ew(0,e_.min())}}function ev(e,t){let r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1;return new e_(ed.fromTimestamp(1e9===n?new ec(r+1,0):new ec(r,n)),en.empty(),t)}function eb(e){return new e_(e.readTime,e.key,-1)}class e_{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new e_(ed.min(),en.empty(),-1)}static max(){return new e_(ed.max(),en.empty(),-1)}}function eI(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r||0!==(r=en.comparator(e.documentKey,t.documentKey))?r:W(e.largestBatchId,t.largestBatchId)}let eE="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class eT{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function eS(e){if(e.code!==M.FAILED_PRECONDITION||e.message!==eE)throw e;x("LocalStore","Unexpectedly lost primary lease")}class eC{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&O(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new eC((r,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof eC?t:eC.resolve(t)}catch(e){return eC.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):eC.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):eC.reject(t)}static resolve(e){return new eC((t,r)=>{t(e)})}static reject(e){return new eC((t,r)=>{r(e)})}static waitFor(e){return new eC((t,r)=>{let n=0,i=0,s=!1;e.forEach(e=>{++n,e.next(()=>{++i,s&&i===n&&t()},e=>r(e))}),s=!0,i===n&&t()})}static or(e){let t=eC.resolve(!1);for(let r of e)t=t.next(e=>e?eC.resolve(e):r());return t}static forEach(e,t){let r=[];return e.forEach((e,n)=>{r.push(t.call(this,e,n))}),this.waitFor(r)}static mapArray(e,t){return new eC((r,n)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&r(s)},e=>n(e))}})}static doWhile(e,t){return new eC((r,n)=>{let i=()=>{!0===e()?t().next(()=>{i()},n):r()};i()})}}let eA="SimpleDb";class ek{static open(e,t,r,n){try{return new ek(t,e.transaction(n,r))}catch(e){throw new eR(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new V,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new eR(e,t.error)):this.S.resolve()},this.transaction.onerror=t=>{let r=eF(t.target.error);this.S.reject(new eR(e,r))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(x(eA,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new eP(this.transaction.objectStore(e))}}class ex{static delete(e){return x(eA,"Removing database:",e),eL((0,v.getGlobal)().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!(0,v.isIndexedDBAvailable)())return!1;if(ex.F())return!0;let e=(0,v.getUA)(),t=ex.M(e),r=eD(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<r&&r<4.5)}static F(){return void 0!==y.default&&"YES"===y.default.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE}static O(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,12.2===ex.M((0,v.getUA)())&&D("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(x(eA,"Opening database:",this.name),this.db=await new Promise((t,r)=>{let n=indexedDB.open(this.name,this.version);n.onsuccess=e=>{t(e.target.result)},n.onblocked=()=>{r(new eR(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},n.onerror=t=>{let n=t.target.error;"VersionError"===n.name?r(new F(M.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new F(M.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new eR(e,n))},n.onupgradeneeded=e=>{x(eA,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.N.k(t,n.transaction,e.oldVersion,this.version).next(()=>{x(eA,"Database upgrade to version "+this.version+" complete")})}})),this.K&&(this.db.onversionchange=e=>this.K(e)),this.db}q(e){this.K=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,n){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.L(e);let t=ek.open(this.db,e,i?"readonly":"readwrite",r),s=n(t).next(e=>(t.C(),e)).catch(e=>(t.abort(e),eC.reject(e))).toPromise();return s.catch(()=>{}),await t.D,s}catch(t){let e="FirebaseError"!==t.name&&s<3;if(x(eA,"Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function eD(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class eN{constructor(e){this.U=e,this.$=!1,this.W=null}get isDone(){return this.$}get G(){return this.W}set cursor(e){this.U=e}done(){this.$=!0}j(e){this.W=e}delete(){return eL(this.U.delete())}}class eR extends F{constructor(e,t){super(M.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function eO(e){return"IndexedDbTransactionError"===e.name}class eP{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(x(eA,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(x(eA,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),eL(r)}add(e){return x(eA,"ADD",this.store.name,e,e),eL(this.store.add(e))}get(e){return eL(this.store.get(e)).next(t=>(void 0===t&&(t=null),x(eA,"GET",this.store.name,e,t),t))}delete(e){return x(eA,"DELETE",this.store.name,e),eL(this.store.delete(e))}count(){return x(eA,"COUNT",this.store.name),eL(this.store.count())}H(e,t){let r=this.options(e,t),n=r.index?this.store.index(r.index):this.store;if("function"==typeof n.getAll){let e=n.getAll(r.range);return new eC((t,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(r),t=[];return this.J(e,(e,r)=>{t.push(r)}).next(()=>t)}}Z(e,t){let r=this.store.getAll(e,null===t?void 0:t);return new eC((e,t)=>{r.onerror=e=>{t(e.target.error)},r.onsuccess=t=>{e(t.target.result)}})}X(e,t){x(eA,"DELETE ALL",this.store.name);let r=this.options(e,t);r.Y=!1;let n=this.cursor(r);return this.J(n,(e,t,r)=>r.delete())}ee(e,t){let r;t?r=e:(r={},t=e);let n=this.cursor(r);return this.J(n,t)}te(e){let t=this.cursor({});return new eC((r,n)=>{t.onerror=e=>{n(eF(e.target.error))},t.onsuccess=t=>{let n=t.target.result;n?e(n.primaryKey,n.value).next(e=>{e?n.continue():r()}):r()}})}J(e,t){let r=[];return new eC((n,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void n();let s=new eN(i),a=t(i.primaryKey,i.value,s);if(a instanceof eC){let e=a.catch(e=>(s.done(),eC.reject(e)));r.push(e)}s.isDone?n():null===s.G?i.continue():i.continue(s.G)}}).next(()=>eC.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.Y?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function eL(e){return new eC((t,r)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{r(eF(e.target.error))}})}let eM=!1;function eF(e){let t=ex.M((0,v.getUA)());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new F("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return eM||(eM=!0,setTimeout(()=>{throw e},0)),e}}return e}let eV="IndexBackfiller";class eU{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}re(e){x(eV,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.ne.ie();x(eV,`Documents written: ${e}`)}catch(e){eO(e)?x(eV,"Ignoring IndexedDB error during index backfill: ",e):await eS(e)}await this.re(6e4)})}}class eB{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){let r=new Set,n=t,i=!0;return eC.doWhile(()=>!0===i&&n>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!r.has(t))return x(eV,`Processing collection: ${t}`),this.oe(e,t,n).next(e=>{n-=e,r.add(t)});i=!1})).next(()=>t-n)}oe(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(n=>this.localStore.localDocuments.getNextDocuments(e,t,n,r).next(r=>{let i=r.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this._e(n,r)).next(r=>(x(eV,`Updating offset: ${r}`),this.localStore.indexManager.updateCollectionGroup(e,t,r))).next(()=>i.size)}))}_e(e,t){let r=e;return t.changes.forEach((e,t)=>{let n=eb(t);eI(n,r)>0&&(r=n)}),new e_(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class eq{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}function ej(e){return null==e}function e$(e){return 0===e&&1/e==-1/0}function ez(e){return"number"==typeof e&&Number.isInteger(e)&&!e$(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function eK(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let r=t,n=e.length;for(let t=0;t<n;t++){let n=e.charAt(t);switch(n){case"\0":r+="\x01\x10";break;case"\x01":r+="\x01\x11";break;default:r+=n}}return r}(e.get(r),t);return t+"\x01\x01"}eq.ce=-1;function eG(e){let t=e.length;if(L(t>=2,64408,{path:e}),2===t)return L("\x01"===e.charAt(0)&&"\x01"===e.charAt(1),56145,{path:e}),ee.emptyPath();let r=t-2,n=[],i="";for(let s=0;s<t;){let t=e.indexOf("\x01",s);switch((t<0||t>r)&&O(50515,{path:e}),e.charAt(t+1)){case"\x01":let a,o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),n.push(a);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:O(61167,{path:e})}s=t+2}return new ee(n)}let eH="remoteDocuments",eW="owner",eQ="owner",eJ="mutationQueues",eY="mutations",eX="batchId",eZ="userMutationsIndex",e0=["userId","batchId"],e1={},e2="documentMutations",e6="remoteDocumentsV14",e3=["prefixPath","collectionGroup","readTime","documentId"],e5="documentKeyIndex",e4=["prefixPath","collectionGroup","documentId"],e8="collectionGroupIndex",e7=["collectionGroup","readTime","prefixPath","documentId"],e9="remoteDocumentGlobal",te="remoteDocumentGlobalKey",tt="targets",tr="queryTargetsIndex",tn=["canonicalId","targetId"],ti="targetDocuments",ts=["targetId","path"],ta="documentTargetsIndex",to=["path","targetId"],tl="targetGlobalKey",tu="targetGlobal",th="collectionParents",tc=["collectionId","parent"],td="clientMetadata",tf="bundles",tp="namedQueries",tg="indexConfiguration",tm="collectionGroupIndex",ty="indexState",tw=["indexId","uid"],tv="sequenceNumberIndex",tb=["uid","sequenceNumber"],t_="indexEntries",tI=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],tE="documentKeyIndex",tT=["indexId","uid","orderedDocumentKey"],tS="documentOverlays",tC=["userId","collectionPath","documentId"],tA="collectionPathOverlayIndex",tk=["userId","collectionPath","largestBatchId"],tx="collectionGroupOverlayIndex",tD=["userId","collectionGroup","largestBatchId"],tN="globals",tR=[eJ,eY,e2,eH,tt,eW,tu,ti,td,e9,th,tf,tp],tO=[...tR,tS],tP=[eJ,eY,e2,e6,tt,eW,tu,ti,td,e9,th,tf,tp,tS],tL=[...tP,tg,ty,t_],tM=[...tL,tN];class tF extends eT{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function tV(e,t){return ex.O(e.le,t)}function tU(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function tB(e,t){for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function tq(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class tj{constructor(e,t){this.comparator=e,this.root=t||tz.EMPTY}insert(e,t){return new tj(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,tz.BLACK,null,null))}remove(e){return new tj(this.comparator,this.root.remove(e,this.comparator).copy(null,null,tz.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let n=this.comparator(e,r.key);if(0===n)return t+r.left.size;n<0?r=r.left:(t+=r.left.size+1,r=r.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new t$(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new t$(this.root,e,this.comparator,!1)}getReverseIterator(){return new t$(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new t$(this.root,e,this.comparator,!0)}}class t${constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class tz{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:tz.RED,this.left=null!=n?n:tz.EMPTY,this.right=null!=i?i:tz.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,i){return new tz(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this,i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return tz.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r,n=this;if(0>t(e,n.key))n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key)){if(n.right.isEmpty())return tz.EMPTY;r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,tz.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,tz.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw O(43730,{key:this.key,value:this.value});if(this.right.isRed())throw O(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw O(27949);return e+ +!this.isRed()}}tz.EMPTY=null,tz.RED=!0,tz.BLACK=!1,tz.EMPTY=new class{constructor(){this.size=0}get key(){throw O(57766)}get value(){throw O(16141)}get color(){throw O(16727)}get left(){throw O(29726)}get right(){throw O(36894)}copy(e,t,r,n,i){return this}insert(e,t,r){return new tz(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class tK{constructor(e){this.comparator=e,this.data=new tj(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let n=r.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new tG(this.data.getIterator())}getIteratorFrom(e){return new tG(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof tK)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new tK(this.comparator);return t.data=e,t}}class tG{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function tH(e){return e.hasNext()?e.getNext():void 0}class tW{constructor(e){this.fields=e,e.sort(er.comparator)}static empty(){return new tW([])}unionWith(e){let t=new tK(er.comparator);for(let e of this.fields)t=t.add(e);for(let r of e)t=t.add(r);return new tW(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Y(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class tQ extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class tJ{constructor(e){this.binaryString=e}static fromBase64String(e){return new tJ(function(e){try{return atob(e)}catch(e){throw"u">typeof DOMException&&e instanceof DOMException?new tQ("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new tJ(function(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return W(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}tJ.EMPTY_BYTE_STRING=new tJ("");let tY=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function tX(e){if(L(!!e,39018),"string"==typeof e){let t=0,r=tY.exec(e);if(L(!!r,46558,{timestamp:e}),r[1]){let e=r[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:tZ(e.seconds),nanos:tZ(e.nanos)}}function tZ(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function t0(e){return"string"==typeof e?tJ.fromBase64String(e):tJ.fromUint8Array(e)}let t1="server_timestamp",t2="__type__",t6="__previous_value__",t3="__local_write_time__";function t5(e){return(e?.mapValue?.fields||{})[t2]?.stringValue===t1}function t4(e){let t=e.mapValue.fields[t6];return t5(t)?t4(t):t}function t8(e){let t=tX(e.mapValue.fields[t3].timestampValue);return new ec(t.seconds,t.nanos)}class t7{constructor(e,t,r,n,i,s,a,o,l,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=u,this.apiKey=h}}let t9="(default)";class re{constructor(e,t){this.projectId=e,this.database=t||t9}static empty(){return new re("","")}get isDefaultDatabase(){return this.database===t9}isEqual(e){return e instanceof re&&e.projectId===this.projectId&&e.database===this.database}}let rt="__type__",rr="__max__",rn={mapValue:{fields:{__type__:{stringValue:rr}}}},ri="__vector__",rs="value",ra={nullValue:"NULL_VALUE"};function ro(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?t5(e)?4:rI(e)?0x1fffffffffffff:rb(e)?10:11:O(28295,{value:e})}function rl(e,t){if(e===t)return!0;let r=ro(e);if(r!==ro(t))return!1;switch(r){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return t8(e).isEqual(t8(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let n=tX(e.timestampValue),i=tX(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return t0(e.bytesValue).isEqual(t0(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return tZ(e.geoPointValue.latitude)===tZ(t.geoPointValue.latitude)&&tZ(e.geoPointValue.longitude)===tZ(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return tZ(e.integerValue)===tZ(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let r=tZ(e.doubleValue),n=tZ(t.doubleValue);return r===n?e$(r)===e$(n):isNaN(r)&&isNaN(n)}return!1;case 9:return Y(e.arrayValue.values||[],t.arrayValue.values||[],rl);case 10:case 11:let s=e.mapValue.fields||{},a=t.mapValue.fields||{};if(tU(s)!==tU(a))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===a[e]||!rl(s[e],a[e])))return!1;return!0;default:return O(52216,{left:e})}}function ru(e,t){return void 0!==(e.values||[]).find(e=>rl(e,t))}function rh(e,t){var r,n,i,s,a,o;if(e===t)return 0;let l=ro(e),u=ro(t);if(l!==u)return W(l,u);switch(l){case 0:case 0x1fffffffffffff:return 0;case 1:return W(e.booleanValue,t.booleanValue);case 2:let h,c;return h=tZ(e.integerValue||e.doubleValue),h<(c=tZ(t.integerValue||t.doubleValue))?-1:h>c?1:h===c?0:isNaN(h)?isNaN(c)?0:-1:1;case 3:return rc(e.timestampValue,t.timestampValue);case 4:return rc(t8(e),t8(t));case 5:return Q(e.stringValue,t.stringValue);case 6:let d,f;return r=e.bytesValue,n=t.bytesValue,d=t0(r),f=t0(n),d.compareTo(f);case 7:return function(e,t){let r=e.split("/"),n=t.split("/");for(let e=0;e<r.length&&e<n.length;e++){let t=W(r[e],n[e]);if(0!==t)return t}return W(r.length,n.length)}(e.referenceValue,t.referenceValue);case 8:let p;return i=e.geoPointValue,s=t.geoPointValue,0!==(p=W(tZ(i.latitude),tZ(s.latitude)))?p:W(tZ(i.longitude),tZ(s.longitude));case 9:return rd(e.arrayValue,t.arrayValue);case 10:let g,m,y,w,v;return a=e.mapValue,o=t.mapValue,g=a.fields||{},m=o.fields||{},y=g[rs]?.arrayValue,w=m[rs]?.arrayValue,0!==(v=W(y?.values?.length||0,w?.values?.length||0))?v:rd(y,w);case 11:return function(e,t){if(e===rn.mapValue&&t===rn.mapValue)return 0;if(e===rn.mapValue)return 1;if(t===rn.mapValue)return -1;let r=e.fields||{},n=Object.keys(r),i=t.fields||{},s=Object.keys(i);n.sort(),s.sort();for(let e=0;e<n.length&&e<s.length;++e){let t=Q(n[e],s[e]);if(0!==t)return t;let a=rh(r[n[e]],i[s[e]]);if(0!==a)return a}return W(n.length,s.length)}(e.mapValue,t.mapValue);default:throw O(23264,{he:l})}}function rc(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return W(e,t);let r=tX(e),n=tX(t),i=W(r.seconds,n.seconds);return 0!==i?i:W(r.nanos,n.nanos)}function rd(e,t){let r=e.values||[],n=t.values||[];for(let e=0;e<r.length&&e<n.length;++e){let t=rh(r[e],n[e]);if(t)return t}return W(r.length,n.length)}function rf(e){var t,r;let n;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(n=tX(e.timestampValue),`time(${n.seconds},${n.nanos})`):"stringValue"in e?e.stringValue:"bytesValue"in e?t0(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,en.fromName(t).toString()):"geoPointValue"in e?(r=e.geoPointValue,`geo(${r.latitude},${r.longitude})`):"arrayValue"in e?function(e){let t="[",r=!0;for(let n of e.values||[])r?r=!1:t+=",",t+=rf(n);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),r="{",n=!0;for(let i of t)n?n=!1:r+=",",r+=`${i}:${rf(e.fields[i])}`;return r+"}"}(e.mapValue):O(61005,{value:e})}function rp(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function rg(e){return!!e&&"integerValue"in e}function rm(e){return!!e&&"arrayValue"in e}function ry(e){return!!e&&"nullValue"in e}function rw(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function rv(e){return!!e&&"mapValue"in e}function rb(e){return(e?.mapValue?.fields||{})[rt]?.stringValue===ri}function r_(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return tB(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=r_(r)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=r_(e.arrayValue.values[r]);return t}return{...e}}function rI(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===rr}let rE={mapValue:{fields:{[rt]:{stringValue:ri},[rs]:{arrayValue:{}}}}};function rT(e,t){let r=rh(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function rS(e,t){let r=rh(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class rC{constructor(e){this.value=e}static empty(){return new rC({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(!rv(t=(t.mapValue.fields||{})[e.get(r)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=r_(t)}setAll(e){let t=er.emptyPath(),r={},n=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,r,n),r={},n=[],t=i.popLast()}e?r[i.lastSegment()]=r_(e):n.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,r,n)}delete(e){let t=this.field(e.popLast());rv(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return rl(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let n=t.mapValue.fields[e.get(r)];rv(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,r){for(let n of(tB(t,(t,r)=>e[t]=r),r))delete e[n]}clone(){return new rC(r_(this.value))}}class rA{constructor(e,t,r,n,i,s,a){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new rA(e,0,ed.min(),ed.min(),ed.min(),rC.empty(),0)}static newFoundDocument(e,t,r,n){return new rA(e,1,t,ed.min(),r,n,0)}static newNoDocument(e,t){return new rA(e,2,t,ed.min(),ed.min(),rC.empty(),0)}static newUnknownDocument(e,t){return new rA(e,3,t,ed.min(),ed.min(),rC.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(ed.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=rC.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=rC.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ed.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof rA&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new rA(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class rk{constructor(e,t){this.position=e,this.inclusive=t}}function rx(e,t,r){let n=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(n=s.field.isKeyField()?en.comparator(en.fromName(a.referenceValue),r.key):rh(a,r.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function rD(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!rl(e.position[r],t.position[r]))return!1;return!0}class rN{constructor(e,t="asc"){this.field=e,this.dir=t}}class rR{}class rO extends rR{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new rB(e,t,r):"array-contains"===t?new rz(e,r):"in"===t?new rK(e,r):"not-in"===t?new rG(e,r):"array-contains-any"===t?new rH(e,r):new rO(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new rq(e,r):new rj(e,r)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(rh(t,this.value)):null!==t&&ro(this.value)===ro(t)&&this.matchesComparison(rh(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return O(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class rP extends rR{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new rP(e,t)}matches(e){return rL(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function rL(e){return"and"===e.op}function rM(e){return"or"===e.op}function rF(e){return rV(e)&&rL(e)}function rV(e){for(let t of e.filters)if(t instanceof rP)return!1;return!0}function rU(e,t){let r=e.filters.concat(t);return rP.create(r,e.op)}class rB extends rO{constructor(e,t,r){super(e,t,r),this.key=en.fromName(r.referenceValue)}matches(e){let t=en.comparator(e.key,this.key);return this.matchesComparison(t)}}class rq extends rO{constructor(e,t){super(e,"in",t),this.keys=r$("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class rj extends rO{constructor(e,t){super(e,"not-in",t),this.keys=r$("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function r$(e,t){return(t.arrayValue?.values||[]).map(e=>en.fromName(e.referenceValue))}class rz extends rO{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return rm(t)&&ru(t.arrayValue,this.value)}}class rK extends rO{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&ru(this.value.arrayValue,t)}}class rG extends rO{constructor(e,t){super(e,"not-in",t)}matches(e){if(ru(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!ru(this.value.arrayValue,t)}}class rH extends rO{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!rm(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>ru(this.value.arrayValue,e))}}class rW{constructor(e,t=null,r=[],n=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=i,this.startAt=s,this.endAt=a,this.Te=null}}function rQ(e,t=null,r=[],n=[],i=null,s=null,a=null){return new rW(e,t,r,n,i,s,a)}function rJ(e){if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof rO)return t.field.canonicalString()+t.op.toString()+rf(t.value);if(rF(t))return t.filters.map(t=>e(t)).join(",");{let r=t.filters.map(t=>e(t)).join(",");return`${t.op}(${r})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),ej(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>rf(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>rf(e)).join(",")),e.Te=t}return e.Te}function rY(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var r,n;if(r=e.orderBy[i],n=t.orderBy[i],!(r.dir===n.dir&&r.field.isEqual(n.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!function e(t,r){return t instanceof rO?r instanceof rO&&t.op===r.op&&t.field.isEqual(r.field)&&rl(t.value,r.value):t instanceof rP?r instanceof rP&&t.op===r.op&&t.filters.length===r.filters.length&&t.filters.reduce((t,n,i)=>t&&e(n,r.filters[i]),!0):void O(19439)}(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!rD(e.startAt,t.startAt)&&rD(e.endAt,t.endAt)}function rX(e){return en.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function rZ(e,t){return e.filters.filter(e=>e instanceof rO&&e.field.isEqual(t))}function r0(e,t,r){let n=ra,i=!0;for(let r of rZ(e,t)){let e=ra,t=!0;switch(r.op){case"<":case"<=":var s;e="nullValue"in(s=r.value)?ra:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?rp(re.empty(),en.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?rb(s)?rE:{mapValue:{}}:O(35942,{value:s});break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=ra}0>rT({value:n,inclusive:i},{value:e,inclusive:t})&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];0>rT({value:n,inclusive:i},{value:e,inclusive:r.inclusive})&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function r1(e,t,r){let n=rn,i=!0;for(let r of rZ(e,t)){let e=rn,t=!0;switch(r.op){case">=":case">":var s;e="nullValue"in(s=r.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?rp(re.empty(),en.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?rE:"mapValue"in s?rb(s)?{mapValue:{}}:rn:O(61959,{value:s}),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=rn}rS({value:n,inclusive:i},{value:e,inclusive:t})>0&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];rS({value:n,inclusive:i},{value:e,inclusive:r.inclusive})>0&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}class r2{constructor(e,t=null,r=[],n=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function r6(e){return new r2(e)}function r3(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function r5(e){return null!==e.collectionGroup}function r4(e){if(null===e.Ie){let t;e.Ie=[];let r=new Set;for(let t of e.explicitOrderBy)e.Ie.push(t),r.add(t.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new tK(er.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{r.has(t.canonicalString())||t.isKeyField()||e.Ie.push(new rN(t,n))}),r.has(er.keyField().canonicalString())||e.Ie.push(new rN(er.keyField(),n))}return e.Ie}function r8(e){return e.Ee||(e.Ee=r7(e,r4(e))),e.Ee}function r7(e,t){if("F"===e.limitType)return rQ(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new rN(e.field,t)});let r=e.endAt?new rk(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new rk(e.startAt.position,e.startAt.inclusive):null;return rQ(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}}function r9(e,t){let r=e.filters.concat([t]);return new r2(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function ne(e,t,r){return new r2(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function nt(e,t){return rY(r8(e),r8(t))&&e.limitType===t.limitType}function nr(e){return`${rJ(r8(e))}|lt:${e.limitType}`}function nn(e){var t;let r;return`Query(target=${r=(t=r8(e)).path.canonicalString(),null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof rO?`${t.field.canonicalString()} ${t.op} ${rf(t.value)}`:t instanceof rP?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),ej(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(e=>rf(e)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(e=>rf(e)).join(",")),`Target(${r})`}; limitType=${e.limitType})`}function ni(e,t){var r,n,i,s;let a,o,l;return t.isFoundDocument()&&(a=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(a):en.isDocumentKey(e.path)?e.path.isEqual(a):e.path.isImmediateParentOf(a))&&function(e,t){for(let r of r4(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}(e,t)&&function(e,t){for(let r of e.filters)if(!r.matches(t))return!1;return!0}(e,t)&&(r=e,n=t,(!r.startAt||(i=r.startAt,o=rx(i,r4(r),n),i.inclusive?!!(o<=0):!!(o<0)))&&(!r.endAt||(s=r.endAt,l=rx(s,r4(r),n),s.inclusive?!!(l>=0):!!(l>0))))}function ns(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function na(e){return(t,r)=>{let n=!1;for(let i of r4(e)){let e=function(e,t,r){var n;let i,s,a=e.field.isKeyField()?en.comparator(t.key,r.key):(n=e.field,i=t.data.field(n),s=r.data.field(n),null!==i&&null!==s?rh(i,s):O(42886));switch(e.dir){case"asc":return a;case"desc":return -1*a;default:return O(19790,{direction:e.dir})}}(i,t,r);if(0!==e)return e;n=n||i.field.isKeyField()}return 0}}class no{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r){for(let[t,n]of r)if(this.equalsFn(t,e))return n}}has(e){return void 0!==this.get(e)}set(e,t){let r=this.mapKeyFn(e),n=this.inner[r];if(void 0===n)return this.inner[r]=[[e,t]],void this.innerSize++;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return void(n[r]=[e,t]);n.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return 1===r.length?delete this.inner[t]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(e){tB(this.inner,(t,r)=>{for(let[t,n]of r)e(t,n)})}isEmpty(){return tq(this.inner)}size(){return this.innerSize}}let nl=new tj(en.comparator),nu=new tj(en.comparator);function nh(...e){let t=nu;for(let r of e)t=t.insert(r.key,r);return t}function nc(e){let t=nu;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function nd(){return new no(e=>e.toString(),(e,t)=>e.isEqual(t))}let nf=new tj(en.comparator),np=new tK(en.comparator);function ng(...e){let t=np;for(let r of e)t=t.add(r);return t}let nm=new tK(W);function ny(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:e$(t)?"-0":t}}function nw(e){return{integerValue:""+e}}class nv{constructor(){this._=void 0}}function nb(e,t){return e instanceof nC?rg(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class n_ extends nv{}class nI extends nv{constructor(e){super(),this.elements=e}}function nE(e,t){let r=nk(t);for(let t of e.elements)r.some(e=>rl(e,t))||r.push(t);return{arrayValue:{values:r}}}class nT extends nv{constructor(e){super(),this.elements=e}}function nS(e,t){let r=nk(t);for(let t of e.elements)r=r.filter(e=>!rl(e,t));return{arrayValue:{values:r}}}class nC extends nv{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function nA(e){return tZ(e.integerValue||e.doubleValue)}function nk(e){return rm(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class nx{constructor(e,t){this.field=e,this.transform=t}}class nD{constructor(e,t){this.version=e,this.transformResults=t}}class nN{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new nN}static exists(e){return new nN(void 0,e)}static updateTime(e){return new nN(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function nR(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class nO{}function nP(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new nj(e.key,nN.none()):new nF(e.key,e.data,nN.none());{let r=e.data,n=rC.empty(),i=new tK(er.comparator);for(let e of t.fields)if(!i.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?n.delete(e):n.set(e,t),i=i.add(e)}return new nV(e.key,n,new tW(i.toArray()),nN.none())}}function nL(e,t,r,n){return e instanceof nF?function(e,t,r,n){if(!nR(e.precondition,t))return r;let i=e.value.clone(),s=nq(e.fieldTransforms,n,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,r,n):e instanceof nV?function(e,t,r,n){if(!nR(e.precondition,t))return r;let i=nq(e.fieldTransforms,n,t),s=t.data;return(s.setAll(nU(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===r)?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,r,n):nR(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}function nM(e,t){var r,n;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(r=e.fieldTransforms,n=t.fieldTransforms,!!(void 0===r&&void 0===n||!(!r||!n)&&Y(r,n,(e,t)=>{var r,n;return e.field.isEqual(t.field)&&(r=e.transform,n=t.transform,r instanceof nI&&n instanceof nI||r instanceof nT&&n instanceof nT?Y(r.elements,n.elements,rl):r instanceof nC&&n instanceof nC?rl(r.Ae,n.Ae):r instanceof n_&&n instanceof n_)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class nF extends nO{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class nV extends nO{constructor(e,t,r,n,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function nU(e){let t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){let n=e.data.field(r);t.set(r,n)}}),t}function nB(e,t,r){let n=new Map;L(e.length===r.length,32656,{Ve:r.length,de:e.length});for(let s=0;s<r.length;s++){var i;let a=e[s],o=a.transform,l=t.data.field(a.field);n.set(a.field,(i=r[s],o instanceof nI?nE(o,l):o instanceof nT?nS(o,l):i))}return n}function nq(e,t,r){let n=new Map;for(let i of e){let e=i.transform,s=r.data.field(i.field);n.set(i.field,function(e,t,r){var n;let i,s,a;return e instanceof n_?(n=t,i={fields:{[t2]:{stringValue:t1},[t3]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}},n&&t5(n)&&(n=t4(n)),n&&(i.fields[t6]=n),{mapValue:i}):e instanceof nI?nE(e,t):e instanceof nT?nS(e,t):(a=nA(s=nb(e,t))+nA(e.Ae),rg(s)&&rg(e.Ae)?nw(a):ny(e.serializer,a))}(e,s,t))}return n}class nj extends nO{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class n$ extends nO{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class nz{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let n=this.mutations[t];n.key.isEqual(e.key)&&function(e,t,r){let n,i;e instanceof nF?(n=e.value.clone(),i=nB(e.fieldTransforms,t,r.transformResults),n.setAll(i),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()):e instanceof nV?function(e,t,r){if(!nR(e.precondition,t))return t.convertToUnknownDocument(r.version);let n=nB(e.fieldTransforms,t,r.transformResults),i=t.data;i.setAll(nU(e)),i.setAll(n),t.convertToFoundDocument(r.version,i).setHasCommittedMutations()}(e,t,r):t.convertToNoDocument(r.version).setHasCommittedMutations()}(n,e,r[t])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=nL(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=nL(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=nd();return this.mutations.forEach(n=>{let i=e.get(n.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=nP(s,a=t.has(n.key)?null:a);null!==o&&r.set(n.key,o),s.isValidDocument()||s.convertToNoDocument(ed.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ng())}isEqual(e){return this.batchId===e.batchId&&Y(this.mutations,e.mutations,(e,t)=>nM(e,t))&&Y(this.baseMutations,e.baseMutations,(e,t)=>nM(e,t))}}class nK{constructor(e,t,r,n){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=n}static from(e,t,r){L(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let n=nf,i=e.mutations;for(let e=0;e<i.length;e++)n=n.insert(i[e].key,r[e].version);return new nK(e,t,r,n)}}class nG{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class nH{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}class nW{constructor(e,t){this.count=e,this.unchangedNames=t}}function nQ(e){switch(e){case M.OK:return O(64938);case M.CANCELLED:case M.UNKNOWN:case M.DEADLINE_EXCEEDED:case M.RESOURCE_EXHAUSTED:case M.INTERNAL:case M.UNAVAILABLE:case M.UNAUTHENTICATED:return!1;case M.INVALID_ARGUMENT:case M.NOT_FOUND:case M.ALREADY_EXISTS:case M.PERMISSION_DENIED:case M.FAILED_PRECONDITION:case M.ABORTED:case M.OUT_OF_RANGE:case M.UNIMPLEMENTED:case M.DATA_LOSS:return!0;default:return O(15467,{code:e})}}function nJ(e){if(void 0===e)return D("GRPC error has no .code"),M.UNKNOWN;switch(e){case c.OK:return M.OK;case c.CANCELLED:return M.CANCELLED;case c.UNKNOWN:return M.UNKNOWN;case c.DEADLINE_EXCEEDED:return M.DEADLINE_EXCEEDED;case c.RESOURCE_EXHAUSTED:return M.RESOURCE_EXHAUSTED;case c.INTERNAL:return M.INTERNAL;case c.UNAVAILABLE:return M.UNAVAILABLE;case c.UNAUTHENTICATED:return M.UNAUTHENTICATED;case c.INVALID_ARGUMENT:return M.INVALID_ARGUMENT;case c.NOT_FOUND:return M.NOT_FOUND;case c.ALREADY_EXISTS:return M.ALREADY_EXISTS;case c.PERMISSION_DENIED:return M.PERMISSION_DENIED;case c.FAILED_PRECONDITION:return M.FAILED_PRECONDITION;case c.ABORTED:return M.ABORTED;case c.OUT_OF_RANGE:return M.OUT_OF_RANGE;case c.UNIMPLEMENTED:return M.UNIMPLEMENTED;case c.DATA_LOSS:return M.DATA_LOSS;default:return O(39323,{code:e})}}(d=c||(c={}))[d.OK=0]="OK",d[d.CANCELLED=1]="CANCELLED",d[d.UNKNOWN=2]="UNKNOWN",d[d.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",d[d.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",d[d.NOT_FOUND=5]="NOT_FOUND",d[d.ALREADY_EXISTS=6]="ALREADY_EXISTS",d[d.PERMISSION_DENIED=7]="PERMISSION_DENIED",d[d.UNAUTHENTICATED=16]="UNAUTHENTICATED",d[d.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",d[d.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",d[d.ABORTED=10]="ABORTED",d[d.OUT_OF_RANGE=11]="OUT_OF_RANGE",d[d.UNIMPLEMENTED=12]="UNIMPLEMENTED",d[d.INTERNAL=13]="INTERNAL",d[d.UNAVAILABLE=14]="UNAVAILABLE",d[d.DATA_LOSS=15]="DATA_LOSS";let nY=null;function nX(){return new TextEncoder}let nZ=new t([0xffffffff,0xffffffff],0);function n0(e){let t=nX().encode(e),n=new r;return n.update(t),new Uint8Array(n.digest())}function n1(e){let r=new DataView(e.buffer),n=r.getUint32(0,!0),i=r.getUint32(4,!0),s=r.getUint32(8,!0),a=r.getUint32(12,!0);return[new t([n,i],0),new t([s,a],0)]}class n2{constructor(e,r,n){if(this.bitmap=e,this.padding=r,this.hashCount=n,r<0||r>=8)throw new n6(`Invalid padding: ${r}`);if(n<0||e.length>0&&0===this.hashCount)throw new n6(`Invalid hash count: ${n}`);if(0===e.length&&0!==r)throw new n6(`Invalid padding when bitmap length is 0: ${r}`);this.ge=8*e.length-r,this.pe=t.fromNumber(this.ge)}ye(e,r,n){let i=e.add(r.multiply(t.fromNumber(n)));return 1===i.compare(nZ)&&(i=new t([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;let[t,r]=n1(n0(e));for(let e=0;e<this.hashCount;e++){let n=this.ye(t,r,e);if(!this.we(n))return!1}return!0}static create(e,t,r){let n=new n2(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return r.forEach(e=>n.insert(e)),n}insert(e){if(0===this.ge)return;let[t,r]=n1(n0(e));for(let e=0;e<this.hashCount;e++){let n=this.ye(t,r,e);this.be(n)}}be(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class n6 extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class n3{constructor(e,t,r,n,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let n=new Map;return n.set(e,n5.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n3(ed.min(),n,new tj(W),nl,ng())}}class n5{constructor(e,t,r,n,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n5(r,t,ng(),ng(),ng())}}class n4{constructor(e,t,r,n){this.Se=e,this.removedTargetIds=t,this.key=r,this.De=n}}class n8{constructor(e,t){this.targetId=e,this.Ce=t}}class n7{constructor(e,t,r=tJ.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class n9{constructor(){this.ve=0,this.Fe=ir(),this.Me=tJ.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=ng(),t=ng(),r=ng();return this.Fe.forEach((n,i)=>{switch(i){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:r=r.add(n);break;default:O(38017,{changeType:i})}}),new n5(this.Me,this.xe,e,t,r)}Ke(){this.Oe=!1,this.Fe=ir()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,L(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class ie{constructor(e){this.Ge=e,this.ze=new Map,this.je=nl,this.He=it(),this.Je=it(),this.Ze=new tj(W)}Xe(e){for(let t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.We(),r.Ne||r.Ke(),r.Le(e.resumeToken);break;case 2:r.We(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.Qe(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:O(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,r)=>{this.rt(r)&&t(r)})}st(e){let t=e.targetId,r=e.Ce.count,n=this.ot(t);if(n){let a=n.target;if(rX(a))if(0===r){let e=new en(a.path);this.et(t,e,rA.newNoDocument(e,ed.min()))}else L(1===r,20013,{expectedCount:r});else{let n=this._t(t);if(n!==r){var i,s;let r,a,o=this.ut(e),l=o?this.ct(o,e,n):1;0!==l&&(this.it(t),this.Ze=this.Ze.insert(t,2===l?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),nY?.lt((i=e.Ce,s=this.Ge.ht(),r={localCacheCount:n,existenceFilterCount:i.count,databaseId:s.database,projectId:s.projectId},(a=i.unchangedNames)&&(r.bloomFilter={applied:0===l,hashCount:a?.hashCount??0,bitmapLength:a?.bits?.bitmap?.length??0,padding:a?.bits?.padding??0,mightContain:e=>o?.mightContain(e)??!1}),r))}}}}ut(e){let t,r,n=e.Ce.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=n;try{t=t0(i).toUint8Array()}catch(e){if(e instanceof tQ)return N("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{r=new n2(t,s,a)}catch(e){return N(e instanceof n6?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===r.ge?null:r}ct(e,t,r){return 2*(t.Ce.count!==r-this.Pt(e,t.targetId))}Pt(e,t){let r=this.Ge.getRemoteKeysForTarget(t),n=0;return r.forEach(r=>{let i=this.Ge.ht(),s=`projects/${i.projectId}/databases/${i.database}/documents/${r.path.canonicalString()}`;e.mightContain(s)||(this.et(t,r,null),n++)}),n}Tt(e){let t=new Map;this.ze.forEach((r,n)=>{let i=this.ot(n);if(i){if(r.current&&rX(i.target)){let t=new en(i.target.path);this.It(t).has(n)||this.Et(n,t)||this.et(n,t,rA.newNoDocument(t,e))}r.Be&&(t.set(n,r.ke()),r.Ke())}});let r=ng();this.Je.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{let t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(r=r.add(e))}),this.je.forEach((t,r)=>r.setReadTime(e));let n=new n3(e,t,this.Ze,this.je,r);return this.je=nl,this.He=it(),this.Je=it(),this.Ze=new tj(W),n}Ye(e,t){if(!this.rt(e))return;let r=2*!!this.Et(e,t.key);this.nt(e).qe(t.key,r),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;let n=this.nt(e);this.Et(e,t)?n.qe(t,1):n.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new n9,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new tK(W),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new tK(W),this.He=this.He.insert(e,t)),t}rt(e){let t=null!==this.ot(e);return t||x("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new n9),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function it(){return new tj(en.comparator)}function ir(){return new tj(en.comparator)}let ii={asc:"ASCENDING",desc:"DESCENDING"},is={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ia={and:"AND",or:"OR"};class io{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function il(e,t){return e.useProto3Json||ej(t)?t:{value:t}}function iu(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function ih(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function ic(e){let t;return L(!!e,49232),ed.fromTimestamp(new ec((t=tX(e)).seconds,t.nanos))}function id(e,t){return ip(e,t).canonicalString()}function ip(e,t){let r=new ee(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?r:r.child(t)}function ig(e){let t=ee.fromString(e);return L(iN(t),10190,{key:t.toString()}),t}function im(e,t){return id(e.databaseId,t.path)}function iy(e,t){let r=ig(t);if(r.get(1)!==e.databaseId.projectId)throw new F(M.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new F(M.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new en(i_(r))}function iw(e,t){return id(e.databaseId,t)}function iv(e){let t=ig(e);return 4===t.length?ee.emptyPath():i_(t)}function ib(e){return new ee(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function i_(e){return L(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function iI(e,t,r){return{name:im(e,t),fields:r.value.mapValue.fields}}function iE(e,t,r){let n=iy(e,t.name),i=ic(t.updateTime),s=t.createTime?ic(t.createTime):ed.min(),a=new rC({mapValue:{fields:t.fields}}),o=rA.newFoundDocument(n,i,s,a);return r&&o.setHasCommittedMutations(),r?o.setHasCommittedMutations():o}function iT(e,t){var r,n;let i;if(t instanceof nF)i={update:iI(e,t.key,t.value)};else if(t instanceof nj)i={delete:im(e,t.key)};else if(t instanceof nV){let r;i={update:iI(e,t.key,t.data),updateMask:(n=t.fieldMask,r=[],n.fields.forEach(e=>r.push(e.canonicalString())),{fieldPaths:r})}}else{if(!(t instanceof n$))return O(16599,{dt:t.type});i={verify:im(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let r=t.transform;if(r instanceof n_)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(r instanceof nI)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:r.elements}};if(r instanceof nT)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:r.elements}};if(r instanceof nC)return{fieldPath:t.field.canonicalString(),increment:r.Ae};throw O(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(i.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:iu(e,r.updateTime.toTimestamp())}:void 0!==r.exists?{exists:r.exists}:O(27497)),i}function iS(e,t){var r;let n=t.currentDocument?void 0!==(r=t.currentDocument).updateTime?nN.updateTime(ic(r.updateTime)):void 0!==r.exists?nN.exists(r.exists):nN.none():nN.none(),i=t.updateTransforms?t.updateTransforms.map(t=>{let r;return r=null,"setToServerValue"in t?(L("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),r=new n_):"appendMissingElements"in t?r=new nI(t.appendMissingElements.values||[]):"removeAllFromArray"in t?r=new nT(t.removeAllFromArray.values||[]):"increment"in t?r=new nC(e,t.increment):O(16584,{proto:t}),new nx(er.fromServerFormat(t.fieldPath),r)}):[];if(t.update){t.update.name;let r=iy(e,t.update.name),s=new rC({mapValue:{fields:t.update.fields}});return t.updateMask?new nV(r,s,new tW((t.updateMask.fieldPaths||[]).map(e=>er.fromServerFormat(e))),n,i):new nF(r,s,n,i)}return t.delete?new nj(iy(e,t.delete),n):t.verify?new n$(iy(e,t.verify),n):O(1463,{proto:t})}function iC(e,t){return{documents:[iw(e,t.path)]}}function iA(e,t){var r,n;let i,s={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(i=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=iw(e,i);let o=function(e){if(0!==e.length)return function e(t){var r;let n;return t instanceof rO?function(e){if("=="===e.op){if(rw(e.value))return{unaryFilter:{field:ix(e.field),op:"IS_NAN"}};if(ry(e.value))return{unaryFilter:{field:ix(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(rw(e.value))return{unaryFilter:{field:ix(e.field),op:"IS_NOT_NAN"}};if(ry(e.value))return{unaryFilter:{field:ix(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ix(e.field),op:is[e.op],value:e.value}}}(t):t instanceof rP?1===(n=(r=t).getFilters().map(t=>e(t))).length?n[0]:{compositeFilter:{op:ia[r.op],filters:n}}:O(54877,{filter:t})}(rP.create(e,"and"))}(t.filters);o&&(s.structuredQuery.where=o);let l=function(e){if(0!==e.length)return e.map(e=>({field:ix(e.field),direction:ii[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let u=il(e,t.limit);return null!==u&&(s.structuredQuery.limit=u),t.startAt&&(s.structuredQuery.startAt={before:(r=t.startAt).inclusive,values:r.position}),t.endAt&&(s.structuredQuery.endAt={before:!(n=t.endAt).inclusive,values:n.position}),{ft:s,parent:i}}function ik(e){var t,r,n;let i,s,a,o,l=iv(e.parent),u=e.structuredQuery,h=u.from?u.from.length:0,c=null;if(h>0){L(1===h,65062);let e=u.from[0];e.allDescendants?c=e.collectionId:l=l.child(e.collectionId)}let d=[];u.where&&(d=(i=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=iD(e.unaryFilter.field);return rO.create(t,"==",{doubleValue:NaN});case"IS_NULL":let r=iD(e.unaryFilter.field);return rO.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let n=iD(e.unaryFilter.field);return rO.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=iD(e.unaryFilter.field);return rO.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return O(61313);default:return O(60726)}}(t):void 0!==t.fieldFilter?rO.create(iD(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return O(58110);default:return O(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?rP.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return O(1026)}}(t.compositeFilter.op)):O(30097,{filter:t})}(u.where))instanceof rP&&rF(i)?i.getFilters():[i]);let f=[];u.orderBy&&(f=u.orderBy.map(e=>new rN(iD(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let p=null;u.limit&&(p=ej(s="object"==typeof(t=u.limit)?t.value:t)?null:s);let g=null;u.startAt&&(a=!!(r=u.startAt).before,g=new rk(r.values||[],a));let m=null;return u.endAt&&(o=!(n=u.endAt).before,m=new rk(n.values||[],o)),new r2(l,c,f,d,p,"F",g,m)}function ix(e){return{fieldPath:e.canonicalString()}}function iD(e){return er.fromServerFormat(e.fieldPath)}function iN(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function iR(e){return!!e&&"function"==typeof e._toProto&&"ProtoValue"===e._protoValueType}class iO{constructor(e,t,r,n,i=ed.min(),s=ed.min(),a=tJ.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new iO(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new iO(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new iO(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new iO(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class iP{constructor(e){this.yt=e}}function iL(e,t){let r=t.key,n={prefixPath:r.getCollectionPath().popLast().toArray(),collectionGroup:r.collectionGroup,documentId:r.path.lastSegment(),readTime:iM(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var i;n.document={name:im(i=e.yt,t.key),fields:t.data.value.mapValue.fields,updateTime:iu(i,t.version.toTimestamp()),createTime:iu(i,t.createTime.toTimestamp())}}else if(t.isNoDocument())n.noDocument={path:r.path.toArray(),readTime:iF(t.version)};else{if(!t.isUnknownDocument())return O(57904,{document:t});n.unknownDocument={path:r.path.toArray(),version:iF(t.version)}}return n}function iM(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function iF(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function iV(e){let t=new ec(e.seconds,e.nanoseconds);return ed.fromTimestamp(t)}function iU(e,t){let r=(t.baseMutations||[]).map(t=>iS(e.yt,t));for(let e=0;e<t.mutations.length-1;++e){let r=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(r.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let n=t.mutations.map(t=>iS(e.yt,t)),i=ec.fromMillis(t.localWriteTimeMs);return new nz(t.batchId,i,r,n)}function iB(e){var t;let r,n=iV(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?iV(e.lastLimboFreeSnapshotVersion):ed.min();return new iO(void 0!==e.query.documents?(L(1===(r=(t=e.query).documents.length),1966,{count:r}),r8(r6(iv(t.documents[0])))):r8(ik(e.query)),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,n,i,tJ.fromBase64String(e.resumeToken))}function iq(e,t){let r,n=iF(t.snapshotVersion),i=iF(t.lastLimboFreeSnapshotVersion);r=rX(t.target)?iC(e.yt,t.target):iA(e.yt,t.target).ft;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:rJ(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function ij(e){let t=ik({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?ne(t,t.limit,"L"):t}function i$(e,t){return new nG(t.largestBatchId,iS(e.yt,t.overlayMutation))}function iz(e,t){let r=t.path.lastSegment();return[e,eK(t.path.popLast()),r]}function iK(e,t,r,n){return{indexId:e,uid:t,sequenceNumber:r,readTime:iF(n.readTime),documentKey:eK(n.documentKey.path),largestBatchId:n.largestBatchId}}class iG{getBundleMetadata(e,t){return tV(e,tf).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:iV(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return tV(e,tf).put({bundleId:t.id,createTime:iF(ic(t.createTime)),version:t.version})}getNamedQuery(e,t){return tV(e,tp).get(t).next(e=>{if(e)return{name:e.name,query:ij(e.bundledQuery),readTime:iV(e.readTime)}})}saveNamedQuery(e,t){return tV(e,tp).put({name:t.name,readTime:iF(ic(t.readTime)),bundledQuery:t.bundledQuery})}}class iH{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){return new iH(e,t.uid||"")}getOverlay(e,t){return tV(e,tS).get(iz(this.userId,t)).next(e=>e?i$(this.serializer,e):null)}getOverlays(e,t){let r=nd();return eC.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){let n=[];return r.forEach((r,i)=>{let s=new nG(t,i);n.push(this.bt(e,s))}),eC.waitFor(n)}removeOverlaysForBatchId(e,t,r){let n=new Set;t.forEach(e=>n.add(eK(e.getCollectionPath())));let i=[];return n.forEach(t=>{let n=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,r+1],!1,!0);i.push(tV(e,tS).X(tA,n))}),eC.waitFor(i)}getOverlaysForCollection(e,t,r){let n=nd(),i=eK(t),s=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,1/0],!0);return tV(e,tS).H(tA,s).next(e=>{for(let t of e){let e=i$(this.serializer,t);n.set(e.getKey(),e)}return n})}getOverlaysForCollectionGroup(e,t,r,n){let i,s=nd(),a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,1/0],!0);return tV(e,tS).ee({index:tx,range:a},(e,t,r)=>{let a=i$(this.serializer,t);s.size()<n||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):r.done()}).next(()=>s)}bt(e,t){return tV(e,tS).put(function(e,t,r){let[n,i,s]=iz(t,r.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:iT(e.yt,r.mutation)}}(this.serializer,this.userId,t))}}class iW{St(e){return tV(e,tN)}getSessionToken(e){return this.St(e).get("sessionToken").next(e=>{let t=e?.value;return t?tJ.fromUint8Array(t):tJ.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.St(e).put({name:"sessionToken",value:t.toUint8Array()})}}class iQ{Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(+!!e.booleanValue);else if("integerValue"in e)this.Ft(t,15),t.Mt(tZ(e.integerValue));else if("doubleValue"in e){let r=tZ(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),e$(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),"string"==typeof r&&(r=tX(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(t0(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?rI(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):rb(e)?this.kt(e.mapValue,t):(this.Kt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Nt(t)):O(19022,{Ut:e})}Ot(e,t){this.Ft(t,25),this.$t(e,t)}$t(e,t){t.xt(e)}Kt(e,t){let r=e.fields||{};for(let e of(this.Ft(t,55),Object.keys(r)))this.Ot(e,t),this.Ct(r[e],t)}kt(e,t){let r=e.fields||{};this.Ft(t,53);let n=r[rs].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(tZ(n)),this.Ot(rs,t),this.Ct(r[rs],t)}qt(e,t){let r=e.values||[];for(let e of(this.Ft(t,50),r))this.Ct(e,t)}Lt(e,t){this.Ft(t,37),en.fromName(e).path.forEach(e=>{this.Ft(t,60),this.$t(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}function iJ(e){return Math.ceil((64-function(e){let t=0;for(let r=0;r<8;++r){let n=function(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}(255&e[r]);if(t+=n,8!==n)break}return t}(e))/8)}iQ.Wt=new iQ;class iY{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Qt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ht(r.value),r=t.next();this.Jt()}Zt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Gt(e);else if(e<2048)this.Gt(960|e>>>6),this.Gt(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e);else{let e=t.codePointAt(0);this.Gt(240|e>>>18),this.Gt(128|63&e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e)}}this.zt()}Xt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Ht(e);else if(e<2048)this.Ht(960|e>>>6),this.Ht(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Ht(480|e>>>12),this.Ht(128|63&e>>>6),this.Ht(128|63&e);else{let e=t.codePointAt(0);this.Ht(240|e>>>18),this.Ht(128|63&e>>>12),this.Ht(128|63&e>>>6),this.Ht(128|63&e)}}this.Jt()}Yt(e){let t=this.en(e),r=iJ(t);this.tn(1+r),this.buffer[this.position++]=255&r;for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=255&t[e]}nn(e){let t=this.en(e),r=iJ(t);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}rn(){this.sn(255),this.sn(255)}_n(){this.an(255),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){let t,r=((t=new DataView(new ArrayBuffer(8))).setFloat64(0,e,!1),new Uint8Array(t.buffer)),n=!!(128&r[0]);r[0]^=n?255:128;for(let e=1;e<r.length;++e)r[e]^=255*!!n;return r}Gt(e){let t=255&e;0===t?(this.sn(0),this.sn(255)):255===t?(this.sn(255),this.sn(0)):this.sn(t)}Ht(e){let t=255&e;0===t?(this.an(0),this.an(255)):255===t?(this.an(255),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Jt(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let n=new Uint8Array(r);n.set(this.buffer),this.buffer=n}}class iX{constructor(e){this.cn=e}Bt(e){this.cn.Qt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.Yt(e)}vt(){this.cn.rn()}}class iZ{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Xt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class i0{constructor(){this.cn=new iY,this.ascending=new iX(this.cn),this.descending=new iZ(this.cn)}seed(e){this.cn.seed(e)}ln(e){return 0===e?this.ascending:this.descending}un(){return this.cn.un()}reset(){this.cn.reset()}}class i1{constructor(e,t,r,n){this.hn=e,this.Pn=t,this.Tn=r,this.In=n}En(){let e=this.In.length,t=0===e||255===this.In[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.In,0),t!==e?r.set([0],this.In.length):++r[r.length-1],new i1(this.hn,this.Pn,this.Tn,r)}Rn(e,t,r){return{indexId:this.hn,uid:e,arrayValue:i3(this.Tn),directionalValue:i3(this.In),orderedDocumentKey:i3(t),documentKey:r.path.toArray()}}An(e,t,r){let n=this.Rn(e,t,r);return[n.indexId,n.uid,n.arrayValue,n.directionalValue,n.orderedDocumentKey,n.documentKey]}}function i2(e,t){let r=e.hn-t.hn;return 0!==r||0!==(r=i6(e.Tn,t.Tn))||0!==(r=i6(e.In,t.In))?r:en.comparator(e.Pn,t.Pn)}function i6(e,t){for(let r=0;r<e.length&&r<t.length;++r){let n=e[r]-t[r];if(0!==n)return n}return e.length-t.length}function i3(e){return(0,v.isSafariOrWebkit)()?function(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}(e):e}function i5(e){return"string"!=typeof e?e:function(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(e)}class i4{constructor(e){for(const t of(this.Vn=new tK((e,t)=>er.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.dn=e.orderBy,this.mn=[],e.filters))t.isInequality()?this.Vn=this.Vn.add(t):this.mn.push(t)}get fn(){return this.Vn.size>1}gn(e){if(L(e.collectionGroup===this.collectionId,49279),this.fn)return!1;let t=ep(e);if(void 0!==t&&!this.pn(t))return!1;let r=eg(e),n=new Set,i=0,s=0;for(;i<r.length&&this.pn(r[i]);++i)n=n.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Vn.size>0){let e=this.Vn.getIterator().getNext();if(!n.has(e.field.canonicalString())){let t=r[i];if(!this.yn(e,t)||!this.wn(this.dn[s++],t))return!1}++i}for(;i<r.length;++i){let e=r[i];if(s>=this.dn.length||!this.wn(this.dn[s++],e))return!1}return!0}bn(){if(this.fn)return null;let e=new tK(er.comparator),t=[];for(let r of this.mn)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new ey(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new ey(r.field,0))}for(let r of this.dn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new ey(r.field,+("asc"!==r.dir))));return new ef(ef.UNKNOWN_ID,this.collectionId,t,ew.empty())}pn(e){for(let t of this.mn)if(this.yn(t,e))return!0;return!1}yn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let r="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===r}wn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function i8(e){return e instanceof rO}function i7(e){return e instanceof rP&&rF(e)}function i9(e){return i8(e)||i7(e)||function(e){if(e instanceof rP&&rM(e)){for(let t of e.getFilters())if(!i8(t)&&!i7(t))return!1;return!0}return!1}(e)}function se(e,t){return L(e instanceof rO||e instanceof rP,38388),L(t instanceof rO||t instanceof rP,25473),sr(e instanceof rO?t instanceof rO?rP.create([e,t],"and"):st(e,t):t instanceof rO?st(t,e):function(e,t){if(L(e.filters.length>0&&t.filters.length>0,48005),rL(e)&&rL(t))return rU(e,t.getFilters());let r=rM(e)?e:t,n=rM(e)?t:e,i=r.filters.map(e=>se(e,n));return rP.create(i,"or")}(e,t))}function st(e,t){if(rL(t))return rU(t,e.getFilters());{let r=t.filters.map(t=>se(e,t));return rP.create(r,"or")}}function sr(e){if(L(e instanceof rO||e instanceof rP,11850),e instanceof rO)return e;let t=e.getFilters();if(1===t.length)return sr(t[0]);if(rV(e))return e;let r=t.map(e=>sr(e)),n=[];return r.forEach(t=>{t instanceof rO?n.push(t):t instanceof rP&&(t.op===e.op?n.push(...t.filters):n.push(t))}),1===n.length?n[0]:rP.create(n,e.op)}class sn{constructor(){this.Sn=new si}addToCollectionParentIndex(e,t){return this.Sn.add(t),eC.resolve()}getCollectionParents(e,t){return eC.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return eC.resolve()}deleteFieldIndex(e,t){return eC.resolve()}deleteAllFieldIndexes(e){return eC.resolve()}createTargetIndexes(e,t){return eC.resolve()}getDocumentsMatchingTarget(e,t){return eC.resolve(null)}getIndexType(e,t){return eC.resolve(0)}getFieldIndexes(e,t){return eC.resolve([])}getNextCollectionGroupToUpdate(e){return eC.resolve(null)}getMinOffset(e,t){return eC.resolve(e_.min())}getMinOffsetFromCollectionGroup(e,t){return eC.resolve(e_.min())}updateCollectionGroup(e,t,r){return eC.resolve()}updateIndexEntries(e,t){return eC.resolve()}}class si{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new tK(ee.comparator),i=!n.has(r);return this.index[t]=n.add(r),i}has(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t];return n&&n.has(r)}getEntries(e){return(this.index[e]||new tK(ee.comparator)).toArray()}}let ss="IndexedDbIndexManager",sa=new Uint8Array(0);class so{constructor(e,t){this.databaseId=t,this.Dn=new si,this.Cn=new no(e=>rJ(e),(e,t)=>rY(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Dn.has(t)){let r=t.lastSegment(),n=t.popLast();e.addOnCommittedListener(()=>{this.Dn.add(t)});let i={collectionId:r,parent:eK(n)};return tV(e,th).put(i)}return eC.resolve()}getCollectionParents(e,t){let r=[],n=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return tV(e,th).H(n).next(e=>{for(let n of e){if(n.collectionId!==t)break;r.push(eG(n.parent))}return r})}addFieldIndex(e,t){let r=tV(e,tg),n={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete n.indexId;let i=r.add(n);if(t.indexState){let r=tV(e,ty);return i.next(e=>{r.put(iK(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let r=tV(e,tg),n=tV(e,ty),i=tV(e,t_);return r.delete(t.indexId).next(()=>n.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=tV(e,tg),r=tV(e,t_),n=tV(e,ty);return t.X().next(()=>r.X()).next(()=>n.X())}createTargetIndexes(e,t){return eC.forEach(this.vn(t),t=>this.getIndexType(e,t).next(r=>{if(0===r||1===r){let r=new i4(t).bn();if(null!=r)return this.addFieldIndex(e,r)}}))}getDocumentsMatchingTarget(e,t){let r=tV(e,t_),n=!0,i=new Map;return eC.forEach(this.vn(t),t=>this.Fn(e,t).next(e=>{n&&(n=!!e),i.set(t,e)})).next(()=>{if(n){let e=ng(),n=[];return eC.forEach(i,(i,s)=>{x(ss,`Using index id=${i.indexId}|cg=${i.collectionGroup}|f=${i.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${rJ(t)}`);let a=function(e,t){let r=ep(t);if(void 0===r)return null;for(let t of rZ(e,r.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),o=function(e,t){let r=new Map;for(let n of eg(t))for(let t of rZ(e,n.fieldPath))switch(t.op){case"==":case"in":r.set(n.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return r.set(n.fieldPath.canonicalString(),t.value),Array.from(r.values())}return null}(s,i),l=function(e,t){let r=[],n=!0;for(let i of eg(t)){let t=0===i.kind?r0(e,i.fieldPath,e.startAt):r1(e,i.fieldPath,e.startAt);r.push(t.value),n&&(n=t.inclusive)}return new rk(r,n)}(s,i),u=function(e,t){let r=[],n=!0;for(let i of eg(t)){let t=0===i.kind?r1(e,i.fieldPath,e.endAt):r0(e,i.fieldPath,e.endAt);r.push(t.value),n&&(n=t.inclusive)}return new rk(r,n)}(s,i),h=this.Mn(i,s,l),c=this.Mn(i,s,u),d=this.xn(i,s,o),f=this.On(i.indexId,a,h,l.inclusive,c,u.inclusive,d);return eC.forEach(f,i=>r.Z(i,t.limit).next(t=>{t.forEach(t=>{let r=en.fromSegments(t.documentKey);e.has(r)||(e=e.add(r),n.push(r))})}))}).next(()=>n)}return eC.resolve(null)})}vn(e){let t=this.Cn.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(L(t instanceof rO||t instanceof rP,34018),t instanceof rO)return t;if(1===t.filters.length)return e(t.filters[0]);let r=t.filters.map(t=>e(t)),n=rP.create(r,t.op);return i9(n=sr(n))?n:(L(n instanceof rP,64498),L(rL(n),40251),L(n.filters.length>1,57927),n.filters.reduce((e,t)=>se(e,t)))}(function e(t){if(L(t instanceof rO||t instanceof rP,20012),t instanceof rO){if(t instanceof rK){let e=t.value.arrayValue?.values?.map(e=>rO.create(t.field,"==",e))||[];return rP.create(e,"or")}return t}let r=t.filters.map(t=>e(t));return rP.create(r,t.op)}(e));return L(i9(t),7391),i8(t)||i7(t)?[t]:t.getFilters()})(rP.create(e.filters,"and")).map(t=>rQ(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.Cn.set(e,t)),t}On(e,t,r,n,i,s,a){let o=(null!=t?t.length:1)*Math.max(r.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let h=0;h<o;++h){let o=t?this.Nn(t[h/l]):sa,c=this.Bn(e,o,r[h%l],n),d=this.Ln(e,o,i[h%l],s),f=a.map(t=>this.Bn(e,o,t,!0));u.push(...this.createRange(c,d,f))}return u}Bn(e,t,r,n){let i=new i1(e,en.empty(),t,r);return n?i:i.En()}Ln(e,t,r,n){let i=new i1(e,en.empty(),t,r);return n?i.En():i}Fn(e,t){let r=new i4(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(let n of e)r.gn(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let r=2,n=this.vn(t);return eC.forEach(n,t=>this.Fn(e,t).next(e=>{e?0!==r&&e.fields.length<function(e){let t=new tK(er.comparator),r=!1;for(let n of e.filters)for(let e of n.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?r=!0:t=t.add(e.field));for(let r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+ +!!r}(t)&&(r=1):r=0})).next(()=>null!==t.limit&&n.length>1&&2===r?1:r)}kn(e,t){let r=new i0;for(let n of eg(e)){let e=t.data.field(n.fieldPath);if(null==e)return null;let i=r.ln(n.kind);iQ.Wt.Dt(e,i)}return r.un()}Nn(e){let t=new i0;return iQ.Wt.Dt(e,t.ln(0)),t.un()}Kn(e,t){let r,n=new i0;return iQ.Wt.Dt(rp(this.databaseId,t),n.ln(0===(r=eg(e)).length?0:r[r.length-1].kind)),n.un()}xn(e,t,r){if(null===r)return[];let n=[];n.push(new i0);let i=0;for(let s of eg(e)){let e=r[i++];for(let r of n)if(this.qn(t,s.fieldPath)&&rm(e))n=this.Un(n,s,e);else{let t=r.ln(s.kind);iQ.Wt.Dt(e,t)}}return this.$n(n)}Mn(e,t,r){return this.xn(e,t,r.position)}$n(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].un();return t}Un(e,t,r){let n=[...e],i=[];for(let e of r.arrayValue.values||[])for(let r of n){let n=new i0;n.seed(r.un()),iQ.Wt.Dt(e,n.ln(t.kind)),i.push(n)}return i}qn(e,t){return!!e.filters.find(e=>e instanceof rO&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let r=tV(e,tg),n=tV(e,ty);return(t?r.H(tm,IDBKeyRange.bound(t,t)):r.H()).next(e=>{let t=[];return eC.forEach(e,e=>n.get([e.indexId,this.uid]).next(r=>{let n,i;t.push((n=r?new ew(r.sequenceNumber,new e_(iV(r.readTime),new en(eG(r.documentKey)),r.largestBatchId)):ew.empty(),i=e.fields.map(([e,t])=>new ey(er.fromServerFormat(e),t)),new ef(e.indexId,e.collectionGroup,i,n)))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let r=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==r?r:W(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,r){let n=tV(e,tg),i=tV(e,ty);return this.Wn(e).next(e=>n.H(tm,IDBKeyRange.bound(t,t)).next(t=>eC.forEach(t,t=>i.put(iK(t.indexId,this.uid,e,r)))))}updateIndexEntries(e,t){let r=new Map;return eC.forEach(t,(t,n)=>{let i=r.get(t.collectionGroup);return(i?eC.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(r.set(t.collectionGroup,i),eC.forEach(i,r=>this.Qn(e,t,r).next(t=>{let i=this.Gn(n,r);return t.isEqual(i)?eC.resolve():this.zn(e,n,r,t,i)}))))})}jn(e,t,r,n){return tV(e,t_).put(n.Rn(this.uid,this.Kn(r,t.key),t.key))}Hn(e,t,r,n){return tV(e,t_).delete(n.An(this.uid,this.Kn(r,t.key),t.key))}Qn(e,t,r){let n=tV(e,t_),i=new tK(i2);return n.ee({index:tE,range:IDBKeyRange.only([r.indexId,this.uid,i3(this.Kn(r,t))])},(e,n)=>{i=i.add(new i1(r.indexId,t,i5(n.arrayValue),i5(n.directionalValue)))}).next(()=>i)}Gn(e,t){let r=new tK(i2),n=this.kn(t,e);if(null==n)return r;let i=ep(t);if(null!=i){let s=e.data.field(i.fieldPath);if(rm(s))for(let i of s.arrayValue.values||[])r=r.add(new i1(t.indexId,e.key,this.Nn(i),n))}else r=r.add(new i1(t.indexId,e.key,sa,n));return r}zn(e,t,r,n,i){x(ss,"Updating index entries for document '%s'",t.key);let s=[];return function(e,t,r,n,i){let s=e.getIterator(),a=t.getIterator(),o=tH(s),l=tH(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let n=r(o,l);n<0?t=!0:n>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(n(l),l=tH(a)):t?(i(o),o=tH(s)):(o=tH(s),l=tH(a))}}(n,i,i2,n=>{s.push(this.jn(e,t,r,n))},n=>{s.push(this.Hn(e,t,r,n))}),eC.waitFor(s)}Wn(e){let t=1;return tV(e,ty).ee({index:tv,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,r,n)=>{n.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((e,t)=>i2(e,t)).filter((e,t,r)=>!t||0!==i2(e,r[t-1]));let n=[];for(let i of(n.push(e),r)){let r=i2(i,e),s=i2(i,t);if(0===r)n[0]=e.En();else if(r>0&&s<0)n.push(i),n.push(i.En());else if(s>0)break}n.push(t);let i=[];for(let e=0;e<n.length;e+=2){if(this.Jn(n[e],n[e+1]))return[];let t=n[e].An(this.uid,sa,en.empty()),r=n[e+1].An(this.uid,sa,en.empty());i.push(IDBKeyRange.bound(t,r))}return i}Jn(e,t){return i2(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(sl)}getMinOffset(e,t){return eC.mapArray(this.vn(t),t=>this.Fn(e,t).next(e=>e||O(44426))).next(sl)}}function sl(e){L(0!==e.length,28825);let t=e[0].indexState.offset,r=t.largestBatchId;for(let n=1;n<e.length;n++){let i=e[n].indexState.offset;0>eI(i,t)&&(t=i),r<i.largestBatchId&&(r=i.largestBatchId)}return new e_(t.readTime,t.documentKey,r)}let su={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class sh{static withCacheSize(e){return new sh(e,sh.DEFAULT_COLLECTION_PERCENTILE,sh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}function sc(e,t,r){let n=e.store(eY),i=e.store(e2),s=[],a=IDBKeyRange.only(r.batchId),o=0,l=n.ee({range:a},(e,t,r)=>(o++,r.delete()));s.push(l.next(()=>{L(1===o,47070,{batchId:r.batchId})}));let u=[];for(let e of r.mutations){var h,c;let n=(h=e.key.path,c=r.batchId,[t,eK(h),c]);s.push(i.delete(n)),u.push(e.key)}return eC.waitFor(s).next(()=>u)}function sd(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw O(14731);t=e.noDocument}return JSON.stringify(t).length}sh.DEFAULT_COLLECTION_PERCENTILE=10,sh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,sh.DEFAULT=new sh(0x2800000,sh.DEFAULT_COLLECTION_PERCENTILE,sh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),sh.DISABLED=new sh(-1,0,0);class sf{constructor(e,t,r,n){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=n,this.Zn={}}static wt(e,t,r,n){return L(""!==e.uid,64387),new sf(e.isAuthenticated()?e.uid:"",t,r,n)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return sg(e).ee({index:eZ,range:r},(e,r,n)=>{t=!1,n.done()}).next(()=>t)}addMutationBatch(e,t,r,n){let i=tV(e,e2),s=sg(e);return s.add({}).next(a=>{var o,l,u,h;let c,d;L("number"==typeof a,49019);let f=new nz(a,t,r,n),p=(o=this.serializer,l=this.userId,c=f.baseMutations.map(e=>iT(o.yt,e)),d=f.mutations.map(e=>iT(o.yt,e)),{userId:l,batchId:f.batchId,localWriteTimeMs:f.localWriteTime.toMillis(),baseMutations:c,mutations:d}),g=[],m=new tK((e,t)=>W(e.canonicalString(),t.canonicalString()));for(let e of n){let t=(u=this.userId,h=e.key.path,[u,eK(h),a]);m=m.add(e.key.path.popLast()),g.push(s.put(p)),g.push(i.put(t,e1))}return m.forEach(t=>{g.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Zn[a]=f.keys()}),eC.waitFor(g).next(()=>f)})}lookupMutationBatch(e,t){return sg(e).get(t).next(e=>e?(L(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),iU(this.serializer,e)):null)}Xn(e,t){return this.Zn[t]?eC.resolve(this.Zn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let r=e.keys();return this.Zn[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]),i=null;return sg(e).ee({index:eZ,range:n},(e,t,n)=>{t.userId===this.userId&&(L(t.batchId>=r,47524,{Yn:r}),i=iU(this.serializer,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,1/0]),r=-1;return sg(e).ee({index:eZ,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,1/0]);return sg(e).H(eZ,t).next(e=>e.map(e=>iU(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=[this.userId,eK(t.path)],n=IDBKeyRange.lowerBound(r),i=[];return tV(e,e2).ee({range:n},(r,n,s)=>{let[a,o,l]=r,u=eG(o);if(a===this.userId&&t.path.isEqual(u))return sg(e).get(l).next(e=>{if(!e)throw O(61480,{er:r,batchId:l});L(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),i.push(iU(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new tK(W),n=[];return t.forEach(t=>{let i=[this.userId,eK(t.path)],s=IDBKeyRange.lowerBound(i),a=tV(e,e2).ee({range:s},(e,n,i)=>{let[s,a,o]=e,l=eG(a);s===this.userId&&t.path.isEqual(l)?r=r.add(o):i.done()});n.push(a)}),eC.waitFor(n).next(()=>this.tr(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=[this.userId,eK(r)],s=IDBKeyRange.lowerBound(i),a=new tK(W);return tV(e,e2).ee({range:s},(e,t,i)=>{let[s,o,l]=e,u=eG(o);s===this.userId&&r.isPrefixOf(u)?u.length===n&&(a=a.add(l)):i.done()}).next(()=>this.tr(e,a))}tr(e,t){let r=[],n=[];return t.forEach(t=>{n.push(sg(e).get(t).next(e=>{if(null===e)throw O(35274,{batchId:t});L(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),r.push(iU(this.serializer,e))}))}),eC.waitFor(n).next(()=>r)}removeMutationBatch(e,t){return sc(e.le,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.nr(t.batchId)}),eC.forEach(r,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}nr(e){delete this.Zn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return eC.resolve();let r=IDBKeyRange.lowerBound([this.userId]),n=[];return tV(e,e2).ee({range:r},(e,t,r)=>{if(e[0]===this.userId){let t=eG(e[1]);n.push(t)}else r.done()}).next(()=>{L(0===n.length,56720,{rr:n.map(e=>e.canonicalString())})})})}containsKey(e,t){return sp(e,this.userId,t)}ir(e){return tV(e,eJ).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function sp(e,t,r){let n=[t,eK(r.path)],i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return tV(e,e2).ee({range:s,Y:!0},(e,r,n)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),n.done()}).next(()=>a)}function sg(e){return tV(e,eY)}class sm{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new sm(0)}static ar(){return new sm(-1)}}class sy{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.ur(e).next(t=>{let r=new sm(t.highestTargetId);return t.highestTargetId=r.next(),this.cr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.ur(e).next(e=>ed.fromTimestamp(new ec(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.ur(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.ur(e).next(n=>(n.highestListenSequenceNumber=t,r&&(n.lastRemoteSnapshotVersion=r.toTimestamp()),t>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=t),this.cr(e,n)))}addTargetData(e,t){return this.lr(e,t).next(()=>this.ur(e).next(r=>(r.targetCount+=1,this.hr(t,r),this.cr(e,r))))}updateTargetData(e,t){return this.lr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>tV(e,tt).delete(t.targetId)).next(()=>this.ur(e)).next(t=>(L(t.targetCount>0,8065),t.targetCount-=1,this.cr(e,t)))}removeTargets(e,t,r){let n=0,i=[];return tV(e,tt).ee((s,a)=>{let o=iB(a);o.sequenceNumber<=t&&null===r.get(o.targetId)&&(n++,i.push(this.removeTargetData(e,o)))}).next(()=>eC.waitFor(i)).next(()=>n)}forEachTarget(e,t){return tV(e,tt).ee((e,r)=>{t(iB(r))})}ur(e){return tV(e,tu).get(tl).next(e=>(L(null!==e,2888),e))}cr(e,t){return tV(e,tu).put(tl,t)}lr(e,t){return tV(e,tt).put(iq(this.serializer,t))}hr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.ur(e).next(e=>e.targetCount)}getTargetData(e,t){let r=rJ(t),n=IDBKeyRange.bound([r,-1/0],[r,1/0]),i=null;return tV(e,tt).ee({range:n,index:tr},(e,r,n)=>{let s=iB(r);rY(t,s.target)&&(i=s,n.done())}).next(()=>i)}addMatchingKeys(e,t,r){let n=[],i=sw(e);return t.forEach(t=>{let s=eK(t.path);n.push(i.put({targetId:r,path:s})),n.push(this.referenceDelegate.addReference(e,r,t))}),eC.waitFor(n)}removeMatchingKeys(e,t,r){let n=sw(e);return eC.forEach(t,t=>{let i=eK(t.path);return eC.waitFor([n.delete([r,i]),this.referenceDelegate.removeReference(e,r,t)])})}removeMatchingKeysForTargetId(e,t){let r=sw(e),n=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(n)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),n=sw(e),i=ng();return n.ee({range:r,Y:!0},(e,t,r)=>{let n=new en(eG(e[1]));i=i.add(n)}).next(()=>i)}containsKey(e,t){let r=eK(t.path),n=IDBKeyRange.bound([r],[r+"\0"],!1,!0),i=0;return sw(e).ee({index:ta,Y:!0,range:n},([e,t],r,n)=>{0!==e&&(i++,n.done())}).next(()=>i>0)}At(e,t){return tV(e,tt).get(t).next(e=>e?iB(e):null)}}function sw(e){return tV(e,ti)}let sv="LruGarbageCollector";function sb([e,t],[r,n]){let i=W(e,r);return 0===i?W(t,n):i}class s_{constructor(e){this.Pr=e,this.buffer=new tK(sb),this.Tr=0}Ir(){return++this.Tr}Er(e){let t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>sb(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class sI{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Ar(e){x(sv,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){eO(e)?x(sv,"Ignoring IndexedDB error during garbage collection: ",e):await eS(e)}await this.Ar(3e5)})}}class sE{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return eC.resolve(eq.ce);let r=new s_(t);return this.Vr.forEachTarget(e,e=>r.Er(e.sequenceNumber)).next(()=>this.Vr.mr(e,e=>r.Er(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(x("LruGarbageCollector","Garbage collection skipped; disabled"),eC.resolve(su)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(x("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),su):this.gr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let r,n,i,s,a,o,l,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(x("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),n=this.params.maximumSequenceNumbersToCollect):n=t,s=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(r=n,a=Date.now(),this.removeTargets(e,r,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(l=Date.now(),k()<=I.LogLevel.DEBUG&&x("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-u}ms
	Determined least recently used ${n} in `+(a-s)+"ms\n"+`	Removed ${i} targets in `+(o-a)+"ms\n"+`	Removed ${e} documents in `+(l-o)+"ms\n"+`Total Duration: ${l-u}ms`),eC.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:i,documentsRemoved:e})))}}class sT{constructor(e,t){this.db=e,this.garbageCollector=function(e,t){return new sE(e,t)}(this,t)}dr(e){let t=this.pr(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}pr(e){let t=0;return this.mr(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}mr(e,t){return this.yr(e,(e,r)=>t(r))}addReference(e,t,r){return sS(e,r)}removeReference(e,t,r){return sS(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return sS(e,t)}wr(e,t){let r;return r=!1,tV(e,eJ).te(n=>sp(e,n,t).next(e=>(e&&(r=!0),eC.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),n=[],i=0;return this.yr(e,(s,a)=>{if(a<=t){let t=this.wr(e,s).next(t=>{if(!t)return i++,r.getEntry(e,s).next(()=>(r.removeEntry(s,ed.min()),sw(e).delete([0,eK(s.path)])))});n.push(t)}}).next(()=>eC.waitFor(n)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return sS(e,t)}yr(e,t){let r=sw(e),n,i=eq.ce;return r.ee({index:ta},([e,r],{path:s,sequenceNumber:a})=>{0===e?(i!==eq.ce&&t(new en(eG(n)),i),i=a,n=s):i=eq.ce}).next(()=>{i!==eq.ce&&t(new en(eG(n)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function sS(e,t){var r;return sw(e).put((r=e.currentSequenceNumber,{targetId:0,path:eK(t.path),sequenceNumber:r}))}class sC{constructor(){this.changes=new no(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,rA.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return void 0!==r?eC.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class sA{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return tV(e,e6).put(r)}removeEntry(e,t,r){let n;return tV(e,e6).delete([(n=t.path.toArray()).slice(0,n.length-2),n[n.length-2],iM(r),n[n.length-1]])}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.br(e,r)))}getEntry(e,t){let r=rA.newInvalidDocument(t);return tV(e,e6).ee({index:e5,range:IDBKeyRange.only(sx(t))},(e,n)=>{r=this.Sr(t,n)}).next(()=>r)}Dr(e,t){let r={size:0,document:rA.newInvalidDocument(t)};return tV(e,e6).ee({index:e5,range:IDBKeyRange.only(sx(t))},(e,n)=>{r={document:this.Sr(t,n),size:sd(n)}}).next(()=>r)}getEntries(e,t){let r=nl;return this.Cr(e,t,(e,t)=>{let n=this.Sr(e,t);r=r.insert(e,n)}).next(()=>r)}vr(e,t){let r=nl,n=new tj(en.comparator);return this.Cr(e,t,(e,t)=>{let i=this.Sr(e,t);r=r.insert(e,i),n=n.insert(e,sd(t))}).next(()=>({documents:r,Fr:n}))}Cr(e,t,r){if(t.isEmpty())return eC.resolve();let n=new tK(sN);t.forEach(e=>n=n.add(e));let i=IDBKeyRange.bound(sx(n.first()),sx(n.last())),s=n.getIterator(),a=s.getNext();return tV(e,e6).ee({index:e5,range:i},(e,t,n)=>{let i=en.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>sN(a,i);)r(a,null),a=s.getNext();a&&a.isEqual(i)&&(r(a,t),a=s.hasNext()?s.getNext():null),a?n.j(sx(a)):n.done()}).next(()=>{for(;a;)r(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,r,n,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),iM(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return tV(e,e6).H(IDBKeyRange.bound(a,o,!0)).next(e=>{i?.incrementDocumentReadCount(e.length);let r=nl;for(let i of e){let e=this.Sr(en.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(ni(t,e)||n.has(e.key))&&(r=r.insert(e.key,e))}return r})}getAllFromCollectionGroup(e,t,r,n){let i=nl,s=sD(t,r),a=sD(t,e_.max());return tV(e,e6).ee({index:e8,range:IDBKeyRange.bound(s,a,!0)},(e,t,r)=>{let s=this.Sr(en.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===n&&r.done()}).next(()=>i)}newChangeBuffer(e){return new sk(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return tV(e,e9).get(te).next(e=>(L(!!e,20021),e))}br(e,t){return tV(e,e9).put(te,t)}Sr(e,t){if(t){let e=function(e,t){var r;let n,i;if(t.document)n=iE(e.yt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=en.fromSegments(t.noDocument.path),r=iV(t.noDocument.readTime);n=rA.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return O(56709);{let e=en.fromSegments(t.unknownDocument.path),r=iV(t.unknownDocument.version);n=rA.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime((i=new ec((r=t.readTime)[0],r[1]),ed.fromTimestamp(i))),n}(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(ed.min())))return e}return rA.newInvalidDocument(e)}}class sk extends sC{constructor(e,t){super(),this.Mr=e,this.trackRemovals=t,this.Or=new no(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],r=0,n=new tK((e,t)=>W(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.Or.get(i);if(t.push(this.Mr.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=iL(this.Mr.serializer,s);n=n.add(i.path.popLast());let l=sd(o);r+=l-a.size,t.push(this.Mr.addEntry(e,i,o))}else if(r-=a.size,this.trackRemovals){let r=iL(this.Mr.serializer,s.convertToNoDocument(ed.min()));t.push(this.Mr.addEntry(e,i,r))}}),n.forEach(r=>{t.push(this.Mr.indexManager.addToCollectionParentIndex(e,r))}),t.push(this.Mr.updateMetadata(e,r)),eC.waitFor(t)}getFromCache(e,t){return this.Mr.Dr(e,t).next(e=>(this.Or.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Mr.vr(e,t).next(({documents:e,Fr:t})=>(t.forEach((t,r)=>{this.Or.set(t,{size:r,readTime:e.get(t).readTime})}),e))}}function sx(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function sD(e,t){let r=t.documentKey.path.toArray();return[e,iM(t.readTime),r.slice(0,r.length-2),r.length>0?r[r.length-1]:""]}function sN(e,t){let r=e.path.toArray(),n=t.path.toArray(),i=0;for(let e=0;e<r.length-2&&e<n.length-2;++e)if(i=W(r[e],n[e]))return i;return(i=W(r.length,n.length))||(i=W(r[r.length-2],n[n.length-2]))||W(r[r.length-1],n[n.length-1])}class sR{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class sO{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(r=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&nL(r.mutation,e,tW.empty(),ec.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,ng()).next(()=>t))}getLocalViewOfDocuments(e,t,r=ng()){let n=nd();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let t=nh();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let r=nd();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,ng()))}populateOverlays(e,t,r){let n=[];return r.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,n){let i=nl,s=nd(),a=nd();return t.forEach((e,t)=>{let a=r.get(t.key);n.has(t.key)&&(void 0===a||a.mutation instanceof nV)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),nL(a.mutation,t,a.mutation.getFieldMask(),ec.now())):s.set(t.key,tW.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>a.set(e,new sR(t,s.get(e)??null))),a))}recalculateAndSaveOverlays(e,t){let r=nd(),n=new tj((e,t)=>e-t),i=ng();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=r.get(e)||tW.empty();a=i.applyToLocalView(s,a),r.set(e,a);let o=(n.get(i.batchId)||ng()).add(e);n=n.insert(i.batchId,o)})}).next(()=>{let s=[],a=n.getReverseIterator();for(;a.hasNext();){let n=a.getNext(),o=n.key,l=n.value,u=nd();l.forEach(e=>{if(!i.has(e)){let n=nP(t.get(e),r.get(e));null!==n&&u.set(e,n),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return eC.waitFor(s)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,n){return en.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):r5(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n)}getNextDocuments(e,t,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,n).next(i=>{let s=n-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,n-i.size):eC.resolve(nd()),a=-1,o=i;return s.next(t=>eC.forEach(t,(t,r)=>(a<r.largestBatchId&&(a=r.largestBatchId),i.get(t)?eC.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,ng())).next(e=>({batchId:a,changes:nc(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new en(t)).next(e=>{let t=nh();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,n){let i=t.collectionGroup,s=nh();return this.indexManager.getCollectionParents(e,i).next(a=>eC.forEach(a,a=>{let o=new r2(a.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,r,n).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,n))).next(e=>{i.forEach((t,r)=>{let n=r.getKey();null===e.get(n)&&(e=e.insert(n,rA.newInvalidDocument(n)))});let r=nh();return e.forEach((e,n)=>{let s=i.get(e);void 0!==s&&nL(s.mutation,n,tW.empty(),ec.now()),ni(t,n)&&(r=r.insert(e,n))}),r})}}class sP{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return eC.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,{id:t.id,version:t.version,createTime:ic(t.createTime)}),eC.resolve()}getNamedQuery(e,t){return eC.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,{name:t.name,query:ij(t.bundledQuery),readTime:ic(t.readTime)}),eC.resolve()}}class sL{constructor(){this.overlays=new tj(en.comparator),this.Lr=new Map}getOverlay(e,t){return eC.resolve(this.overlays.get(t))}getOverlays(e,t){let r=nd();return eC.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,n)=>{this.bt(e,t,n)}),eC.resolve()}removeOverlaysForBatchId(e,t,r){let n=this.Lr.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.Lr.delete(r)),eC.resolve()}getOverlaysForCollection(e,t,r){let n=nd(),i=t.length+1,s=new en(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>r&&n.set(e.getKey(),e)}return eC.resolve(n)}getOverlaysForCollectionGroup(e,t,r,n){let i=new tj((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=i.get(e.largestBatchId);null===t&&(t=nd(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=nd(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=n)););return eC.resolve(a)}bt(e,t,r){let n=this.overlays.get(r.key);if(null!==n){let e=this.Lr.get(n.largestBatchId).delete(r.key);this.Lr.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new nG(t,r));let i=this.Lr.get(t);void 0===i&&(i=ng(),this.Lr.set(t,i)),this.Lr.set(t,i.add(r.key))}}class sM{constructor(){this.sessionToken=tJ.EMPTY_BYTE_STRING}getSessionToken(e){return eC.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,eC.resolve()}}class sF{constructor(){this.kr=new tK(sV.Kr),this.qr=new tK(sV.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){let r=new sV(e,t);this.kr=this.kr.add(r),this.qr=this.qr.add(r)}$r(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Wr(new sV(e,t))}Qr(e,t){e.forEach(e=>this.removeReference(e,t))}Gr(e){let t=new en(new ee([])),r=new sV(t,e),n=new sV(t,e+1),i=[];return this.qr.forEachInRange([r,n],e=>{this.Wr(e),i.push(e.key)}),i}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){let t=new en(new ee([])),r=new sV(t,e),n=new sV(t,e+1),i=ng();return this.qr.forEachInRange([r,n],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new sV(e,0),r=this.kr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class sV{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return en.comparator(e.key,t.key)||W(e.Hr,t.Hr)}static Ur(e,t){return W(e.Hr,t.Hr)||en.comparator(e.key,t.key)}}class sU{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new tK(sV.Kr)}checkEmpty(e){return eC.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){let i=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new nz(i,t,r,n);for(let t of(this.mutationQueue.push(s),n))this.Jr=this.Jr.add(new sV(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return eC.resolve(s)}lookupMutationBatch(e,t){return eC.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let r=this.Xr(t+1),n=r<0?0:r;return eC.resolve(this.mutationQueue.length>n?this.mutationQueue[n]:null)}getHighestUnacknowledgedBatchId(){return eC.resolve(0===this.mutationQueue.length?-1:this.Yn-1)}getAllMutationBatches(e){return eC.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new sV(t,0),n=new sV(t,1/0),i=[];return this.Jr.forEachInRange([r,n],e=>{let t=this.Zr(e.Hr);i.push(t)}),eC.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new tK(W);return t.forEach(e=>{let t=new sV(e,0),n=new sV(e,1/0);this.Jr.forEachInRange([t,n],e=>{r=r.add(e.Hr)})}),eC.resolve(this.Yr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=r;en.isDocumentKey(i)||(i=i.child(""));let s=new sV(new en(i),0),a=new tK(W);return this.Jr.forEachWhile(e=>{let t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(a=a.add(e.Hr)),!0)},s),eC.resolve(this.Yr(a))}Yr(e){let t=[];return e.forEach(e=>{let r=this.Zr(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){L(0===this.ei(t.batchId,"removed"),55003),this.mutationQueue.shift();let r=this.Jr;return eC.forEach(t.mutations,n=>{let i=new sV(n.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.Jr=r})}nr(e){}containsKey(e,t){let r=new sV(t,0),n=this.Jr.firstAfterOrEqual(r);return eC.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,eC.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class sB{constructor(e){this.ti=e,this.docs=new tj(en.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,n=this.docs.get(r),i=n?n.size:0,s=this.ti(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return eC.resolve(r?r.document.mutableCopy():rA.newInvalidDocument(t))}getEntries(e,t){let r=nl;return t.forEach(e=>{let t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():rA.newInvalidDocument(e))}),eC.resolve(r)}getDocumentsMatchingQuery(e,t,r,n){let i=nl,s=t.path,a=new en(s.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=eI(eb(a),r)||(n.has(a.key)||ni(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return eC.resolve(i)}getAllFromCollectionGroup(e,t,r,n){O(9500)}ni(e,t){return eC.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new sq(this)}getSize(e){return eC.resolve(this.size)}}class sq extends sC{constructor(e){super(),this.Mr=e}applyChanges(e){let t=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?t.push(this.Mr.addEntry(e,n)):this.Mr.removeEntry(r)}),eC.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class sj{constructor(e){this.persistence=e,this.ri=new no(e=>rJ(e),rY),this.lastRemoteSnapshotVersion=ed.min(),this.highestTargetId=0,this.ii=0,this.si=new sF,this.targetCount=0,this.oi=sm._r()}forEachTarget(e,t){return this.ri.forEach((e,r)=>t(r)),eC.resolve()}getLastRemoteSnapshotVersion(e){return eC.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return eC.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),eC.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.ii&&(this.ii=t),eC.resolve()}lr(e){this.ri.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.oi=new sm(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,eC.resolve()}updateTargetData(e,t){return this.lr(t),eC.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,eC.resolve()}removeTargets(e,t,r){let n=0,i=[];return this.ri.forEach((s,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.ri.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),n++)}),eC.waitFor(i).next(()=>n)}getTargetCount(e){return eC.resolve(this.targetCount)}getTargetData(e,t){let r=this.ri.get(t)||null;return eC.resolve(r)}addMatchingKeys(e,t,r){return this.si.$r(t,r),eC.resolve()}removeMatchingKeys(e,t,r){this.si.Qr(t,r);let n=this.persistence.referenceDelegate,i=[];return n&&t.forEach(t=>{i.push(n.markPotentiallyOrphaned(e,t))}),eC.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),eC.resolve()}getMatchingKeysForTargetId(e,t){let r=this.si.jr(t);return eC.resolve(r)}containsKey(e,t){return eC.resolve(this.si.containsKey(t))}}class s${constructor(e,t){this._i={},this.overlays={},this.ai=new eq(0),this.ui=!1,this.ui=!0,this.ci=new sM,this.referenceDelegate=e(this),this.li=new sj(this),this.indexManager=new sn,this.remoteDocumentCache=function(e){return new sB(e)}(e=>this.referenceDelegate.hi(e)),this.serializer=new iP(t),this.Pi=new sP(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new sL,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this._i[e.toKey()];return r||(r=new sU(t,this.referenceDelegate),this._i[e.toKey()]=r),r}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,r){x("MemoryPersistence","Starting transaction:",e);let n=new sz(this.ai.next());return this.referenceDelegate.Ti(),r(n).next(e=>this.referenceDelegate.Ii(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}Ei(e,t){return eC.or(Object.values(this._i).map(r=>()=>r.containsKey(e,t)))}}class sz extends eT{constructor(e){super(),this.currentSequenceNumber=e}}class sK{constructor(e){this.persistence=e,this.Ri=new sF,this.Ai=null}static Vi(e){return new sK(e)}get di(){if(this.Ai)return this.Ai;throw O(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.di.delete(r.toString()),eC.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.di.add(r.toString()),eC.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),eC.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach(e=>this.di.add(e.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.di.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}Ti(){this.Ai=new Set}Ii(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return eC.forEach(this.di,r=>{let n=en.fromPath(r);return this.mi(e,n).next(e=>{e||t.removeEntry(n,ed.min())})}).next(()=>(this.Ai=null,t.apply(e)))}updateLimboDocument(e,t){return this.mi(e,t).next(e=>{e?this.di.delete(t.toString()):this.di.add(t.toString())})}hi(e){return 0}mi(e,t){return eC.or([()=>eC.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class sG{constructor(e,t){this.persistence=e,this.fi=new no(e=>eK(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=function(e,t){return new sE(e,t)}(this,t)}static Vi(e,t){return new sG(e,t)}Ti(){}Ii(e){return eC.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){let t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}pr(e){let t=0;return this.mr(e,e=>{t++}).next(()=>t)}mr(e,t){return eC.forEach(this.fi,(r,n)=>this.wr(e,r,n).next(e=>e?eC.resolve():t(n)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,n=this.persistence.getRemoteDocumentCache(),i=n.newChangeBuffer();return n.ni(e,n=>this.wr(e,n,t).next(e=>{e||(r++,i.removeEntry(n,ed.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),eC.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),eC.resolve()}removeReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),eC.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),eC.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(ro(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let r=t4(t);return r?16+e(r):16;case 5:return 2*t.stringValue.length;case 6:return t0(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,r)=>t+e(r),0);case 10:case 11:var n;let i;return n=t.mapValue,i=0,tB(n.fields,(t,r)=>{i+=t.length+e(r)}),i;default:throw O(13486,{value:t})}}(e.data.value)),t}wr(e,t,r){return eC.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.fi.get(t);return eC.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class sH{constructor(e){this.serializer=e}k(e,t,r,n){let i=new ek("createOrUpgrade",t);r<1&&n>=1&&(e.createObjectStore(eW),e.createObjectStore(eJ,{keyPath:"userId"}),e.createObjectStore(eY,{keyPath:eX,autoIncrement:!0}).createIndex(eZ,e0,{unique:!0}),e.createObjectStore(e2),sW(e),e.createObjectStore(eH));let s=eC.resolve();return r<3&&n>=3&&(0!==r&&(e.deleteObjectStore(ti),e.deleteObjectStore(tt),e.deleteObjectStore(tu),sW(e)),s=s.next(()=>{let e,t;return e=i.store(tu),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ed.min().toTimestamp(),targetCount:0},e.put(tl,t)})),r<4&&n>=4&&(0!==r&&(s=s.next(()=>i.store(eY).H().next(t=>{e.deleteObjectStore(eY),e.createObjectStore(eY,{keyPath:eX,autoIncrement:!0}).createIndex(eZ,e0,{unique:!0});let r=i.store(eY),n=t.map(e=>r.put(e));return eC.waitFor(n)}))),s=s.next(()=>{e.createObjectStore(td,{keyPath:"clientId"})})),r<5&&n>=5&&(s=s.next(()=>this.gi(i))),r<6&&n>=6&&(s=s.next(()=>(e.createObjectStore(e9),this.pi(i)))),r<7&&n>=7&&(s=s.next(()=>this.yi(i))),r<8&&n>=8&&(s=s.next(()=>this.wi(e,i))),r<9&&n>=9&&(s=s.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),r<10&&n>=10&&(s=s.next(()=>this.bi(i))),r<11&&n>=11&&(s=s.next(()=>{e.createObjectStore(tf,{keyPath:"bundleId"}),e.createObjectStore(tp,{keyPath:"name"})})),r<12&&n>=12&&(s=s.next(()=>{let t;(t=e.createObjectStore(tS,{keyPath:tC})).createIndex(tA,tk,{unique:!1}),t.createIndex(tx,tD,{unique:!1})})),r<13&&n>=13&&(s=s.next(()=>{let t;(t=e.createObjectStore(e6,{keyPath:e3})).createIndex(e5,e4),t.createIndex(e8,e7)}).next(()=>this.Si(e,i)).next(()=>e.deleteObjectStore(eH))),r<14&&n>=14&&(s=s.next(()=>this.Di(e,i))),r<15&&n>=15&&(s=s.next(()=>{e.createObjectStore(tg,{keyPath:"indexId",autoIncrement:!0}).createIndex(tm,"collectionGroup",{unique:!1}),e.createObjectStore(ty,{keyPath:tw}).createIndex(tv,tb,{unique:!1}),e.createObjectStore(t_,{keyPath:tI}).createIndex(tE,tT,{unique:!1})})),r<16&&n>=16&&(s=s.next(()=>{t.objectStore(ty).clear()}).next(()=>{t.objectStore(t_).clear()})),r<17&&n>=17&&(s=s.next(()=>{e.createObjectStore(tN,{keyPath:"name"})})),r<18&&n>=18&&(0,v.isSafariOrWebkit)()&&(s=s.next(()=>{t.objectStore(ty).clear()}).next(()=>{t.objectStore(t_).clear()})),s}pi(e){let t=0;return e.store(eH).ee((e,r)=>{t+=sd(r)}).next(()=>{let r={byteSize:t};return e.store(e9).put(te,r)})}gi(e){let t=e.store(eJ),r=e.store(eY);return t.H().next(t=>eC.forEach(t,t=>{let n=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return r.H(eZ,n).next(r=>eC.forEach(r,r=>{L(r.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:r.batchId});let n=iU(this.serializer,r);return sc(e,t.userId,n).next(()=>{})}))}))}yi(e){let t=e.store(ti),r=e.store(eH);return e.store(tu).get(tl).next(e=>{let n=[];return r.ee((r,i)=>{let s=new ee(r),a=[0,eK(s)];n.push(t.get(a).next(r=>r?eC.resolve():t.put({targetId:0,path:eK(s),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>eC.waitFor(n))})}wi(e,t){e.createObjectStore(th,{keyPath:tc});let r=t.store(th),n=new si,i=e=>{if(n.add(e)){let t=e.lastSegment(),n=e.popLast();return r.put({collectionId:t,parent:eK(n)})}};return t.store(eH).ee({Y:!0},(e,t)=>i(new ee(e).popLast())).next(()=>t.store(e2).ee({Y:!0},([e,t,r],n)=>i(eG(t).popLast())))}bi(e){let t=e.store(tt);return t.ee((e,r)=>{let n=iB(r),i=iq(this.serializer,n);return t.put(i)})}Si(e,t){let r=t.store(eH),n=[];return r.ee((e,r)=>{let i=t.store(e6),s=(r.document?new en(ee.fromString(r.document.name).popFirst(5)):r.noDocument?en.fromSegments(r.noDocument.path):r.unknownDocument?en.fromSegments(r.unknownDocument.path):O(36783)).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:r.readTime||[0,0],unknownDocument:r.unknownDocument,noDocument:r.noDocument,document:r.document,hasCommittedMutations:!!r.hasCommittedMutations};n.push(i.put(a))}).next(()=>eC.waitFor(n))}Di(e,t){let r=t.store(eY),n=new sA(this.serializer),i=new s$(sK.Vi,this.serializer.yt);return r.H().next(e=>{let r=new Map;return e.forEach(e=>{let t=r.get(e.userId)??ng();iU(this.serializer,e).keys().forEach(e=>t=t.add(e)),r.set(e.userId,t)}),eC.forEach(r,(e,r)=>{let s=new S(r),a=iH.wt(this.serializer,s),o=i.getIndexManager(s);return new sO(n,sf.wt(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new tF(t,eq.ce),e).next()})})}}function sW(e){e.createObjectStore(ti,{keyPath:ts}).createIndex(ta,to,{unique:!0}),e.createObjectStore(tt,{keyPath:"targetId"}).createIndex(tr,tn,{unique:!0}),e.createObjectStore(tu)}let sQ="IndexedDbPersistence",sJ="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class sY{constructor(e,t,r,n,i,s,a,o,l,u,h=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Ci=i,this.window=s,this.document=a,this.Fi=l,this.Mi=u,this.xi=h,this.ai=null,this.ui=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Oi=null,this.inForeground=!1,this.Ni=null,this.Bi=null,this.Li=-1/0,this.ki=e=>Promise.resolve(),!sY.v())throw new F(M.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new sT(this,n),this.Ki=t+"main",this.serializer=new iP(o),this.qi=new ex(this.Ki,this.xi,new sH(this.serializer)),this.ci=new iW,this.li=new sy(this.referenceDelegate,this.serializer),this.remoteDocumentCache=function(e){return new sA(e)}(this.serializer),this.Pi=new iG,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,!1===u&&D(sQ,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.$i().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new F(M.FAILED_PRECONDITION,sJ);return this.Wi(),this.Qi(),this.Gi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.li.getHighestSequenceNumber(e))}).then(e=>{this.ai=new eq(e,this.Fi)}).then(()=>{this.ui=!0}).catch(e=>(this.qi&&this.qi.close(),Promise.reject(e)))}zi(e){return this.ki=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.qi.q(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Ci.enqueueAndForget(async()=>{this.started&&await this.$i()}))}$i(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>tV(e,td).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.ji(e).next(e=>{e||(this.isPrimary=!1,this.Ci.enqueueRetryable(()=>this.ki(!1)))})}).next(()=>this.Hi(e)).next(t=>this.isPrimary&&!t?this.Ji(e).next(()=>!1):!!t&&this.Zi(e).next(()=>!0))).catch(e=>{if(eO(e))return x(sQ,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return x(sQ,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Ci.enqueueRetryable(()=>this.ki(e)),this.isPrimary=e})}ji(e){return tV(e,eW).get(eQ).next(e=>eC.resolve(this.Xi(e)))}Yi(e){return tV(e,td).delete(this.clientId)}async es(){if(this.isPrimary&&!this.ts(this.Li,18e5)){this.Li=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=tV(e,td);return t.H().next(e=>{let r=this.ns(e,18e5),n=e.filter(e=>-1===r.indexOf(e));return eC.forEach(n,e=>t.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.Ui)for(let t of e)this.Ui.removeItem(this.rs(t.clientId))}}Gi(){this.Bi=this.Ci.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.$i().then(()=>this.es()).then(()=>this.Gi()))}Xi(e){return!!e&&e.ownerId===this.clientId}Hi(e){return this.Mi?eC.resolve(!0):tV(e,eW).get(eQ).next(t=>{if(null!==t&&this.ts(t.leaseTimestampMs,5e3)&&!this.ss(t.ownerId)){if(this.Xi(t)&&this.networkEnabled)return!0;if(!this.Xi(t)){if(!t.allowTabSynchronization)throw new F(M.FAILED_PRECONDITION,sJ);return!1}}return!(!this.networkEnabled||!this.inForeground)||tV(e,td).H().next(e=>void 0===this.ns(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,r=!this.inForeground&&e.inForeground,n=this.networkEnabled===e.networkEnabled;if(t||r&&n)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&x(sQ,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.ui=!1,this._s(),this.Bi&&(this.Bi.cancel(),this.Bi=null),this.us(),this.cs(),await this.qi.runTransaction("shutdown","readwrite",[eW,td],e=>{let t=new tF(e,eq.ce);return this.Ji(t).next(()=>this.Yi(t))}),this.qi.close(),this.ls()}ns(e,t){return e.filter(e=>this.ts(e.updateTimeMs,t)&&!this.ss(e.clientId))}hs(){return this.runTransaction("getActiveClients","readonly",e=>tV(e,td).H().next(e=>this.ns(e,18e5).map(e=>e.clientId)))}get started(){return this.ui}getGlobalsCache(){return this.ci}getMutationQueue(e,t){return sf.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new so(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return iH.wt(this.serializer,e)}getBundleCache(){return this.Pi}runTransaction(e,t,r){var n;let i;x(sQ,"Starting transaction:",e);let s=18===(n=this.xi)||17===n?tM:16===n||15===n?tL:14===n||13===n?tP:12===n?tO:11===n?tR:void O(60245);return this.qi.runTransaction(e,"readonly"===t?"readonly":"readwrite",s,n=>(i=new tF(n,this.ai?this.ai.next():eq.ce),"readwrite-primary"===t?this.ji(i).next(e=>!!e||this.Hi(i)).next(t=>{if(!t)throw D(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Ci.enqueueRetryable(()=>this.ki(!1)),new F(M.FAILED_PRECONDITION,eE);return r(i)}).next(e=>this.Zi(i).next(()=>e)):this.Ps(i).next(()=>r(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}Ps(e){return tV(e,eW).get(eQ).next(e=>{if(null!==e&&this.ts(e.leaseTimestampMs,5e3)&&!this.ss(e.ownerId)&&!this.Xi(e)&&!(this.Mi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new F(M.FAILED_PRECONDITION,sJ)})}Zi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return tV(e,eW).put(eQ,t)}static v(){return ex.v()}Ji(e){let t=tV(e,eW);return t.get(eQ).next(e=>this.Xi(e)?(x(sQ,"Releasing primary lease."),t.delete(eQ)):eC.resolve())}ts(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(D(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Wi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ni=()=>{this.Ci.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.$i()))},this.document.addEventListener("visibilitychange",this.Ni),this.inForeground="visible"===this.document.visibilityState)}us(){this.Ni&&(this.document.removeEventListener("visibilitychange",this.Ni),this.Ni=null)}Qi(){"function"==typeof this.window?.addEventListener&&(this.Oi=()=>{this._s();let e=/(?:Version|Mobile)\/1[456]/;(0,v.isSafari)()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Ci.enterRestrictedMode(!0),this.Ci.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Oi))}cs(){this.Oi&&(this.window.removeEventListener("pagehide",this.Oi),this.Oi=null)}ss(e){try{let t=null!==this.Ui?.getItem(this.rs(e));return x(sQ,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(e){return D(sQ,"Failed to get zombied client id.",e),!1}}_s(){if(this.Ui)try{this.Ui.setItem(this.rs(this.clientId),String(Date.now()))}catch(e){D("Failed to set zombie client id.",e)}}ls(){if(this.Ui)try{this.Ui.removeItem(this.rs(this.clientId))}catch(e){}}rs(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function sX(e,t){let r=e.projectId;return e.isDefaultDatabase||(r+="."+e.database),"firestore/"+t+"/"+r+"/"}class sZ{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.Ts=r,this.Is=n}static Es(e,t){let r=ng(),n=ng();for(let e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new sZ(e,t.fromCache,r,n)}}class s0{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class s1{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=(0,v.isSafari)()?8:eD((0,v.getUA)())>0?6:4}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,n){let i={result:null};return this.gs(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ps(e,t,n,r).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let r=new s0;return this.ys(e,t,r).next(n=>{if(i.result=n,this.As)return this.ws(e,t,r,n.size)})}).next(()=>i.result)}ws(e,t,r,n){return r.documentReadCount<this.Vs?(k()<=I.LogLevel.DEBUG&&x("QueryEngine","SDK will not create cache indexes for query:",nn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),eC.resolve()):(k()<=I.LogLevel.DEBUG&&x("QueryEngine","Query:",nn(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.ds*n?(k()<=I.LogLevel.DEBUG&&x("QueryEngine","The SDK decides to create cache indexes for query:",nn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,r8(t))):eC.resolve())}gs(e,t){if(r3(t))return eC.resolve(null);let r=r8(t);return this.indexManager.getIndexType(e,r).next(n=>0===n?null:(null!==t.limit&&1===n&&(r=r8(t=ne(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,r).next(n=>{let i=ng(...n);return this.fs.getDocuments(e,i).next(n=>this.indexManager.getMinOffset(e,r).next(r=>{let s=this.bs(t,n);return this.Ss(t,s,i,r.readTime)?this.gs(e,ne(t,null,"F")):this.Ds(e,s,t,r)}))})))}ps(e,t,r,n){return r3(t)||n.isEqual(ed.min())?eC.resolve(null):this.fs.getDocuments(e,r).next(i=>{let s=this.bs(t,i);return this.Ss(t,s,r,n)?eC.resolve(null):(k()<=I.LogLevel.DEBUG&&x("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),nn(t)),this.Ds(e,s,t,ev(n,-1)).next(e=>e))})}bs(e,t){let r=new tK(na(e));return t.forEach((t,n)=>{ni(e,n)&&(r=r.add(n))}),r}Ss(e,t,r,n){if(null===e.limit)return!1;if(r.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(n)>0)}ys(e,t,r){return k()<=I.LogLevel.DEBUG&&x("QueryEngine","Using full collection scan to execute query:",nn(t)),this.fs.getDocumentsMatchingQuery(e,t,e_.min(),r)}Ds(e,t,r,n){return this.fs.getDocumentsMatchingQuery(e,r,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let s2="LocalStore";class s6{constructor(e,t,r,n){this.persistence=e,this.Cs=t,this.serializer=n,this.vs=new tj(W),this.Fs=new no(e=>rJ(e),rY),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(r)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new sO(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.vs))}}async function s3(e,t){return await e.persistence.runTransaction("Handle user change","readonly",r=>{let n;return e.mutationQueue.getAllMutationBatches(r).next(i=>(n=i,e.Os(t),e.mutationQueue.getAllMutationBatches(r))).next(t=>{let i=[],s=[],a=ng();for(let e of n)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(r,a).next(e=>({Ns:e,removedBatchIds:i,addedBatchIds:s}))})})}function s5(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.li.getLastRemoteSnapshotVersion(t))}function s4(e,t,r){let n=ng(),i=ng();return r.forEach(e=>n=n.add(e)),t.getEntries(e,n).next(e=>{let n=nl;return r.forEach((r,s)=>{let a=e.get(r);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(r)),s.isNoDocument()&&s.version.isEqual(ed.min())?(t.removeEntry(r,s.readTime),n=n.insert(r,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),n=n.insert(r,s)):x(s2,"Ignoring outdated watch update for ",r,". Current version:",a.version," Watch version:",s.version)}),{Bs:n,Ls:i}})}function s8(e,t){return e.persistence.runTransaction("Allocate target","readwrite",r=>{let n;return e.li.getTargetData(r,t).next(i=>i?(n=i,eC.resolve(n)):e.li.allocateTargetId(r).next(i=>(n=new iO(t,i,"TargetPurposeListen",r.currentSequenceNumber),e.li.addTargetData(r,n).next(()=>n))))}).then(r=>{let n=e.vs.get(r.targetId);return(null===n||r.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(e.vs=e.vs.insert(r.targetId,r),e.Fs.set(t,r.targetId)),r})}async function s7(e,t,r){let n=e.vs.get(t);try{r||await e.persistence.runTransaction("Release target",r?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,n))}catch(e){if(!eO(e))throw e;x(s2,`Failed to update sequence numbers for target ${t}: ${e}`)}e.vs=e.vs.remove(t),e.Fs.delete(n.target)}function s9(e,t,r){let n=ed.min(),i=ng();return e.persistence.runTransaction("Execute query","readwrite",s=>{var a;let o;return(a=r8(t),void 0!==(o=e.Fs.get(a))?eC.resolve(e.vs.get(o)):e.li.getTargetData(s,a)).next(t=>{if(t)return n=t.lastLimboFreeSnapshotVersion,e.li.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Cs.getDocumentsMatchingQuery(s,t,r?n:ed.min(),r?i:ng())).next(r=>(ar(e,ns(t),r),{documents:r,ks:i}))})}function ae(e,t){let r=e.li,n=e.vs.get(t);return n?Promise.resolve(n.target):e.persistence.runTransaction("Get target data","readonly",e=>r.At(e,t).next(e=>e?e.target:null))}function at(e,t){let r=e.Ms.get(t)||ed.min();return e.persistence.runTransaction("Get new document changes","readonly",n=>e.xs.getAllFromCollectionGroup(n,t,ev(r,-1),Number.MAX_SAFE_INTEGER)).then(r=>(ar(e,t,r),r))}function ar(e,t,r){let n=e.Ms.get(t)||ed.min();r.forEach((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)}),e.Ms.set(t,n)}async function an(e,t,r,n){let i=ng(),s=nl;for(let e of r){let r=t.Ks(e.metadata.name);e.document&&(i=i.add(r));let n=t.qs(e);n.setReadTime(t.Us(e.metadata.readTime)),s=s.insert(r,n)}let a=e.xs.newChangeBuffer({trackRemovals:!0}),o=await s8(e,r8(r6(ee.fromString(`__bundle__/docs/${n}`))));return e.persistence.runTransaction("Apply bundle documents","readwrite",t=>s4(t,a,s).next(e=>(a.apply(t),e)).next(r=>e.li.removeMatchingKeysForTargetId(t,o.targetId).next(()=>e.li.addMatchingKeys(t,i,o.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(t,r.Bs,r.Ls)).next(()=>r.Bs)))}async function ai(e,t,r=ng()){let n=await s8(e,r8(ij(t.bundledQuery)));return e.persistence.runTransaction("Save named query","readwrite",i=>{let s=ic(t.readTime);if(n.snapshotVersion.compareTo(s)>=0)return e.Pi.saveNamedQuery(i,t);let a=n.withResumeToken(tJ.EMPTY_BYTE_STRING,s);return e.vs=e.vs.insert(a.targetId,a),e.li.updateTargetData(i,a).next(()=>e.li.removeMatchingKeysForTargetId(i,n.targetId)).next(()=>e.li.addMatchingKeys(i,r,n.targetId)).next(()=>e.Pi.saveNamedQuery(i,t))})}let as="firestore_clients";function aa(e,t){return`${as}_${e}_${t}`}let ao="firestore_mutations";function al(e,t,r){let n=`${ao}_${e}_${r}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}let au="firestore_targets";function ah(e,t){return`${au}_${e}_${t}`}let ac="SharedClientState";class ad{constructor(e,t,r,n){this.user=e,this.batchId=t,this.state=r,this.error=n}static $s(e,t,r){let n=JSON.parse(r),i,s="object"==typeof n&&-1!==["pending","acknowledged","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new F(n.error.code,n.error.message)),s?new ad(e,t,n.state,i):(D(ac,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class af{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static $s(e,t){let r=JSON.parse(t),n,i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(n=new F(r.error.code,r.error.message)),i?new af(e,r.state,n):(D(ac,`Failed to parse target state for ID '${e}': ${t}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ap{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static $s(e,t){let r=JSON.parse(t),n="object"==typeof r&&r.activeTargetIds instanceof Array,i=nm;for(let e=0;n&&e<r.activeTargetIds.length;++e)n=ez(r.activeTargetIds[e]),i=i.add(r.activeTargetIds[e]);return n?new ap(e,i):(D(ac,`Failed to parse client data for instance '${e}': ${t}`),null)}}class ag{constructor(e,t){this.clientId=e,this.onlineState=t}static $s(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new ag(t.clientId,t.onlineState):(D(ac,`Failed to parse online state: ${e}`),null)}}class am{constructor(){this.activeTargetIds=nm}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class ay{constructor(e,t,r,n,i){this.window=e,this.Ci=t,this.persistenceKey=r,this.zs=n,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.js=this.Hs.bind(this),this.Js=new tj(W),this.started=!1,this.Zs=[];const s=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Xs=aa(this.persistenceKey,this.zs),this.Ys=function(e){return`firestore_sequence_number_${e}`}(this.persistenceKey),this.Js=this.Js.insert(this.zs,new am),this.eo=RegExp(`^${as}_${s}_([^_]*)$`),this.no=RegExp(`^${ao}_${s}_(\\d+)(?:_(.*))?$`),this.ro=RegExp(`^${au}_${s}_(\\d+)$`),this.io=function(e){return`firestore_online_state_${e}`}(this.persistenceKey),this.so=function(e){return`firestore_bundle_loaded_v2_${e}`}(this.persistenceKey),this.window.addEventListener("storage",this.js)}static v(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.hs())){if(e===this.zs)continue;let t=this.getItem(aa(this.persistenceKey,e));if(t){let r=ap.$s(e,t);r&&(this.Js=this.Js.insert(r.clientId,r))}}this.oo();let e=this.storage.getItem(this.io);if(e){let t=this._o(e);t&&this.ao(t)}for(let e of this.Zs)this.Hs(e);this.Zs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ys,JSON.stringify(e))}getAllActiveQueryTargets(){return this.uo(this.Js)}isActiveQueryTarget(e){let t=!1;return this.Js.forEach((r,n)=>{n.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.co(e,"pending")}updateMutationState(e,t,r){this.co(e,t,r),this.lo(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(ah(this.persistenceKey,e));if(t){let n=af.$s(e,t);n&&(r=n.state)}}return t&&this.ho.Qs(e),this.oo(),r}removeLocalQueryTarget(e){this.ho.Gs(e),this.oo()}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(ah(this.persistenceKey,e))}updateQueryState(e,t,r){this.Po(e,t,r)}handleUserChange(e,t,r){t.forEach(e=>{this.lo(e)}),this.currentUser=e,r.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.To(e)}notifyBundleLoaded(e){this.Io(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.js),this.removeItem(this.Xs),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return x(ac,"READ",e,t),t}setItem(e,t){x(ac,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){x(ac,"REMOVE",e),this.storage.removeItem(e)}Hs(e){if(e.storageArea===this.storage){if(x(ac,"EVENT",e.key,e.newValue),e.key===this.Xs)return void D("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Ci.enqueueRetryable(async()=>{if(this.started){if(null!==e.key){if(this.eo.test(e.key)){if(null==e.newValue){let t=this.Eo(e.key);return this.Ro(t,null)}{let t=this.Ao(e.key,e.newValue);if(t)return this.Ro(t.clientId,t)}}else if(this.no.test(e.key)){if(null!==e.newValue){let t=this.Vo(e.key,e.newValue);if(t)return this.mo(t)}}else if(this.ro.test(e.key)){if(null!==e.newValue){let t=this.fo(e.key,e.newValue);if(t)return this.po(t)}}else if(e.key===this.io){if(null!==e.newValue){let t=this._o(e.newValue);if(t)return this.ao(t)}}else if(e.key===this.Ys){let t=function(e){let t=eq.ce;if(null!=e)try{let r=JSON.parse(e);L("number"==typeof r,30636,{yo:e}),t=r}catch(e){D(ac,"Failed to read sequence number from WebStorage",e)}return t}(e.newValue);t!==eq.ce&&this.sequenceNumberHandler(t)}else if(e.key===this.so){let t=this.wo(e.newValue);await Promise.all(t.map(e=>this.syncEngine.bo(e)))}}}else this.Zs.push(e)})}}get ho(){return this.Js.get(this.zs)}oo(){this.setItem(this.Xs,this.ho.Ws())}co(e,t,r){let n=new ad(this.currentUser,e,t,r),i=al(this.persistenceKey,this.currentUser,e);this.setItem(i,n.Ws())}lo(e){let t=al(this.persistenceKey,this.currentUser,e);this.removeItem(t)}To(e){let t={clientId:this.zs,onlineState:e};this.storage.setItem(this.io,JSON.stringify(t))}Po(e,t,r){let n=ah(this.persistenceKey,e),i=new af(e,t,r);this.setItem(n,i.Ws())}Io(e){let t=JSON.stringify(Array.from(e));this.setItem(this.so,t)}Eo(e){let t=this.eo.exec(e);return t?t[1]:null}Ao(e,t){let r=this.Eo(e);return ap.$s(r,t)}Vo(e,t){let r=this.no.exec(e),n=Number(r[1]),i=void 0!==r[2]?r[2]:null;return ad.$s(new S(i),n,t)}fo(e,t){let r=Number(this.ro.exec(e)[1]);return af.$s(r,t)}_o(e){return ag.$s(e)}wo(e){return JSON.parse(e)}async mo(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.So(e.batchId,e.state,e.error);x(ac,`Ignoring mutation for non-active user ${e.user.uid}`)}po(e){return this.syncEngine.Do(e.targetId,e.state,e.error)}Ro(e,t){let r=t?this.Js.insert(e,t):this.Js.remove(e),n=this.uo(this.Js),i=this.uo(r),s=[],a=[];return i.forEach(e=>{n.has(e)||s.push(e)}),n.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.Co(s,a).then(()=>{this.Js=r})}ao(e){this.Js.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}uo(e){let t=nm;return e.forEach((e,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}class aw{constructor(){this.vo=new am,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,r){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new am,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class av{Mo(e){}shutdown(){}}let ab="ConnectivityMonitor";class a_{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){for(let e of(x(ab,"Network connectivity changed: AVAILABLE"),this.Lo))e(0)}Bo(){for(let e of(x(ab,"Network connectivity changed: UNAVAILABLE"),this.Lo))e(1)}static v(){return"u">typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let aI=null;function aE(){return null===aI?aI=0x10000000+Math.round(0x80000000*Math.random()):aI++,"0x"+aI.toString(16)}let aT="RestConnection",aS={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class aC{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${r}/databases/${n}`,this.$o=this.databaseId.database===t9?`project_id=${r}`:`project_id=${r}&database_id=${n}`}Wo(e,t,r,n,i){let s=aE(),a=this.Qo(e,t.toUriEncodedString());x(aT,`Sending RPC '${e}' ${s}:`,a,r);let o={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(o,n,i);let{host:l}=new URL(a),u=(0,v.isCloudWorkstation)(l);return this.zo(e,a,o,r,u).then(t=>(x(aT,`Received RPC '${e}' ${s}: `,t),t),t=>{throw N(aT,`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",r),t})}jo(e,t,r,n,i,s){return this.Wo(e,t,r,n,i)}Go(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+C,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,r)=>e[r]=t),r&&r.headers.forEach((t,r)=>e[r]=t)}Qo(e,t){let r=aS[e],n=`${this.qo}/v1/${t}:${r}`;return this.databaseInfo.apiKey&&(n=`${n}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),n}terminate(){}}class aA{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}let ak="WebChannelConnection",ax=(e,t,r)=>{e.listen(t,e=>{try{r(e)}catch(e){setTimeout(()=>{throw e},0)}})};class aD extends aC{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){aD.c_||(ax(u(),l.STAT_EVENT,e=>{e.stat===o.PROXY?x(ak,"STAT_EVENT: detected buffering proxy"):e.stat===o.NOPROXY&&x(ak,"STAT_EVENT: detected no buffering proxy")}),aD.c_=!0)}zo(e,t,r,i,o){let l=aE();return new Promise((o,u)=>{let h=new n;h.setWithCredentials(!0),h.listenOnce(s.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case a.NO_ERROR:let t=h.getResponseJson();x(ak,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(t)),o(t);break;case a.TIMEOUT:x(ak,`RPC '${e}' ${l} timed out`),u(new F(M.DEADLINE_EXCEEDED,"Request time out"));break;case a.HTTP_ERROR:let r=h.getStatus();if(x(ak,`RPC '${e}' ${l} failed with status:`,r,"response text:",h.getResponseText()),r>0){let e=h.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=e?.error;if(t&&t.status&&t.message){let e,r=(e=t.status.toLowerCase().replace(/_/g,"-"),Object.values(M).indexOf(e)>=0?e:M.UNKNOWN);u(new F(r,t.message))}else u(new F(M.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new F(M.UNAVAILABLE,"Connection failed."));break;default:O(9055,{l_:e,streamId:l,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{x(ak,`RPC '${e}' ${l} completed.`)}});let c=JSON.stringify(i);x(ak,`RPC '${e}' ${l} sending request:`,i),h.send(t,"POST",c,r,15)})}T_(e,t,r){let n=aE(),s=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=this.createWebChannelTransport(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.useFetchStreams=!0),this.Go(o.initMessageHeaders,t,r),o.encodeInitMessageHeaders=!0;let u=s.join("");x(ak,`Creating RPC '${e}' stream ${n}: ${u}`,o);let h=a.createWebChannel(u,o);this.I_(h);let d=!1,f=!1,p=new aA({Ho:t=>{f?x(ak,`Not sending because RPC '${e}' stream ${n} is closed:`,t):(d||(x(ak,`Opening RPC '${e}' stream ${n} transport.`),h.open(),d=!0),x(ak,`RPC '${e}' stream ${n} sending:`,t),h.send(t))},Jo:()=>h.close()});return ax(h,i.EventType.OPEN,()=>{f||(x(ak,`RPC '${e}' stream ${n} transport opened.`),p.i_())}),ax(h,i.EventType.CLOSE,()=>{f||(f=!0,x(ak,`RPC '${e}' stream ${n} transport closed`),p.o_(),this.E_(h))}),ax(h,i.EventType.ERROR,t=>{f||(f=!0,N(ak,`RPC '${e}' stream ${n} transport errored. Name:`,t.name,"Message:",t.message),p.o_(new F(M.UNAVAILABLE,"The operation could not be completed")))}),ax(h,i.EventType.MESSAGE,t=>{if(!f){let r=t.data[0];L(!!r,16349);let i=r?.error||r[0]?.error;if(i){x(ak,`RPC '${e}' stream ${n} received error:`,i);let t=i.status,r=function(e){let t=c[e];if(void 0!==t)return nJ(t)}(t),s=i.message;"NOT_FOUND"===t&&s.includes("database")&&s.includes("does not exist")&&s.includes(this.databaseId.database)&&N(`Database '${this.databaseId.database}' not found. Please check your project configuration.`),void 0===r&&(r=M.INTERNAL,s="Unknown error status: "+t+" with message "+i.message),f=!0,p.o_(new F(r,s)),h.close()}else x(ak,`RPC '${e}' stream ${n} received:`,r),p.__(r)}}),aD.u_(),setTimeout(()=>{p.s_()},0),p}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(t=>t===e)}Go(e,t,r){super.Go(e,t,r),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return h()}}function aN(){return"u">typeof window?window:null}function aR(){return"u">typeof document?document:null}function aO(e){return new io(e,!0)}aD.c_=!1;class aP{constructor(e,t,r=1e3,n=1.5,i=6e4){this.Ci=e,this.timerId=t,this.R_=r,this.A_=n,this.V_=i,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();let t=Math.floor(this.d_+this.y_()),r=Math.max(0,Date.now()-this.f_),n=Math.max(0,t-r);n>0&&x("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,n,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}let aL="PersistentStream";class aM{constructor(e,t,r,n,i,s,a,o){this.Ci=e,this.b_=r,this.S_=n,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new aP(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===M.RESOURCE_EXHAUSTED?(D(t.toString()),D("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===M.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;let e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,r])=>{this.D_===t&&this.G_(e,r)},t=>{e(()=>{let e=new F(M.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){let r=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.Yo(()=>{r(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(e=>{r(()=>this.z_(e))}),this.stream.onMessage(e=>{r(()=>1==++this.F_?this.H_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return x(aL,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget(()=>this.D_===e?t():(x(aL,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class aF extends aM{constructor(e,t,r,n,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=function(e,t){let r;if("targetChange"in t){var n,i;t.targetChange;let s="NO_CHANGE"===(n=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===n?1:"REMOVE"===n?2:"CURRENT"===n?3:"RESET"===n?4:O(39313,{state:n}),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.useProto3Json?(L(void 0===i||"string"==typeof i,58123),tJ.fromBase64String(i||"")):(L(void 0===i||i instanceof w.Buffer||i instanceof Uint8Array,16193),tJ.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;r=new n7(s,a,o,l&&new F(void 0===l.code?M.UNKNOWN:nJ(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let i=iy(e,n.document.name),s=ic(n.document.updateTime),a=n.document.createTime?ic(n.document.createTime):ed.min(),o=new rC({mapValue:{fields:n.document.fields}}),l=rA.newFoundDocument(i,s,a,o);r=new n4(n.targetIds||[],n.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let i=iy(e,n.document),s=n.readTime?ic(n.readTime):ed.min(),a=rA.newNoDocument(i,s);r=new n4([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let i=iy(e,n.document);r=new n4([],n.removedTargetIds||[],i,null)}else{if(!("filter"in t))return O(11601,{Vt:t});{t.filter;let e=t.filter;e.targetId;let{count:n=0,unchangedNames:i}=e,s=new nW(n,i);r=new n8(e.targetId,s)}}return r}(this.serializer,e),r=function(e){if(!("targetChange"in e))return ed.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?ed.min():t.readTime?ic(t.readTime):ed.min()}(e);return this.listener.J_(t,r)}Z_(e){let t,r={};r.database=ib(this.serializer),r.addTarget=function(e,t){let r,n=t.target;if((r=rX(n)?{documents:iC(e,n)}:{query:iA(e,n).ft}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=ih(e,t.resumeToken);let n=il(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(ed.min())>0){r.readTime=iu(e,t.snapshotVersion.toTimestamp());let n=il(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}(this.serializer,e);let n=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return O(28987,{purpose:e})}}(e.purpose))?null:{"goog-listen-tags":t});n&&(r.labels=n),this.K_(r)}X_(e){let t={};t.database=ib(this.serializer),t.removeTarget=e,this.K_(t)}}class aV extends aM{constructor(e,t,r,n,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return L(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,L(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){var t,r;L(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let n=(t=e.writeResults,r=e.commitTime,t&&t.length>0?(L(void 0!==r,14353),t.map(e=>{let t;return(t=e.updateTime?ic(e.updateTime):ic(r)).isEqual(ed.min())&&(t=ic(r)),new nD(t,e.transformResults||[])})):[]),i=ic(e.commitTime);return this.listener.na(i,n)}ra(){let e={};e.database=ib(this.serializer),this.K_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>iT(this.serializer,e))};this.K_(t)}}class aU{}class aB extends aU{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.ia=!1}sa(){if(this.ia)throw new F(M.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,n){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Wo(e,ip(t,r),n,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===M.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new F(M.UNKNOWN,e.toString())})}jo(e,t,r,n,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.jo(e,ip(t,r),n,s,a,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===M.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new F(M.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class aq{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(D(t),this.aa=!1):x("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}let aj="RemoteStore";class a${constructor(e,t,r,n,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=i,this.Aa.Mo(e=>{r.enqueueAndForget(async()=>{aX(this)&&(x(aj,"Restarting streams for network reachability change."),await async function(e){e.Ea.add(4),await aK(e),e.Va.set("Unknown"),e.Ea.delete(4),await az(e)}(this))})}),this.Va=new aq(r,n)}}async function az(e){if(aX(e))for(let t of e.Ra)await t(!0)}async function aK(e){for(let t of e.Ra)await t(!1)}function aG(e,t){e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),aY(e)?aJ(e):oi(e).O_()&&aW(e,t))}function aH(e,t){let r=oi(e);e.Ia.delete(t),r.O_()&&aQ(e,t),0===e.Ia.size&&(r.O_()?r.L_():aX(e)&&e.Va.set("Unknown"))}function aW(e,t){if(e.da.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ed.min())>0){let r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}oi(e).Z_(t)}function aQ(e,t){e.da.$e(t),oi(e).X_(t)}function aJ(e){e.da=new ie({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),oi(e).start(),e.Va.ua()}function aY(e){return aX(e)&&!oi(e).x_()&&e.Ia.size>0}function aX(e){return 0===e.Ea.size}async function aZ(e){e.Va.set("Online")}async function a0(e){e.Ia.forEach((t,r)=>{aW(e,t)})}async function a1(e,t){e.da=void 0,aY(e)?(e.Va.ha(t),aJ(e)):e.Va.set("Unknown")}async function a2(e,t,r){if(e.Va.set("Online"),t instanceof n7&&2===t.state&&t.cause)try{await async function(e,t){let r=t.cause;for(let n of t.targetIds)e.Ia.has(n)&&(await e.remoteSyncer.rejectListen(n,r),e.Ia.delete(n),e.da.removeTarget(n))}(e,t)}catch(r){x(aj,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await a6(e,r)}else if(t instanceof n4?e.da.Xe(t):t instanceof n8?e.da.st(t):e.da.tt(t),!r.isEqual(ed.min()))try{let t,n=await s5(e.localStore);r.compareTo(n)>=0&&await ((t=e.da.Tt(r)).targetChanges.forEach((t,n)=>{if(t.resumeToken.approximateByteSize()>0){let i=e.Ia.get(n);i&&e.Ia.set(n,i.withResumeToken(t.resumeToken,r))}}),t.targetMismatches.forEach((t,r)=>{let n=e.Ia.get(t);if(!n)return;e.Ia.set(t,n.withResumeToken(tJ.EMPTY_BYTE_STRING,n.snapshotVersion)),aQ(e,t);let i=new iO(n.target,t,r,n.sequenceNumber);aW(e,i)}),e.remoteSyncer.applyRemoteEvent(t))}catch(t){x(aj,"Failed to raise snapshot:",t),await a6(e,t)}}async function a6(e,t,r){if(!eO(t))throw t;e.Ea.add(1),await aK(e),e.Va.set("Offline"),r||(r=()=>s5(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{x(aj,"Retrying IndexedDB access"),await r(),e.Ea.delete(1),await az(e)})}function a3(e,t){return t().catch(r=>a6(e,r,t))}async function a5(e){var t;let r=os(e),n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:-1;for(;aX(t=e)&&t.Ta.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}(e.localStore,n);if(null===t){0===e.Ta.length&&r.L_();break}n=t.batchId,function(e,t){e.Ta.push(t);let r=os(e);r.O_()&&r.Y_&&r.ea(t.mutations)}(e,t)}catch(t){await a6(e,t)}a4(e)&&a8(e)}function a4(e){return aX(e)&&!os(e).x_()&&e.Ta.length>0}function a8(e){os(e).start()}async function a7(e){os(e).ra()}async function a9(e){let t=os(e);for(let r of e.Ta)t.ea(r.mutations)}async function oe(e,t,r){let n=e.Ta.shift(),i=nK.from(n,t,r);await a3(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await a5(e)}async function ot(e,t){t&&os(e).Y_&&await async function(e,t){var r;if(nQ(r=t.code)&&r!==M.ABORTED){let r=e.Ta.shift();os(e).B_(),await a3(e,()=>e.remoteSyncer.rejectFailedWrite(r.batchId,t)),await a5(e)}}(e,t),a4(e)&&a8(e)}async function or(e,t){e.asyncQueue.verifyOperationInProgress(),x(aj,"RemoteStore received new credentials");let r=aX(e);e.Ea.add(3),await aK(e),r&&e.Va.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await az(e)}async function on(e,t){t?(e.Ea.delete(2),await az(e)):t||(e.Ea.add(2),await aK(e),e.Va.set("Unknown"))}function oi(e){var t,r,n;return e.ma||(t=e.datastore,r=e.asyncQueue,n={Zo:aZ.bind(null,e),Yo:a0.bind(null,e),t_:a1.bind(null,e),J_:a2.bind(null,e)},t.sa(),e.ma=new aF(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n),e.Ra.push(async t=>{t?(e.ma.B_(),aY(e)?aJ(e):e.Va.set("Unknown")):(await e.ma.stop(),e.da=void 0)})),e.ma}function os(e){var t,r,n;return e.fa||(t=e.datastore,r=e.asyncQueue,n={Zo:()=>Promise.resolve(),Yo:a7.bind(null,e),t_:ot.bind(null,e),ta:a9.bind(null,e),na:oe.bind(null,e)},t.sa(),e.fa=new aV(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n),e.Ra.push(async t=>{t?(e.fa.B_(),await a5(e)):(await e.fa.stop(),e.Ta.length>0&&(x(aj,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class oa{constructor(e,t,r,n,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=i,this.deferred=new V,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,i){let s=new oa(e,t,Date.now()+r,n,i);return s.start(r),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new F(M.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function oo(e,t){if(D("AsyncQueue",`${t}: ${e}`),eO(e))return new F(M.UNAVAILABLE,`${t}: ${e}`);throw e}class ol{static emptySet(e){return new ol(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||en.comparator(t.key,r.key):(e,t)=>en.comparator(e.key,t.key),this.keyedMap=nh(),this.sortedSet=new tj(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ol)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let r=new ol;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class ou{constructor(){this.ga=new tj(en.comparator)}track(e){let t=e.doc.key,r=this.ga.get(t);r?0!==e.type&&3===r.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==r.type?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.ga=this.ga.remove(t):1===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):O(63341,{Vt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class oh{constructor(e,t,r,n,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,n,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new oh(e,t,ol.emptySet(t),s,r,n,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&nt(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}class oc{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(e=>e.Da())}}class od{constructor(){this.queries=of(),this.onlineState="Unknown",this.Ca=new Set}terminate(){var e;let t;e=new F(M.ABORTED,"Firestore shutting down"),t=this.queries,this.queries=of(),t.forEach((t,r)=>{for(let t of r.ba)t.onError(e)})}}function of(){return new no(e=>nr(e),nt)}async function op(e,t){let r=3,n=t.query,i=e.queries.get(n);i?!i.Sa()&&t.Da()&&(r=2):(i=new oc,r=+!t.Da());try{switch(r){case 0:i.wa=await e.onListen(n,!0);break;case 1:i.wa=await e.onListen(n,!1);break;case 2:await e.onFirstRemoteStoreListen(n)}}catch(r){let e=oo(r,`Initialization of query '${nn(t.query)}' failed`);return void t.onError(e)}e.queries.set(n,i),i.ba.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&ow(e)}async function og(e,t){let r=t.query,n=3,i=e.queries.get(r);if(i){let e=i.ba.indexOf(t);e>=0&&(i.ba.splice(e,1),0===i.ba.length?n=+!t.Da():!i.Sa()&&t.Da()&&(n=2))}switch(n){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}}function om(e,t){let r=!1;for(let n of t){let t=n.query,i=e.queries.get(t);if(i){for(let e of i.ba)e.Fa(n)&&(r=!0);i.wa=n}}r&&ow(e)}function oy(e,t,r){let n=e.queries.get(t);if(n)for(let e of n.ba)e.onError(r);e.queries.delete(t)}function ow(e){e.Ca.forEach(e=>{e.next()})}(p=f||(f={})).Ma="default",p.Cache="cache";class ov{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){let t=[];for(let r of e.docChanges)3!==r.type&&t.push(r);e=new oh(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){return!(e.fromCache&&this.Da())||(!this.options.Ka||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=oh.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==f.Cache}}class ob{constructor(e,t){this.qa=e,this.byteLength=t}Ua(){return"metadata"in this.qa}}class o_{constructor(e){this.serializer=e}Ks(e){return iy(this.serializer,e)}qs(e){return e.metadata.exists?iE(this.serializer,e.document,!1):rA.newNoDocument(this.Ks(e.metadata.name),this.Us(e.metadata.readTime))}Us(e){return ic(e)}}class oI{constructor(e,t){this.$a=e,this.serializer=t,this.Wa=[],this.Qa=[],this.collectionGroups=new Set,this.progress=oE(e)}get queries(){return this.Wa}get documents(){return this.Qa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.qa.namedQuery)this.Wa.push(e.qa.namedQuery);else if(e.qa.documentMetadata){this.Qa.push({metadata:e.qa.documentMetadata}),e.qa.documentMetadata.exists||++t;let r=ee.fromString(e.qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.qa.document&&(this.Qa[this.Qa.length-1].document=e.qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){let t=new Map,r=new o_(this.serializer);for(let n of e)if(n.metadata.queries){let e=r.Ks(n.metadata.name);for(let r of n.metadata.queries){let n=(t.get(r)||ng()).add(e);t.set(r,n)}}return t}async ja(e){let t=await an(e,new o_(this.serializer),this.Qa,this.$a.id),r=this.za(this.documents);for(let t of this.Wa)await ai(e,t,r.get(t.name));return this.progress.taskState="Success",{progress:this.progress,Ha:this.collectionGroups,Ja:t}}}function oE(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class oT{constructor(e){this.key=e}}class oS{constructor(e){this.key=e}}class oC{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=ng(),this.mutatedKeys=ng(),this.eu=na(e),this.tu=new ol(this.eu)}get nu(){return this.Za}ru(e,t){let r=t?t.iu:new ou,n=t?t.tu:this.tu,i=t?t.mutatedKeys:this.mutatedKeys,s=n,a=!1,o="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,l="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{let u=n.get(e),h=ni(this.query,t)?t:null,c=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations),f=!1;u&&h?u.data.isEqual(h.data)?c!==d&&(r.track({type:3,doc:h}),f=!0):this.su(u,h)||(r.track({type:2,doc:h}),f=!0,(o&&this.eu(h,o)>0||l&&0>this.eu(h,l))&&(a=!0)):!u&&h?(r.track({type:0,doc:h}),f=!0):u&&!h&&(r.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(h?(s=s.add(h),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),r.track({type:1,doc:e})}return{tu:s,iu:r,Ss:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){let i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let s=e.iu.ya();s.sort((e,t)=>{var r,n;let i;return r=e.type,n=t.type,(i=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return O(20277,{Vt:e})}})(r)-i(n)||this.eu(e.doc,t.doc)}),this.ou(r),n=n??!1;let a=t&&!n?this._u():[],o=0===this.Ya.size&&this.current&&!n?1:0,l=o!==this.Xa;return(this.Xa=o,0!==s.length||l)?{snapshot:new oh(this.query,e.tu,i,s,e.mutatedKeys,0===o,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new ou,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Za=this.Za.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Za=this.Za.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Ya;this.Ya=ng(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Ya=this.Ya.add(e.key))});let t=[];return e.forEach(e=>{this.Ya.has(e)||t.push(new oS(e))}),this.Ya.forEach(r=>{e.has(r)||t.push(new oT(r))}),t}cu(e){this.Za=e.ks,this.Ya=ng();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return oh.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Xa,this.hasCachedResults)}}let oA="SyncEngine";class ok{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class ox{constructor(e){this.key=e,this.hu=!1}}class oD{constructor(e,t,r,n,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new no(e=>nr(e),nt),this.Iu=new Map,this.Eu=new Set,this.Ru=new tj(en.comparator),this.Au=new Map,this.Vu=new sF,this.du={},this.mu=new Map,this.fu=sm.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function oN(e,t,r=!0){let n,i=o8(e),s=i.Tu.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),n=s.view.lu()):n=await oO(i,t,r,!0),n}async function oR(e,t){let r=o8(e);await oO(r,t,!0,!1)}async function oO(e,t,r,n){let i,s=await s8(e.localStore,r8(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,r);return n&&(i=await oP(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&r&&aG(e.remoteStore,s),i}async function oP(e,t,r,n,i){e.pu=(t,r,n)=>(async function(e,t,r,n){let i=t.view.ru(r);i.Ss&&(i=await s9(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,i)));let s=n&&n.targetChanges.get(t.targetId),a=n&&null!=n.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return oH(e,t.targetId,o.au),o.snapshot})(e,t,r,n);let s=await s9(e.localStore,t,!0),a=new oC(t,s.ks),o=a.ru(s.documents),l=n5.createSynthesizedTargetChangeForCurrentChange(r,n&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);oH(e,r,u.au);let h=new ok(t,r,a);return e.Tu.set(t,h),e.Iu.has(r)?e.Iu.get(r).push(t):e.Iu.set(r,[t]),u.snapshot}async function oL(e,t,r){let n=e.Tu.get(t),i=e.Iu.get(n.targetId);i.length>1?(e.Iu.set(n.targetId,i.filter(e=>!nt(e,t))),e.Tu.delete(t)):e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)||await s7(e.localStore,n.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(n.targetId),r&&aH(e.remoteStore,n.targetId),oK(e,n.targetId)}).catch(eS)):(oK(e,n.targetId),await s7(e.localStore,n.targetId,!0))}async function oM(e,t){let r=e.Tu.get(t),n=e.Iu.get(r.targetId);e.isPrimaryClient&&1===n.length&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),aH(e.remoteStore,r.targetId))}async function oF(e,t,r){let n=o7(e);try{var i,s;let e,a,o,l,u,h=await (i=n.localStore,o=ec.now(),l=t.reduce((e,t)=>e.add(t.key),ng()),i.persistence.runTransaction("Locally write mutations","readwrite",r=>{let n=nl,s=ng();return i.xs.getEntries(r,l).next(e=>{(n=e).forEach((e,t)=>{t.isValidDocument()||(s=s.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(r,n)).next(n=>{e=n;let s=[];for(let r of t){let t=function(e,t){let r=null;for(let n of e.fieldTransforms){let e=t.data.field(n.field),i=nb(n.transform,e||null);null!=i&&(null===r&&(r=rC.empty()),r.set(n.field,i))}return r||null}(r,e.get(r.key).overlayedDocument);null!=t&&s.push(new nV(r.key,t,function e(t){let r=[];return tB(t.fields,(t,n)=>{let i=new er([t]);if(rv(n)){let t=e(n.mapValue).fields;if(0===t.length)r.push(i);else for(let e of t)r.push(i.child(e))}else r.push(i)}),new tW(r)}(t.value.mapValue),nN.exists(!0)))}return i.mutationQueue.addMutationBatch(r,o,s,t)}).next(t=>{a=t;let n=t.applyToLocalDocumentSet(e,s);return i.documentOverlayCache.saveOverlays(r,t.batchId,n)})}).then(()=>({batchId:a.batchId,changes:nc(e)})));n.sharedClientState.addPendingMutation(h.batchId),s=h.batchId,(u=n.du[n.currentUser.toKey()])||(u=new tj(W)),u=u.insert(s,r),n.du[n.currentUser.toKey()]=u,await oQ(n,h.changes),await a5(n.remoteStore)}catch(t){let e=oo(t,"Failed to persist write");r.reject(e)}}async function oV(e,t){var r;try{let n,i,s=await (r=e.localStore,n=t.snapshotVersion,i=r.vs,r.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=r.xs.newChangeBuffer({trackRemovals:!0});i=r.vs;let a=[];t.targetChanges.forEach((s,o)=>{var l;let u=i.get(o);if(!u)return;a.push(r.li.removeMatchingKeys(e,s.removedDocuments,o).next(()=>r.li.addMatchingKeys(e,s.addedDocuments,o)));let h=u.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?h=h.withResumeToken(tJ.EMPTY_BYTE_STRING,ed.min()).withLastLimboFreeSnapshotVersion(ed.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,n)),i=i.insert(o,h),l=h,(0===u.resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&a.push(r.li.updateTargetData(e,h))});let o=nl,l=ng();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&a.push(r.persistence.referenceDelegate.updateLimboDocument(e,n))}),a.push(s4(e,s,t.documentUpdates).next(e=>{o=e.Bs,l=e.Ls})),!n.isEqual(ed.min())){let t=r.li.getLastRemoteSnapshotVersion(e).next(t=>r.li.setTargetsMetadata(e,e.currentSequenceNumber,n));a.push(t)}return eC.waitFor(a).next(()=>s.apply(e)).next(()=>r.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(r.vs=i,e)));t.targetChanges.forEach((t,r)=>{let n=e.Au.get(r);n&&(L(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?n.hu=!0:t.modifiedDocuments.size>0?L(n.hu,14607):t.removedDocuments.size>0&&(L(n.hu,42227),n.hu=!1))}),await oQ(e,s,t)}catch(e){await eS(e)}}function oU(e,t,r){var n;if(e.isPrimaryClient&&0===r||!e.isPrimaryClient&&1===r){let r,i=[];e.Tu.forEach((e,r)=>{let n=r.view.va(t);n.snapshot&&i.push(n.snapshot)}),(n=e.eventManager).onlineState=t,r=!1,n.queries.forEach((e,n)=>{for(let e of n.ba)e.va(t)&&(r=!0)}),r&&ow(n),i.length&&e.Pu.J_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function oB(e,t,r){e.sharedClientState.updateQueryState(t,"rejected",r);let n=e.Au.get(t),i=n&&n.key;if(i){let r=new tj(en.comparator);r=r.insert(i,rA.newNoDocument(i,ed.min()));let n=ng().add(i),s=new n3(ed.min(),new Map,new tj(W),r,n);await oV(e,s),e.Ru=e.Ru.remove(i),e.Au.delete(t),oW(e)}else await s7(e.localStore,t,!1).then(()=>oK(e,t,r)).catch(eS)}async function oq(e,t){var r;let n=t.batch.batchId;try{let i=await (r=e.localStore,r.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let n,i,s,a=t.batch.keys(),o=r.xs.newChangeBuffer({trackRemovals:!0});return(i=(n=t.batch).keys(),s=eC.resolve(),i.forEach(r=>{s=s.next(()=>o.getEntry(e,r)).next(e=>{let i=t.docVersions.get(r);L(null!==i,48541),0>e.version.compareTo(i)&&(n.applyToRemoteDocument(e,t),e.isValidDocument()&&(e.setReadTime(t.commitVersion),o.addEntry(e)))})}),s.next(()=>r.mutationQueue.removeMutationBatch(e,n))).next(()=>o.apply(e)).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,a,t.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=ng();for(let r=0;r<e.mutationResults.length;++r)e.mutationResults[r].transformResults.length>0&&(t=t.add(e.batch.mutations[r].key));return t}(t))).next(()=>r.localDocuments.getDocuments(e,a))}));oz(e,n,null),o$(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),await oQ(e,i)}catch(e){await eS(e)}}async function oj(e,t,r){var n;try{let i=await (n=e.localStore,n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(L(null!==t,37113),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))}));oz(e,t,r),o$(e,t),e.sharedClientState.updateMutationState(t,"rejected",r),await oQ(e,i)}catch(e){await eS(e)}}function o$(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function oz(e,t,r){let n=e.du[e.currentUser.toKey()];if(n){let i=n.get(t);i&&(r?i.reject(r):i.resolve(),n=n.remove(t)),e.du[e.currentUser.toKey()]=n}}function oK(e,t,r=null){for(let n of(e.sharedClientState.removeLocalQueryTarget(t),e.Iu.get(t)))e.Tu.delete(n),r&&e.Pu.yu(n,r);e.Iu.delete(t),e.isPrimaryClient&&e.Vu.Gr(t).forEach(t=>{e.Vu.containsKey(t)||oG(e,t)})}function oG(e,t){e.Eu.delete(t.path.canonicalString());let r=e.Ru.get(t);null!==r&&(aH(e.remoteStore,r),e.Ru=e.Ru.remove(t),e.Au.delete(r),oW(e))}function oH(e,t,r){for(let n of r)n instanceof oT?(e.Vu.addReference(n.key,t),function(e,t){let r=t.key,n=r.path.canonicalString();e.Ru.get(r)||e.Eu.has(n)||(x(oA,"New document in limbo: "+r),e.Eu.add(n),oW(e))}(e,n)):n instanceof oS?(x(oA,"Document no longer in limbo: "+n.key),e.Vu.removeReference(n.key,t),e.Vu.containsKey(n.key)||oG(e,n.key)):O(19791,{wu:n})}function oW(e){for(;e.Eu.size>0&&e.Ru.size<e.maxConcurrentLimboResolutions;){let t=e.Eu.values().next().value;e.Eu.delete(t);let r=new en(ee.fromString(t)),n=e.fu.next();e.Au.set(n,new ox(r)),e.Ru=e.Ru.insert(r,n),aG(e.remoteStore,new iO(r8(r6(r.path)),n,"TargetPurposeLimboResolution",eq.ce))}}async function oQ(e,t,r){let n=[],i=[],s=[];e.Tu.isEmpty()||(e.Tu.forEach((a,o)=>{s.push(e.pu(o,t,r).then(t=>{if((t||r)&&e.isPrimaryClient){let n=t?!t.fromCache:r?.targetChanges.get(o.targetId)?.current;e.sharedClientState.updateQueryState(o.targetId,n?"current":"not-current")}if(t){n.push(t);let e=sZ.Es(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.Pu.J_(n),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>eC.forEach(t,t=>eC.forEach(t.Ts,n=>e.persistence.referenceDelegate.addReference(r,t.targetId,n)).next(()=>eC.forEach(t.Is,n=>e.persistence.referenceDelegate.removeReference(r,t.targetId,n)))))}catch(e){if(!eO(e))throw e;x(s2,"Failed to update sequence numbers: "+e)}for(let r of t){let t=r.targetId;if(!r.fromCache){let r=e.vs.get(t),n=r.snapshotVersion,i=r.withLastLimboFreeSnapshotVersion(n);e.vs=e.vs.insert(t,i)}}}(e.localStore,i))}async function oJ(e,t){if(!e.currentUser.isEqual(t)){x(oA,"User change. New user:",t.toKey());let r=await s3(e.localStore,t);e.currentUser=t,e.mu.forEach(e=>{e.forEach(e=>{e.reject(new F(M.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.mu.clear(),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await oQ(e,r.Ns)}}function oY(e,t){let r=e.Au.get(t);if(r&&r.hu)return ng().add(r.key);{let r=ng(),n=e.Iu.get(t);if(!n)return r;for(let t of n){let n=e.Tu.get(t);r=r.unionWith(n.view.nu)}return r}}async function oX(e,t){let r=await s9(e.localStore,t.query,!0),n=t.view.cu(r);return e.isPrimaryClient&&oH(e,t.targetId,n.au),n}async function oZ(e,t){return at(e.localStore,t).then(t=>oQ(e,t))}async function o0(e,t,r,n){var i,s;let a,o=await (i=e.localStore,a=i.mutationQueue,i.persistence.runTransaction("Lookup mutation documents","readonly",e=>a.Xn(e,t).next(t=>t?i.localDocuments.getDocuments(e,t):eC.resolve(null))));null!==o?("pending"===r?await a5(e.remoteStore):"acknowledged"===r||"rejected"===r?(oz(e,t,n||null),o$(e,t),s=e.localStore,s.mutationQueue.nr(t)):O(6720,"Unknown batchState",{bu:r}),await oQ(e,o)):x(oA,"Cannot apply mutation batch with id: "+t)}async function o1(e,t){if(o8(e),o7(e),!0===t&&!0!==e.gu){let t=e.sharedClientState.getAllActiveQueryTargets(),r=await o2(e,t.toArray());for(let t of(e.gu=!0,await on(e.remoteStore,!0),r))aG(e.remoteStore,t)}else if(!1===t&&!1!==e.gu){let t=[],r=Promise.resolve();e.Iu.forEach((n,i)=>{e.sharedClientState.isLocalQueryTarget(i)?t.push(i):r=r.then(()=>(oK(e,i),s7(e.localStore,i,!0))),aH(e.remoteStore,i)}),await r,await o2(e,t),e.Au.forEach((t,r)=>{aH(e.remoteStore,r)}),e.Vu.zr(),e.Au=new Map,e.Ru=new tj(en.comparator),e.gu=!1,await on(e.remoteStore,!1)}}async function o2(e,t,r){let n=[],i=[];for(let r of t){let t,s=e.Iu.get(r);if(s&&0!==s.length)for(let r of(t=await s8(e.localStore,r8(s[0])),s)){let t=e.Tu.get(r),n=await oX(e,t);n.snapshot&&i.push(n.snapshot)}else{let n=await ae(e.localStore,r);t=await s8(e.localStore,n),await oP(e,o6(n),r,!1,t.resumeToken)}n.push(t)}return e.Pu.J_(i),n}function o6(e){var t,r,n,i,s;return t=e.path,r=e.collectionGroup,n=e.orderBy,i=e.filters,s=e.limit,new r2(t,r,n,i,s,"F",e.startAt,e.endAt)}function o3(e){return e.localStore.persistence.hs()}async function o5(e,t,r,n){if(e.gu)return void x(oA,"Ignoring unexpected query state notification.");let i=e.Iu.get(t);if(i&&i.length>0)switch(r){case"current":case"not-current":{let n=await at(e.localStore,ns(i[0])),s=n3.createSynthesizedRemoteEventForCurrentChange(t,"current"===r,tJ.EMPTY_BYTE_STRING);await oQ(e,n,s);break}case"rejected":await s7(e.localStore,t,!0),oK(e,t,n);break;default:O(64155,r)}}async function o4(e,t,r){let n=o8(e);if(n.gu){for(let e of t){if(n.Iu.has(e)&&n.sharedClientState.isActiveQueryTarget(e)){x(oA,"Adding an already active target "+e);continue}let t=await ae(n.localStore,e),r=await s8(n.localStore,t);await oP(n,o6(t),r.targetId,!1,r.resumeToken),aG(n.remoteStore,r)}for(let e of r)n.Iu.has(e)&&await s7(n.localStore,e,!1).then(()=>{aH(n.remoteStore,e),oK(n,e)}).catch(eS)}}function o8(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=oV.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=oY.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=oB.bind(null,e),e.Pu.J_=om.bind(null,e.eventManager),e.Pu.yu=oy.bind(null,e.eventManager),e}function o7(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=oq.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=oj.bind(null,e),e}class o9{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=aO(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){var t,r;return t=this.persistence,r=new s1,new s6(t,r,e.initialUser,this.serializer)}Cu(e){return new s$(sK.Vi,this.serializer)}Du(e){return new aw}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}o9.provider={build:()=>new o9};class le extends o9{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){return L(this.persistence.referenceDelegate instanceof sG,46915),new sI(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Cu(e){let t=void 0!==this.cacheSizeBytes?sh.withCacheSize(this.cacheSizeBytes):sh.DEFAULT;return new s$(e=>sG.Vi(e,t),this.serializer)}}class lt extends o9{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await o7(this.xu.syncEngine),await a5(this.xu.remoteStore),await this.persistence.zi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){var t,r;return t=this.persistence,r=new s1,new s6(t,r,e.initialUser,this.serializer)}Fu(e,t){return new sI(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Mu(e,t){let r=new eB(t,this.persistence);return new eU(e.asyncQueue,r)}Cu(e){let t=sX(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?sh.withCacheSize(this.cacheSizeBytes):sh.DEFAULT;return new sY(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,aN(),aR(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new aw}}class lr extends lt{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.xu.syncEngine;this.sharedClientState instanceof ay&&(this.sharedClientState.syncEngine={So:o0.bind(null,t),Do:o5.bind(null,t),Co:o4.bind(null,t),hs:o3.bind(null,t),bo:oZ.bind(null,t)},await this.sharedClientState.start()),await this.persistence.zi(async e=>{await o1(this.xu.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}Du(e){let t=aN();if(!ay.v(t))throw new F(M.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=sX(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new ay(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class ln{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>oU(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=oJ.bind(null,this.syncEngine),await on(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new od}createDatastore(e){var t;let r=aO(e.databaseInfo.databaseId),n=new aD(e.databaseInfo);return t=e.authCredentials,new aB(t,e.appCheckCredentials,n,r)}createRemoteStore(e){var t,r;return t=this.localStore,r=this.datastore,new a$(t,r,e.asyncQueue,e=>oU(this.syncEngine,e,0),a_.v()?new a_:new av)}createSyncEngine(e,t){var r,n,i,s,a,o;let l;return r=this.localStore,n=this.remoteStore,i=this.eventManager,s=this.sharedClientState,a=e.initialUser,o=e.maxConcurrentLimboResolutions,l=new oD(r,n,i,s,a,o),t&&(l.gu=!0),l}async terminate(){await async function(e){x(aj,"RemoteStore shutting down."),e.Ea.add(5),await aK(e),e.Aa.shutdown(),e.Va.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}function li(e,t=10240){let r=0;return{async read(){if(r<e.byteLength){let n={value:e.slice(r,r+t),done:!1};return r+=t,n}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}ln.provider={build:()=>new ln};class ls{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):D("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class la{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new V,this.buffer=new Uint8Array,this.Lu=new TextDecoder("utf-8"),this.ku().then(e=>{e&&e.Ua()?this.metadata.resolve(e.qa.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(e?.qa)}`))},e=>this.metadata.reject(e))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async Su(){return await this.getMetadata(),this.ku()}async ku(){let e=await this.Ku();if(null===e)return null;let t=this.Lu.decode(e),r=Number(t);return isNaN(r)&&this.qu(`length string (${t}) is not valid number`),new ob(JSON.parse(await this.Uu(r)),e.length+r)}$u(){return this.buffer.findIndex(e=>123===e)}async Ku(){for(;0>this.$u()&&!await this.Wu(););if(0===this.buffer.length)return null;let e=this.$u();e<0&&this.qu("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Uu(e){for(;this.buffer.length<e;)await this.Wu()&&this.qu("Reached the end of bundle when more is expected.");let t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}qu(e){throw this.Bu.cancel(),Error(`Invalid bundle format: ${e}`)}async Wu(){let e=await this.Bu.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class lo{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.Su();if(!r||!r.Ua())throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r?.qa)}`);this.metadata=r;do null!==(r=this.Su())&&this.elements.push(r);while(null!==r)}getMetadata(){return this.metadata}Qu(){return this.elements}Su(){if(this.cursor===this.bundleData.length)return null;let e=this.Ku();return new ob(JSON.parse(this.Uu(e)),e)}Uu(e){if(this.cursor+e>this.bundleData.length)throw new F(M.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}Ku(){let e=this.cursor,t=this.cursor;for(;t<this.bundleData.length;){if("{"===this.bundleData[t]){if(t===e)throw Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw Error("Reached the end of bundle when more is expected.")}}class ll{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new F(M.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await async function(e,t){let r={documents:t.map(t=>im(e.serializer,t))},n=await e.jo("BatchGetDocuments",e.serializer.databaseId,ee.emptyPath(),r,t.length),i=new Map;n.forEach(t=>{var r;let n,s,a,o,l,u,h=(r=e.serializer,"found"in t?(L(!!t.found,43571),t.found.name,t.found.updateTime,n=iy(r,t.found.name),s=ic(t.found.updateTime),a=t.found.createTime?ic(t.found.createTime):ed.min(),o=new rC({mapValue:{fields:t.found.fields}}),rA.newFoundDocument(n,s,a,o)):"missing"in t?(L(!!t.missing,3894),L(!!t.readTime,22933),l=iy(r,t.missing),u=ic(t.readTime),rA.newNoDocument(l,u)):O(7234,{result:t}));i.set(h.key.toString(),h)});let s=[];return t.forEach(e=>{let t=i.get(e.toString());L(!!t,55234,{key:e}),s.push(t)}),s}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new nj(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let r=en.fromPath(t);this.mutations.push(new n$(r,this.precondition(r)))}),await async function(e,t){let r={writes:t.map(t=>iT(e.serializer,t))};await e.Wo("Commit",e.serializer.databaseId,ee.emptyPath(),r)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw O(50498,{Gu:e.constructor.name});t=ed.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new F(M.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ed.min())?nN.exists(!1):nN.updateTime(t):nN.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ed.min()))throw new F(M.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return nN.updateTime(t)}return nN.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class lu{constructor(e,t,r,n,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=n,this.deferred=i,this.zu=r.maxAttempts,this.M_=new aP(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Hu()}Hu(){this.M_.p_(async()=>{let e=new ll(this.datastore),t=this.Ju(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.Zu(e)}))}).catch(e=>{this.Zu(e)})})}Ju(e){try{let t=this.updateFunction(e);return!ej(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Zu(e){this.zu>0&&this.Xu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Hu(),Promise.resolve()))):this.deferred.reject(e)}Xu(e){if("FirebaseError"===e?.name){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!nQ(t)}return!1}}let lh="FirestoreClient";class lc{constructor(e,t,r,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this._databaseInfo=n,this.user=S.UNAUTHENTICATED,this.clientId=H.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async e=>{x(lh,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(x(lh,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new V;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){let t=oo(r,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function ld(e,t){e.asyncQueue.verifyOperationInProgress(),x(lh,"Initializing OfflineComponentProvider");let r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await s3(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function lf(e,t){e.asyncQueue.verifyOperationInProgress();let r=await lp(e);x(lh,"Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>or(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>or(t.remoteStore,r)),e._onlineComponents=t}async function lp(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){x(lh,"Using user provided OfflineComponentProvider");try{await ld(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===M.FAILED_PRECONDITION||t.code===M.UNIMPLEMENTED:!("u">typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;N("Error using user provided cache. Falling back to memory cache: "+t),await ld(e,new o9)}}else x(lh,"Using default OfflineComponentProvider"),await ld(e,new le(void 0));return e._offlineComponents}async function lg(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(x(lh,"Using user provided OnlineComponentProvider"),await lf(e,e._uninitializedComponentsProvider._online)):(x(lh,"Using default OnlineComponentProvider"),await lf(e,new ln))),e._onlineComponents}function lm(e){return lp(e).then(e=>e.localStore)}function ly(e){return lg(e).then(e=>e.syncEngine)}function lw(e){return lg(e).then(e=>e.datastore)}async function lv(e){let t=await lg(e),r=t.eventManager;return r.onListen=oN.bind(null,t.syncEngine),r.onUnlisten=oL.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=oR.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=oM.bind(null,t.syncEngine),r}function lb(e,t,r={}){let n=new V;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await lv(e),s=e.asyncQueue,a=new ls({next:e=>{a.Nu(),s.enqueueAndForget(()=>og(i,o));let l=e.docs.has(t);!l&&e.fromCache?n.reject(new F(M.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&e.fromCache&&r&&"server"===r.source?n.reject(new F(M.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):n.resolve(e)},error:e=>n.reject(e)}),op(i,o=new ov(r6(t.path),a,{includeMetadataChanges:!0,Ka:!0}))}),n.promise}function l_(e,t,r={}){let n=new V;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await lv(e),s=e.asyncQueue,o=new ov(t,a=new ls({next:e=>{a.Nu(),s.enqueueAndForget(()=>og(i,o)),e.fromCache&&"server"===r.source?n.reject(new F(M.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):n.resolve(e)},error:e=>n.reject(e)}),{includeMetadataChanges:!0,Ka:!0}),op(i,o)}),n.promise}function lI(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let lE=new Map,lT="firestore.googleapis.com";class lS{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new F(M.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=lT,this.ssl=!0}else this.host=e.host,this.ssl=e.ssl??!0;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new F(M.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,r,n){if(!0===t&&!0===n)throw new F(M.INVALID_ARGUMENT,`${e} and ${r} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=lI(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new F(M.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new F(M.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new F(M.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,r;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,r=e.experimentalLongPollingOptions,t.timeoutSeconds===r.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class lC{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new lS({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new F(M.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new F(M.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new lS(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new B;switch(e.type){case"firstParty":return new z(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new F(M.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let e;return(e=lE.get(this))&&(x("ComponentProvider","Removing Datastore"),lE.delete(this),e.terminate()),Promise.resolve()}}class lA{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new lA(this.firestore,e,this._query)}}class lk{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new lx(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new lk(this.firestore,e,this._key)}toJSON(){return{type:lk._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(eh(t,lk._jsonSchema))return new lk(e,r||null,new en(ee.fromString(t.referencePath)))}}lk._jsonSchemaVersion="firestore/documentReference/1.0",lk._jsonSchema={type:eu("string",lk._jsonSchemaVersion),referencePath:eu("string")};class lx extends lA{constructor(e,t,r){super(e,t,r6(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new lk(this.firestore,null,new en(e))}withConverter(e){return new lx(this.firestore,e,this._path)}}function lD(e,t,...r){if(e=(0,v.getModularInstance)(e),1==arguments.length&&(t=H.newId()),function(e,t,r){if(!r)throw new F(M.INVALID_ARGUMENT,`Function doc() cannot be called with an empty ${t}.`)}(0,"path",t),e instanceof lC){let n=ee.fromString(t,...r);return ei(n),new lk(e,null,new en(n))}{if(!(e instanceof lk||e instanceof lx))throw new F(M.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(ee.fromString(t,...r));return ei(n),new lk(e.firestore,e instanceof lx?e.converter:null,new en(n))}}function lN(e,t){return e=(0,v.getModularInstance)(e),t=(0,v.getModularInstance)(t),e instanceof lA&&t instanceof lA&&e.firestore===t.firestore&&nt(e._query,t._query)&&e.converter===t.converter}let lR="AsyncQueue";class lO{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new aP(this,"async_queue_retry"),this._c=()=>{let e=aR();e&&x(lR,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=aR();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=aR();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new V;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}async lc(){if(0!==this.Yu.length){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!eO(e))throw e;x(lR,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,D("INTERNAL UNHANDLED ERROR: ",lP(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let n=oa.createAndSchedule(this,e,t,r,e=>this.hc(e));return this.tc.push(n),n}uc(){this.nc&&O(47125,{Pc:lP(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{for(let t of(this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.tc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}}function lP(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class lL{constructor(){this._progressObserver={},this._taskCompletionResolver=new V,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class lM extends lC{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new lO,this._persistenceKey=n?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new lO(e),this._firestoreClient=void 0,await e}}}function lF(e,t){let r="object"==typeof e?e:(0,g.getApp)(),n=(0,g._getProvider)(r,"firestore").getImmediate({identifier:"string"==typeof e?e:t||t9});if(!n._initialized){let e=(0,v.getDefaultEmulatorHostnameAndPort)("firestore");e&&function(e,t,r,n={}){e=eo(e,lC);let i=(0,v.isCloudWorkstation)(t),s=e._getSettings(),a={...s,emulatorOptions:e._getEmulatorOptions()},o=`${t}:${r}`;i&&((0,v.pingServer)(`https://${o}`),(0,v.updateEmulatorBanner)("Firestore",!0)),s.host!==lT&&s.host!==o&&N("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l={...s,host:o,ssl:i,emulatorOptions:n};if(!(0,v.deepEqual)(l,a)&&(e._setSettings(l),n.mockUserToken)){let t,r;if("string"==typeof n.mockUserToken)t=n.mockUserToken,r=S.MOCK_USER;else{t=(0,v.createMockUserToken)(n.mockUserToken,e._app?.options.projectId);let i=n.mockUserToken.sub||n.mockUserToken.user_id;if(!i)throw new F(M.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");r=new S(i)}e._authCredentials=new q(new U(t,r))}}(n,...e)}return n}function lV(e){if(e._terminated)throw new F(M.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,r,n,i,s;let a,o=e._freezeSettings(),l=(t=e._databaseId,r=e._app?.options.appId||"",n=e._persistenceKey,i=e._app?.options.apiKey,new t7(t,r,n,o.host,o.ssl,o.experimentalForceLongPolling,o.experimentalAutoDetectLongPolling,lI(o.experimentalLongPollingOptions),o.useFetchStreams,o.isUsingEmulator,i));e._componentsProvider||o.localCache?._offlineComponentProvider&&o.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:o.localCache._offlineComponentProvider,_online:o.localCache._onlineComponentProvider}),e._firestoreClient=new lc(e._authCredentials,e._appCheckCredentials,e._queue,l,e._componentsProvider&&(s=e._componentsProvider,a=s?._online.build(),{_offline:s?._offline.build(a),_online:a}))}(e),e._firestoreClient}function lU(e,t){let r=lV(e=eo(e,lM)),n=new lL;return function(e,t,r,n){var i;let s=(i=aO(t),new la(function(e,t){if(e instanceof Uint8Array)return li(e,void 0);if(e instanceof ArrayBuffer)return li(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof r?nX().encode(r):r),i));e.asyncQueue.enqueueAndForget(async()=>{var t;(async function(e,t,r){try{var n,i;let s,a=await t.getMetadata();if(await (n=e.localStore,s=ic(a.createTime),n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Pi.getBundleMetadata(e,a.id)).then(e=>!!e&&e.createTime.compareTo(s)>=0)))return await t.close(),r._completeWith({taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}),Promise.resolve(new Set);r._updateProgress(oE(a));let o=new oI(a,t.serializer),l=await t.Su();for(;l;){let e=await o.Ga(l);e&&r._updateProgress(e),l=await t.Su()}let u=await o.ja(e.localStore);return await oQ(e,u.Ja,void 0),await (i=e.localStore,i.persistence.runTransaction("Save bundle","readwrite",e=>i.Pi.saveBundleMetadata(e,a))),r._completeWith(u.progress),Promise.resolve(u.Ha)}catch(e){return N(oA,`Loading bundle failed with ${e}`),r._failWith(e),Promise.resolve(new Set)}})(t=await ly(e),s,n).then(e=>{t.sharedClientState.notifyBundleLoaded(e)})})}(r,e._databaseId,t,n),n}class lB{constructor(e){this._byteString=e}static fromBase64String(e){try{return new lB(tJ.fromBase64String(e))}catch(e){throw new F(M.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new lB(tJ.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:lB._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(eh(e,lB._jsonSchema))return lB.fromBase64String(e.bytes)}}lB._jsonSchemaVersion="firestore/bytes/1.0",lB._jsonSchema={type:eu("string",lB._jsonSchemaVersion),bytes:eu("string")};class lq{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new F(M.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new er(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class lj{constructor(e){this._methodName=e}}class l${constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new F(M.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new F(M.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return W(this._lat,e._lat)||W(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:l$._jsonSchemaVersion}}static fromJSON(e){if(eh(e,l$._jsonSchema))return new l$(e.latitude,e.longitude)}}l$._jsonSchemaVersion="firestore/geoPoint/1.0",l$._jsonSchema={type:eu("string",l$._jsonSchemaVersion),latitude:eu("number"),longitude:eu("number")};class lz{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}(this._values,e._values)}toJSON(){return{type:lz._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(eh(e,lz._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new lz(e.vectorValues);throw new F(M.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}lz._jsonSchemaVersion="firestore/vectorValue/1.0",lz._jsonSchema={type:eu("string",lz._jsonSchemaVersion),vectorValues:eu("object")};let lK=/^__.*__$/;class lG{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new nV(e,this.data,this.fieldMask,t,this.fieldTransforms):new nF(e,this.data,t,this.fieldTransforms)}}class lH{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new nV(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function lW(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw O(40011,{dataSource:e})}}class lQ{constructor(e,t,r,n,i,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===i&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new lQ({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return ue(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(lW(this.dataSource)&&lK.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class lJ{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||aO(e)}createContext(e,t,r,n=!1){return new lQ({dataSource:e,methodName:t,targetDoc:r,path:er.emptyPath(),arrayElement:!1,hasConverter:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function lY(e){let t=e._freezeSettings(),r=aO(e._databaseId);return new lJ(e._databaseId,!!t.ignoreUndefinedProperties,r)}function lX(e,t,r,n,i,s={}){let a,o,l=e.createContext(s.merge||s.mergeFields?2:0,t,r,i);l4("Data must be an object, but it was:",l,n);let u=l3(n,l);if(s.merge)a=new tW(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let n of s.mergeFields){let i=l8(t,n,r);if(!l.contains(i))throw new F(M.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);ut(e,i)||e.push(i)}a=new tW(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new lG(new rC(u),a,o)}class lZ extends lj{_toFieldTransform(e){if(2!==e.dataSource)throw 1===e.dataSource?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof lZ}}function l0(e,t,r,n){let i=e.createContext(1,t,r);l4("Data must be an object, but it was:",i,n);let s=[],a=rC.empty();return tB(n,(e,n)=>{let o=l9(t,e,r);n=(0,v.getModularInstance)(n);let l=i.childContextForFieldPath(o);if(n instanceof lZ)s.push(o);else{let e=l6(n,l);null!=e&&(s.push(o),a.set(o,e))}}),new lH(a,new tW(s),i.fieldTransforms)}function l1(e,t,r,n,i,s){let a=e.createContext(1,t,r),o=[l8(t,n,r)],l=[i];if(s.length%2!=0)throw new F(M.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(l8(t,s[e])),l.push(s[e+1]);let u=[],h=rC.empty();for(let e=o.length-1;e>=0;--e)if(!ut(u,o[e])){let t=o[e],r=l[e];r=(0,v.getModularInstance)(r);let n=a.childContextForFieldPath(t);if(r instanceof lZ)u.push(t);else{let e=l6(r,n);null!=e&&(u.push(t),h.set(t,e))}}return new lH(h,new tW(u),a.fieldTransforms)}function l2(e,t,r,n=!1){return l6(r,e.createContext(n?4:3,t))}function l6(e,t){if(l5(e=(0,v.getModularInstance)(e)))return l4("Unsupported field value:",t,e),l3(e,t);if(e instanceof lj)return function(e,t){if(!lW(t.dataSource))throw t.createError(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.createError(`${e._methodName}() is not currently supported inside arrays`);let r=e._toFieldTransform(t);r&&t.fieldTransforms.push(r)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");let r=[],n=0;for(let i of e){let e=l6(i,t.childContextForArray(n));null==e&&(e={nullValue:"NULL_VALUE"}),r.push(e),n++}return{arrayValue:{values:r}}}return function(e,t){var r,n,i;if(null===(e=(0,v.getModularInstance)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return r=t.serializer,ez(n=e)?nw(n):ny(r,n);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let r=ec.fromDate(e);return{timestampValue:iu(t.serializer,r)}}if(e instanceof ec){let r=new ec(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:iu(t.serializer,r)}}if(e instanceof l$)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof lB)return{bytesValue:ih(t.serializer,e._byteString)};if(e instanceof lk){let r=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(r))throw t.createError(`Document reference is for database ${n.projectId}/${n.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:id(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof lz)return{mapValue:{fields:{[rt]:{stringValue:ri},[rs]:{arrayValue:{values:((i=e)instanceof lz?i.toArray():i).map(e=>{if("number"!=typeof e)throw t.createError("VectorValues must only contain numeric values.");return ny(t.serializer,e)})}}}}};if(iR(e))return e._toProto(t.serializer);throw t.createError(`Unsupported field value: ${ea(e)}`)}(e,t)}function l3(e,t){let r={};return tq(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):tB(e,(e,n)=>{let i=l6(n,t.childContextForField(e));null!=i&&(r[e]=i)}),{mapValue:{fields:r}}}function l5(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ec||e instanceof l$||e instanceof lB||e instanceof lk||e instanceof lj||e instanceof lz||iR(e))}function l4(e,t,r){if(!l5(r)||!es(r)){let n=ea(r);throw"an object"===n?t.createError(e+" a custom object"):t.createError(e+" "+n)}}function l8(e,t,r){if((t=(0,v.getModularInstance)(t))instanceof lq)return t._internalPath;if("string"==typeof t)return l9(e,t);throw ue("Field path arguments must be of type string or ",e,!1,void 0,r)}let l7=RegExp("[~\\*/\\[\\]]");function l9(e,t,r){if(t.search(l7)>=0)throw ue(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new lq(...t.split("."))._internalPath}catch(n){throw ue(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function ue(e,t,r,n,i){let s=n&&!n.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;r&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new F(M.INVALID_ARGUMENT,o+e+l)}function ut(e,t){return e.some(e=>e.isEqual(t))}class ur{convertValue(e,t="none"){switch(ro(e)){case 0:return null;case 1:return e.booleanValue;case 2:return tZ(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(t0(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw O(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return tB(e,(e,n)=>{r[e]=this.convertValue(n,t)}),r}convertVectorValue(e){return new lz(e.fields?.[rs].arrayValue?.values?.map(e=>tZ(e.doubleValue)))}convertGeoPoint(e){return new l$(tZ(e.latitude),tZ(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=t4(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(t8(e));default:return null}}convertTimestamp(e){let t=tX(e);return new ec(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=ee.fromString(e);L(iN(r),9688,{name:e});let n=new re(r.get(1),r.get(3)),i=new en(r.popFirst(5));return n.isEqual(t)||D(`Document ${i} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class un extends ur{constructor(e){super(),this.firestore=e}convertBytes(e){return new lB(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new lk(this.firestore,null,t)}}let ui="@firebase/firestore",us="4.11.0";function ua(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class uo{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class ul{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}_fieldsProto(){return new rC({mapValue:{fields:this._data}}).clone().value.mapValue.fields}}class uu{constructor(e,t,r,n,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new lk(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new uh(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){let t=this._document.data.field(l8("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class uh extends uu{data(){return super.data()}}function uc(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new F(M.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ud{}class uf extends ud{}function up(e,t,...r){let n=[];for(let i of(t instanceof ud&&n.push(t),function(e){let t=e.filter(e=>e instanceof uy).length,r=e.filter(e=>e instanceof ug).length;if(t>1||t>0&&r>0)throw new F(M.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n=n.concat(r)),n))e=i._apply(e);return e}class ug extends uf{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new ug(e,t,r)}_apply(e){let t=this._parse(e);return uP(e._query,t),new lA(e.firestore,e.converter,r9(e._query,t))}_parse(e){let t=lY(e.firestore);return function(e,t,r,n,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new F(M.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){uO(a,s);let t=[];for(let r of a)t.push(uR(n,e,r));o={arrayValue:{values:t}}}else o=uR(n,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||uO(a,s),o=l2(r,t,a,"in"===s||"not-in"===s);return rO.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function um(e,t,r){let n=l8("where",e);return ug._create(n,t,r)}class uy extends ud{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new uy(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:rP.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let r=e;for(let e of t.getFlattenedFilters())uP(r,e),r=r9(r,e)}(e._query,t),new lA(e.firestore,e.converter,r9(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function uw(...e){return e.forEach(e=>uL("or",e)),uy._create("or",e)}function uv(...e){return e.forEach(e=>uL("and",e)),uy._create("and",e)}class ub extends uf{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new ub(e,t)}_apply(e){var t;let r,n=function(e,t,r){if(null!==e.startAt)throw new F(M.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new F(M.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new rN(t,r)}(e._query,this._field,this._direction);return new lA(e.firestore,e.converter,(t=e._query,r=t.explicitOrderBy.concat([n]),new r2(t.path,t.collectionGroup,r,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))}}function u_(e,t="asc"){let r=l8("orderBy",e);return ub._create(r,t)}class uI extends uf{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new uI(e,t,r)}_apply(e){return new lA(e.firestore,e.converter,ne(e._query,this._limit,this._limitType))}}function uE(e){return el("limit",e),uI._create("limit",e,"F")}function uT(e){return el("limitToLast",e),uI._create("limitToLast",e,"L")}class uS extends uf{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new uS(e,t,r)}_apply(e){var t;let r=uN(e,this.type,this._docOrFields,this._inclusive);return new lA(e.firestore,e.converter,(t=e._query,new r2(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,r,t.endAt)))}}function uC(...e){return uS._create("startAt",e,!0)}function uA(...e){return uS._create("startAfter",e,!1)}class uk extends uf{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new uk(e,t,r)}_apply(e){var t;let r=uN(e,this.type,this._docOrFields,this._inclusive);return new lA(e.firestore,e.converter,(t=e._query,new r2(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,r)))}}function ux(...e){return uk._create("endBefore",e,!1)}function uD(...e){return uk._create("endAt",e,!0)}function uN(e,t,r,n){if(r[0]=(0,v.getModularInstance)(r[0]),r[0]instanceof uu)return function(e,t,r,n,i){if(!n)throw new F(M.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${r}().`);let s=[];for(let r of r4(e))if(r.field.isKeyField())s.push(rp(t,n.key));else{let e=n.data.field(r.field);if(t5(e))throw new F(M.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+r.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=r.field.canonicalString();throw new F(M.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new rk(s,i)}(e._query,e.firestore._databaseId,t,r[0]._document,n);{let i=lY(e.firestore);return function(e,t,r,n,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new F(M.INVALID_ARGUMENT,`Too many arguments provided to ${n}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new F(M.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${n}(), but got a ${typeof l}`);if(!r5(e)&&-1!==l.indexOf("/"))throw new F(M.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${n}() must be a plain document ID, but '${l}' contains a slash.`);let r=e.path.child(ee.fromString(l));if(!en.isDocumentKey(r))throw new F(M.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${n}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);let i=new en(r);o.push(rp(t,i))}else{let e=l2(r,n,l);o.push(e)}}return new rk(o,s)}(e._query,e.firestore._databaseId,i,t,r,n)}}function uR(e,t,r){if("string"==typeof(r=(0,v.getModularInstance)(r))){if(""===r)throw new F(M.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!r5(t)&&-1!==r.indexOf("/"))throw new F(M.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);let n=t.path.child(ee.fromString(r));if(!en.isDocumentKey(n))throw new F(M.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return rp(e,new en(n))}if(r instanceof lk)return rp(e,r._key);throw new F(M.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ea(r)}.`)}function uO(e,t){if(!Array.isArray(e)||0===e.length)throw new F(M.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function uP(e,t){let r=function(e,t){for(let r of e)for(let e of r.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==r)throw r===t.op?new F(M.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new F(M.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}function uL(e,t){if(!(t instanceof ug||t instanceof uy))throw new F(M.INVALID_ARGUMENT,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function uM(e,t,r){return e?r&&(r.merge||r.mergeFields)?e.toFirestore(t,r):e.toFirestore(t):t}class uF extends ur{constructor(e){super(),this.firestore=e}convertBytes(e){return new lB(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new lk(this.firestore,null,t)}}function uV(e){return new uo("sum",l8("sum",e))}function uU(e){return new uo("avg",l8("average",e))}function uB(){return new uo("count")}function uq(e,t){return e instanceof uo&&t instanceof uo&&e.aggregateType===t.aggregateType&&e._internalFieldPath?.canonicalString()===t._internalFieldPath?.canonicalString()}function uj(e,t){return lN(e.query,t.query)&&(0,v.deepEqual)(e.data(),t.data())}function u$(e){return uz(e,{count:uB()})}function uz(e,t){var r;let n,i=eo(e.firestore,lM),s=lV(i),a=function(e,t){let r=[];for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.push(t(e[n],n,e));return r}(t,(e,t)=>new nH(t,e.aggregateType,e._internalFieldPath));return(r=e._query,n=new V,s.asyncQueue.enqueueAndForget(async()=>{try{let e=await lw(s);n.resolve(async function(e,t,r){let{request:n,gt:i,parent:s}=function(e,t,r,n){let{ft:i,parent:s}=iA(e,t),a={},o=[],l=0;return r.forEach(e=>{let t="aggregate_"+l++;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:ix(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:ix(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:i.structuredQuery},parent:i.parent},gt:a,parent:s}}(e.serializer,(t.Re||(t.Re=r7(t,t.explicitOrderBy)),t.Re),r);e.connection.Ko||delete n.parent;let a=(await e.jo("RunAggregationQuery",e.serializer.databaseId,s,n,1)).filter(e=>!!e.result);L(1===a.length,64727);let o=a[0].result?.aggregateFields;return Object.keys(o).reduce((e,t)=>(e[i[t]]=o[t],e),{})}(e,r,a))}catch(e){n.reject(e)}}),n.promise).then(t=>new ul(e,new un(i),t))}class uK{constructor(e){this.kind="memory",this._onlineComponentProvider=ln.provider,this._offlineComponentProvider=e?.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new le(void 0)}}toJSON(){return{kind:this.kind}}}class uG{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=u1(void 0))._initialize(e),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class uH{constructor(){this.kind="memoryEager",this._offlineComponentProvider=o9.provider}toJSON(){return{kind:this.kind}}}class uW{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new le(e)}}toJSON(){return{kind:this.kind}}}function uQ(){return new uH}function uJ(e){return new uW(e?.cacheSizeBytes)}function uY(e){return new uK(e)}function uX(e){return new uG(e)}class uZ{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=ln.provider,this._offlineComponentProvider={build:t=>new lt(t,e?.cacheSizeBytes,this.forceOwnership)}}}class u0{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=ln.provider,this._offlineComponentProvider={build:t=>new lr(t,e?.cacheSizeBytes)}}}function u1(e){return new uZ(e?.forceOwnership)}function u2(){return new u0}let u6="NOT SUPPORTED";class u3{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class u5 extends uu{constructor(e,t,r,n,i,s){super(e,t,r,n,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new u8(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(l8("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new F(M.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=u5._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()&&(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),this._firestore,this.ref.path,t.bundle="NOT SUPPORTED"),t}}function u4(e,t,r){if(eh(t,u5._jsonSchema)){var n;if(t.bundle===u6)throw new F(M.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=aO(e._databaseId),s=(n=t.bundle,new lo(n,i)),a=s.t(),o=new oI(s.getMetadata(),i);for(let e of a)o.o(e);let l=o.documents;if(1!==l.length)throw new F(M.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${l.length} documents.`);let u=iE(i,l[0].document),h=new en(ee.fromString(t.bundleName));return new u5(e,new uF(e),h,u,new u3(!1,!1),r||null)}}u5._jsonSchemaVersion="firestore/documentSnapshot/1.0",u5._jsonSchema={type:eu("string",u5._jsonSchemaVersion),bundleSource:eu("string","DocumentSnapshot"),bundleName:eu("string"),bundle:eu("string")};class u8 extends u5{data(e={}){return super.data(e)}}class u7{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new u3(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new u8(this._firestore,this._userDataWriter,r.key,r,new u3(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new F(M.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(r=>{let n=new u8(e._firestore,e._userDataWriter,r.doc.key,r.doc,new u3(e._snapshot.mutatedKeys.has(r.doc.key),e._snapshot.fromCache),e.query.converter);return r.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let n=new u8(e._firestore,e._userDataWriter,t.doc.key,t.doc,new u3(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(s=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return O(61501,{type:e})}}(t.type),doc:n,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new F(M.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=u7._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=H.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],n=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),r.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),n.push(e.ref.path))}),this._firestore,this.query._query,e.bundleName,e.bundle="NOT SUPPORTED",e}}function u9(e,t,r){if(eh(t,u7._jsonSchema)){var n;if(t.bundle===u6)throw new F(M.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=aO(e._databaseId),s=(n=t.bundle,new lo(n,i)),a=s.t(),o=new oI(s.getMetadata(),i);for(let e of a)o.o(e);if(1!==o.queries.length)throw new F(M.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);let l=ij(o.queries[0].bundledQuery),u=o.documents,h=new ol;u.map(e=>{let t=iE(i,e.document);h=h.add(t)});let c=oh.fromInitialDocuments(l,h,ng(),!1,!1),d=new lA(e,r||null,l);return new u7(e,new uF(e),d,c)}}function he(e,t){return e instanceof u5&&t instanceof u5?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof u7&&t instanceof u7&&e._firestore===t._firestore&&lN(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}u7._jsonSchemaVersion="firestore/querySnapshot/1.0",u7._jsonSchema={type:eu("string",u7._jsonSchemaVersion),bundleSource:eu("string","QuerySnapshot"),bundleName:eu("string"),bundle:eu("string")};let ht={maxAttempts:5};class hr{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=lY(e)}set(e,t,r){this._verifyNotCommitted();let n=hn(e,this._firestore),i=uM(n.converter,t,r),s=lX(this._dataReader,"WriteBatch.set",n._key,i,null!==n.converter,r);return this._mutations.push(s.toMutation(n._key,nN.none())),this}update(e,t,r,...n){let i;this._verifyNotCommitted();let s=hn(e,this._firestore);return i="string"==typeof(t=(0,v.getModularInstance)(t))||t instanceof lq?l1(this._dataReader,"WriteBatch.update",s._key,t,r,n):l0(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,nN.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=hn(e,this._firestore);return this._mutations=this._mutations.concat(new nj(t._key,nN.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new F(M.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function hn(e,t){if((e=(0,v.getModularInstance)(e)).firestore!==t)throw new F(M.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class hi{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=lY(e)}get(e){let t=hn(e,this._firestore),r=new uF(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return O(24041);let n=e[0];if(n.isFoundDocument())return new uu(this._firestore,r,n.key,n,t.converter);if(n.isNoDocument())return new uu(this._firestore,r,t._key,null,t.converter);throw O(18433,{doc:n})})}set(e,t,r){let n=hn(e,this._firestore),i=uM(n.converter,t,r),s=lX(this._dataReader,"Transaction.set",n._key,i,null!==n.converter,r);return this._transaction.set(n._key,s),this}update(e,t,r,...n){let i,s=hn(e,this._firestore);return i="string"==typeof(t=(0,v.getModularInstance)(t))||t instanceof lq?l1(this._dataReader,"Transaction.update",s._key,t,r,n):l0(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=hn(e,this._firestore);return this._transaction.delete(t._key),this}}class hs extends hi{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=hn(e,this._firestore),r=new un(this._firestore);return super.get(e).then(e=>new u5(this._firestore,r,t._key,e._document,new u3(!1,!1),t.converter))}}function ha(e,t,r){var n,i;let s;e=eo(e,lM);let a={...ht,...r};if(a.maxAttempts<1)throw new F(M.INVALID_ARGUMENT,"Max attempts must be at least 1");return n=lV(e),i=r=>t(new hs(e,r)),s=new V,n.asyncQueue.enqueueAndForget(async()=>{let e=await lw(n);new lu(n.asyncQueue,e,a,i,s).ju()}),s.promise}function ho(e){e=eo(e,lk);let t=eo(e.firestore,lM);return lb(lV(t),e._key).then(r=>h_(t,e,r))}function hl(e){var t;let r;e=eo(e,lk);let n=eo(e.firestore,lM),i=lV(n),s=new un(n);return(t=e._key,r=new V,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,r){try{let n=await e.persistence.runTransaction("read document","readonly",r=>e.localDocuments.getDocument(r,t));n.isFoundDocument()?r.resolve(n):n.isNoDocument()?r.resolve(null):r.reject(new F(M.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(n){let e=oo(n,`Failed to get document '${t} from cache`);r.reject(e)}})(await lm(i),t,r)),r.promise).then(t=>new u5(n,s,e._key,t,new u3(null!==t&&t.hasLocalMutations,!0),e.converter))}function hu(e){e=eo(e,lk);let t=eo(e.firestore,lM);return lb(lV(t),e._key,{source:"server"}).then(r=>h_(t,e,r))}function hh(e){e=eo(e,lA);let t=eo(e.firestore,lM),r=lV(t),n=new un(t);return uc(e._query),l_(r,e._query).then(r=>new u7(t,n,e,r))}function hc(e){var t;let r;e=eo(e,lA);let n=eo(e.firestore,lM),i=lV(n),s=new un(n);return(t=e._query,r=new V,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,r){try{let n=await s9(e,t,!0),i=new oC(t,n.ks),s=i.ru(n.documents),a=i.applyChanges(s,!1);r.resolve(a.snapshot)}catch(n){let e=oo(n,`Failed to execute query '${t} against cache`);r.reject(e)}})(await lm(i),t,r)),r.promise).then(t=>new u7(n,s,e,t))}function hd(e){e=eo(e,lA);let t=eo(e.firestore,lM),r=lV(t),n=new un(t);return l_(r,e._query,{source:"server"}).then(r=>new u7(t,n,e,r))}function hf(e,t,r){e=eo(e,lk);let n=eo(e.firestore,lM),i=uM(e.converter,t,r),s=lY(n);return hb(n,[lX(s,"setDoc",e._key,i,null!==e.converter,r).toMutation(e._key,nN.none())])}function hp(e,t,r,...n){e=eo(e,lk);let i=eo(e.firestore,lM),s=lY(i);return hb(i,[("string"==typeof(t=(0,v.getModularInstance)(t))||t instanceof lq?l1(s,"updateDoc",e._key,t,r,n):l0(s,"updateDoc",e._key,t)).toMutation(e._key,nN.exists(!0))])}function hg(e){return hb(eo(e.firestore,lM),[new nj(e._key,nN.none())])}function hm(e,t){let r=eo(e.firestore,lM),n=lD(e),i=uM(e.converter,t);return hb(r,[lX(lY(e.firestore),"addDoc",n._key,i,null!==e.converter,{}).toMutation(n._key,nN.exists(!1))]).then(()=>n)}function hy(e,...t){var r;let n,i,s,a,o;e=(0,v.getModularInstance)(e);let l={includeMetadataChanges:!1,source:"default"},u=0;"object"!=typeof t[0]||ua(t[u])||(l=t[u++]);let h={includeMetadataChanges:l.includeMetadataChanges,source:l.source};if(ua(t[u])){let e=t[u];t[u]=e.next?.bind(e),t[u+1]=e.error?.bind(e),t[u+2]=e.complete?.bind(e)}if(e instanceof lk)i=eo(e.firestore,lM),s=r6(e._key.path),n={next:r=>{t[u]&&t[u](h_(i,e,r))},error:t[u+1],complete:t[u+2]};else{let r=eo(e,lA);i=eo(r.firestore,lM),s=r._query;let a=new un(i);n={next:e=>{t[u]&&t[u](new u7(i,a,r,e))},error:t[u+1],complete:t[u+2]},uc(e._query)}return r=lV(i),o=new ov(s,a=new ls(n),h),r.asyncQueue.enqueueAndForget(async()=>op(await lv(r),o)),()=>{a.Nu(),r.asyncQueue.enqueueAndForget(async()=>og(await lv(r),o))}}function hw(e,t,...r){var n,i,s,a,o,l;let u=(0,v.getModularInstance)(e),h=function(e){let t={bundle:"",bundleName:"",bundleSource:""};for(let r of["bundle","bundleName","bundleSource"]){if(!(r in e)){t.error=`snapshotJson missing required field: ${r}`;break}let n=e[r];if("string"!=typeof n){t.error=`snapshotJson field '${r}' must be a string.`;break}if(0===n.length){t.error=`snapshotJson field '${r}' cannot be an empty string.`;break}"bundle"===r?t.bundle=n:"bundleName"===r?t.bundleName=n:"bundleSource"===r&&(t.bundleSource=n)}return t}(t);if(h.error)throw new F(M.INVALID_ARGUMENT,h.error);let c,d=0;if("object"!=typeof r[0]||ua(r[d])||(c=r[d++]),"QuerySnapshot"===h.bundleSource){let e,t,a=null;if("object"==typeof r[d]&&ua(r[d])){let e=r[d++];a={next:e.next,error:e.error,complete:e.complete}}else a={next:r[d++],error:r[d++],complete:r[d++]};return n=c,i=a,s=r[d],t=!1,lU(u,h.bundle).then(()=>{var e,t,r;return e=u,t=h.bundleName,(r=lV(e=eo(e,lM)),r.asyncQueue.enqueue(async()=>{var e;return e=await lm(r),e.persistence.runTransaction("Get named query","readonly",r=>e.Pi.getNamedQuery(r,t))})).then(t=>t?new lA(e,null,t.query):null)}).then(r=>{r&&!t&&(s&&r.withConverter(s),e=hy(r,n||{},i))}).catch(e=>(i.error&&i.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}if("DocumentSnapshot"===h.bundleSource){let e,t,n=null;if("object"==typeof r[d]&&ua(r[d])){let e=r[d++];n={next:e.next,error:e.error,complete:e.complete}}else n={next:r[d++],error:r[d++],complete:r[d++]};return a=c,o=n,l=r[d],t=!1,lU(u,h.bundle).then(()=>{t||(e=hy(new lk(u,l||null,en.fromPath(h.bundleName)),a||{},o))}).catch(e=>(o.error&&o.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}throw new F(M.INVALID_ARGUMENT,`unsupported bundle source: ${h.bundleSource}`)}function hv(e,t){let r,n=lV(e=eo(e,lM));return r=new ls(ua(t)?t:{next:t}),n.asyncQueue.enqueueAndForget(async()=>{var e;return e=await lv(n),void(e.Ca.add(r),r.next())}),()=>{r.Nu(),n.asyncQueue.enqueueAndForget(async()=>{var e;return e=await lv(n),void e.Ca.delete(r)})}}function hb(e,t){var r;let n;return r=lV(e),n=new V,r.asyncQueue.enqueueAndForget(async()=>oF(await ly(r),t,n)),n.promise}function h_(e,t,r){let n=r.docs.get(t._key),i=new un(e);return new u5(e,i,t._key,n,new u3(r.hasPendingWrites,r.fromCache),t.converter)}function hI(e){return lV(e=eo(e,lM)),new hr(e,t=>hb(e,t))}function hE(e,t){let r=lV(e=eo(e,lM));if(!r._uninitializedComponentsProvider||"memory"===r._uninitializedComponentsProvider._offline.kind)return N("Cannot enable indexes when persistence is disabled"),Promise.resolve();let n=function(e){let t="string"==typeof e?function(e){try{return JSON.parse(e)}catch(e){throw new F(M.INVALID_ARGUMENT,"Failed to parse JSON: "+e?.message)}}(e):e,r=[];if(Array.isArray(t.indexes))for(let e of t.indexes){let t=hT(e,"collectionGroup"),n=[];if(Array.isArray(e.fields))for(let t of e.fields){let e=l9("setIndexConfiguration",hT(t,"fieldPath"));"CONTAINS"===t.arrayConfig?n.push(new ey(e,2)):"ASCENDING"===t.order?n.push(new ey(e,0)):"DESCENDING"===t.order&&n.push(new ey(e,1))}r.push(new ef(ef.UNKNOWN_ID,t,n,ew.empty()))}return r}(t);return r.asyncQueue.enqueue(async()=>(async function(e,t){let r=e.indexManager,n=[];return e.persistence.runTransaction("Configure indexes","readwrite",e=>r.getFieldIndexes(e).next(i=>(function(e,t,r,n,i){t=[...t],(e=[...e]).sort(r),t.sort(r);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=r(e[l],t[o]);s<0?i(e[l++]):s>0?n(t[o++]):(o++,l++)}for(;o<a;)n(t[o++]);for(;l<s;)i(e[l++])})(i,t,em,t=>{n.push(r.addFieldIndex(e,t))},t=>{n.push(r.deleteFieldIndex(e,t))})).next(()=>eC.waitFor(n)))})(await lm(r),n))}function hT(e,t){if("string"!=typeof e[t])throw new F(M.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}class hS{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function hC(e){e=eo(e,lM);let t=hN.get(e);if(t)return t;let r=lV(e);if("persistent"!==r._uninitializedComponentsProvider?._offline.kind)return null;let n=new hS(e);return hN.set(e,n),n}function hA(e){hD(e,!0)}function hk(e){hD(e,!1)}function hx(e){var t;(t=lV(e._firestore)).asyncQueue.enqueue(async()=>{var e;let r;return r=(e=await lm(t)).indexManager,e.persistence.runTransaction("Delete All Indexes","readwrite",e=>r.deleteAllFieldIndexes(e))}).then(e=>x("deleting all persistent cache indexes succeeded")).catch(e=>N("deleting all persistent cache indexes failed",e))}function hD(e,t){var r;(r=lV(e._firestore),r.asyncQueue.enqueue(async()=>{var e;return e=await lm(r),void(e.Cs.As=t)})).then(e=>x(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>N(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}let hN=new WeakMap;class hR{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return hO.instance.onExistenceFilterMismatch(e)}}class hO{constructor(){this.i=new Map}static get instance(){return hP||function(e){if(nY)throw Error("a TestingHooksSpi instance is already set");nY=e}(hP=new hO),hP}u(e){this.i.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),r=this.i;return r.set(t,e),()=>r.delete(t)}}let hP=null;!function(e=!0){C=g.SDK_VERSION,(0,g._registerComponent)(new m.Component("firestore",(t,{instanceIdentifier:r,options:n})=>{let i=t.getProvider("app").getImmediate(),s=new lM(new j(t.getProvider("auth-internal")),new G(i,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new F(M.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new re(e.options.projectId,t)}(i,r),i);return n={useFetchStreams:e,...n},s._setSettings(n),s},"PUBLIC").setMultipleInstances(!0)),(0,g.registerVersion)(ui,us,void 0),(0,g.registerVersion)(ui,us,"esm2020")}(),e.s(["AggregateField",()=>uo,"AggregateQuerySnapshot",()=>ul,"DocumentSnapshot",()=>u5,"PersistentCacheIndexManager",()=>hS,"QueryCompositeFilterConstraint",()=>uy,"QueryConstraint",()=>uf,"QueryDocumentSnapshot",()=>u8,"QueryEndAtConstraint",()=>uk,"QueryFieldFilterConstraint",()=>ug,"QueryLimitConstraint",()=>uI,"QueryOrderByConstraint",()=>ub,"QuerySnapshot",()=>u7,"QueryStartAtConstraint",()=>uS,"SnapshotMetadata",()=>u3,"Transaction",()=>hs,"WriteBatch",()=>hr,"_TestingHooks",()=>hR,"addDoc",()=>hm,"aggregateFieldEqual",()=>uq,"aggregateQuerySnapshotEqual",()=>uj,"and",()=>uv,"average",()=>uU,"count",()=>uB,"deleteAllPersistentCacheIndexes",()=>hx,"deleteDoc",()=>hg,"disablePersistentCacheIndexAutoCreation",()=>hk,"documentSnapshotFromJSON",()=>u4,"enablePersistentCacheIndexAutoCreation",()=>hA,"endAt",()=>uD,"endBefore",()=>ux,"executeWrite",()=>hb,"getAggregateFromServer",()=>uz,"getCountFromServer",()=>u$,"getDoc",()=>ho,"getDocFromCache",()=>hl,"getDocFromServer",()=>hu,"getDocs",()=>hh,"getDocsFromCache",()=>hc,"getDocsFromServer",()=>hd,"getPersistentCacheIndexManager",()=>hC,"limit",()=>uE,"limitToLast",()=>uT,"memoryEagerGarbageCollector",()=>uQ,"memoryLocalCache",()=>uY,"memoryLruGarbageCollector",()=>uJ,"onSnapshot",()=>hy,"onSnapshotResume",()=>hw,"onSnapshotsInSync",()=>hv,"or",()=>uw,"orderBy",()=>u_,"persistentLocalCache",()=>uX,"persistentMultipleTabManager",()=>u2,"persistentSingleTabManager",()=>u1,"query",()=>up,"querySnapshotFromJSON",()=>u9,"runTransaction",()=>ha,"setDoc",()=>hf,"setIndexConfiguration",()=>hE,"snapshotEqual",()=>he,"startAfter",()=>uA,"startAt",()=>uC,"sum",()=>uV,"updateDoc",()=>hp,"where",()=>um,"writeBatch",()=>hI],63802),e.s([],36180),e.i(63802),e.s(["doc",()=>lD,"getDoc",()=>ho,"getFirestore",()=>lF,"setDoc",()=>hf,"updateDoc",()=>hp],98925)},67426,e=>{"use strict";let t,r,n,i;e.i(14539);var s,a,o,l,u=e.i(76510);e.i(51718);var h=e.i(18357);e.i(36180);var c=e.i(98925),d=e.i(92953),f=e.i(97427),p=e.i(8070);let g="firebasestorage.googleapis.com";class m extends f.FirebaseError{constructor(e,t,r=0){super(y(e),`Firebase Storage: ${t} (${y(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,m.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return y(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}function y(e){return"storage/"+e}function w(e){return new m(o.INVALID_ARGUMENT,e)}function v(){return new m(o.APP_DELETED,"The Firebase app was deleted.")}(s=o||(o={})).UNKNOWN="unknown",s.OBJECT_NOT_FOUND="object-not-found",s.BUCKET_NOT_FOUND="bucket-not-found",s.PROJECT_NOT_FOUND="project-not-found",s.QUOTA_EXCEEDED="quota-exceeded",s.UNAUTHENTICATED="unauthenticated",s.UNAUTHORIZED="unauthorized",s.UNAUTHORIZED_APP="unauthorized-app",s.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",s.INVALID_CHECKSUM="invalid-checksum",s.CANCELED="canceled",s.INVALID_EVENT_NAME="invalid-event-name",s.INVALID_URL="invalid-url",s.INVALID_DEFAULT_BUCKET="invalid-default-bucket",s.NO_DEFAULT_BUCKET="no-default-bucket",s.CANNOT_SLICE_BLOB="cannot-slice-blob",s.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",s.NO_DOWNLOAD_URL="no-download-url",s.INVALID_ARGUMENT="invalid-argument",s.INVALID_ARGUMENT_COUNT="invalid-argument-count",s.APP_DELETED="app-deleted",s.INVALID_ROOT_OPERATION="invalid-root-operation",s.INVALID_FORMAT="invalid-format",s.INTERNAL_ERROR="internal-error",s.UNSUPPORTED_ENVIRONMENT="unsupported-environment";class b{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=b.makeFromUrl(e,t)}catch(t){return new b(e,"")}if(""===r.path)return r;throw new m(o.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")}static makeFromUrl(e,t){let r=null,n="([A-Za-z0-9.\\-_]+)",i=RegExp("^gs://"+n+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}let a=t.replace(/[.]/g,"\\."),l=RegExp(`^https?://${a}/v[A-Za-z0-9_]+/b/${n}/o(/([^?#]*).*)?$`,"i"),u=t===g?"(?:storage.googleapis.com|storage.cloud.google.com)":t,h=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:l,indices:{bucket:1,path:3},postModify:s},{regex:RegExp(`^https?://${u}/${n}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let t=0;t<h.length;t++){let n=h[t],i=n.regex.exec(e);if(i){let e=i[n.indices.bucket],t=i[n.indices.path];t||(t=""),r=new b(e,t),n.postModify(r);break}}if(null==r)throw new m(o.INVALID_URL,"Invalid URL '"+e+"'.");return r}}class _{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function I(e,t,r,n){if(n<t)throw w(`Invalid value for '${e}'. Expected ${t} or greater.`);if(n>r)throw w(`Invalid value for '${e}'. Expected ${r} or less.`)}(a=l||(l={}))[a.NO_ERROR=0]="NO_ERROR",a[a.NETWORK_ERROR=1]="NETWORK_ERROR",a[a.ABORT=2]="ABORT";class E{constructor(e,t,r,n,i,s,a,o,l,u,h,c=!0,d=!1){this.url_=e,this.method_=t,this.headers_=r,this.body_=n,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=a,this.errorCallback_=o,this.timeout_=l,this.progressCallback_=u,this.connectionFactory_=h,this.retry=c,this.isUsingEmulator=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){let e=(e,t)=>{if(t)return void e(!1,new T(!1,null,!0));let r=this.connectionFactory_();this.pendingConnection_=r;let n=e=>{let t=e.loaded,r=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,r)};null!==this.progressCallback_&&r.addUploadProgressListener(n),r.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{var t;let i,s,a;null!==this.progressCallback_&&r.removeUploadProgressListener(n),this.pendingConnection_=null;let o=r.getErrorCode()===l.NO_ERROR,u=r.getStatus();!o||(t=this.additionalRetryCodes_,i=u>=500&&u<600,s=-1!==[408,429].indexOf(u),a=-1!==t.indexOf(u),(i||s||a)&&this.retry)?e(!1,new T(!1,null,r.getErrorCode()===l.ABORT)):e(!0,new T(-1!==this.successCodes_.indexOf(u),r))})},t=(e,t)=>{let r=this.resolve_,n=this.reject_,i=t.connection;if(t.wasSuccessCode)try{let e=this.callback_(i,i.getResponse());void 0!==e?r(e):r()}catch(e){n(e)}else if(null!==i){let e=new m(o.UNKNOWN,"An unknown error occurred, please check the error payload for server response.");e.serverResponse=i.getErrorText(),n(this.errorCallback_?this.errorCallback_(i,e):e)}else n(t.canceled?this.appDelete_?v():new m(o.CANCELED,"User canceled the upload/download."):new m(o.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))};this.canceled_?t(!1,new T(!1,null,!0)):this.backoffId_=function(e,t,r){let n=1,i=null,s=null,a=!1,o=0,l=!1;function u(...e){l||(l=!0,t.apply(null,e))}function h(t){i=setTimeout(()=>{i=null,e(d,2===o)},t)}function c(){s&&clearTimeout(s)}function d(e,...t){let r;if(l)return void c();if(e||2===o||a){c(),u.call(null,e,...t);return}n<64&&(n*=2),1===o?(o=2,r=0):r=(n+Math.random())*1e3,h(r)}let f=!1;function p(e){f||(f=!0,c(),!l&&(null!==i?(e||(o=2),clearTimeout(i),h(0)):e||(o=1)))}return h(0),s=setTimeout(()=>{a=!0,p(!0)},r),p}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class T{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}class S{constructor(e,t){this._service=e,t instanceof b?this._location=t:this._location=b.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new S(e,t)}get root(){let e=new b(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){var e;let t;return -1===(t=(e=this._location.path).lastIndexOf("/",e.length-2))?e:e.slice(t+1)}get storage(){return this._service}get parent(){let e=function(e){if(0===e.length)return null;let t=e.lastIndexOf("/");return -1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;let t=new b(this._location.bucket,e);return new S(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw new m(o.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}}function C(e,t){let r=t?.storageBucket;return null==r?null:b.makeFromBucketSpec(r,e)}class A{constructor(e,t,r,n,i,s=!1){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=n,this._firebaseVersion=i,this._isUsingEmulator=s,this._bucket=null,this._host=g,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,null!=n?this._bucket=b.makeFromBucketSpec(n,this._host):this._bucket=C(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=b.makeFromBucketSpec(this._url,e):this._bucket=C(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){I("time",0,1/0,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){I("time",0,1/0,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){if((0,d._isFirebaseServerApp)(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new S(this,e)}_makeRequest(e,t,r,n,i=!0){if(this._deleted)return new _(v());{let s=function(e,t,r,n,i,s,a=!0,o=!1){let l=function(e){let t=encodeURIComponent,r="?";for(let n in e)e.hasOwnProperty(n)&&(r=r+(t(n)+"=")+t(e[n])+"&");return r.slice(0,-1)}(e.urlParams),u=e.url+l,h=Object.assign({},e.headers);return t&&(h["X-Firebase-GMPID"]=t),null!==r&&r.length>0&&(h.Authorization="Firebase "+r),h["X-Firebase-Storage-Version"]="webjs/"+(s??"AppManager"),null!==n&&(h["X-Firebase-AppCheck"]=n),new E(u,e.method,h,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,a,o)}(e,this._appId,r,n,t,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(s),s.getPromise().then(()=>this._requests.delete(s),()=>this._requests.delete(s)),s}}async makeRequestWithTokens(e,t){let[r,n]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,n).getPromise()}}let k="@firebase/storage",x="0.14.0",D="storage";(0,d._registerComponent)(new p.Component(D,function(e,{instanceIdentifier:t}){return new A(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t,d.SDK_VERSION)},"PUBLIC").setMultipleInstances(!0)),(0,d.registerVersion)(k,x,""),(0,d.registerVersion)(k,x,"esm2020");var N=e.i(83877),R=e.i(44435);let O="@firebase/installations",P="0.6.19",L=`w:${P}`,M="FIS_v2",F=new f.ErrorFactory("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function V(e){return e instanceof f.FirebaseError&&e.code.includes("request-failed")}function U({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function B(e){return{token:e.token,requestStatus:2,expiresIn:Number(e.expiresIn.replace("s","000")),creationTime:Date.now()}}async function q(e,t){let r=(await t.json()).error;return F.create("request-failed",{requestName:e,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function j({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function $(e){let t=await e();return t.status>=500&&t.status<600?e():t}async function z({appConfig:e,heartbeatServiceProvider:t},{fid:r}){let n=U(e),i=j(e),s=t.getImmediate({optional:!0});if(s){let e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}let a={method:"POST",headers:i,body:JSON.stringify({fid:r,authVersion:M,appId:e.appId,sdkVersion:L})},o=await $(()=>fetch(n,a));if(o.ok){let e=await o.json();return{fid:e.fid||r,registrationStatus:2,refreshToken:e.refreshToken,authToken:B(e.authToken)}}throw await q("Create Installation",o)}function K(e){return new Promise(t=>{setTimeout(t,e)})}let G=/^[cdef][\w-]{21}$/;function H(e){return`${e.appName}!${e.appId}`}let W=new Map;function Q(e,t){var r,n;let i,s=H(e);J(s,t),r=s,n=t,(i=(!Y&&"BroadcastChannel"in self&&((Y=new BroadcastChannel("[Firebase] FID Change")).onmessage=e=>{J(e.data.key,e.data.fid)}),Y))&&i.postMessage({key:r,fid:n}),0===W.size&&Y&&(Y.close(),Y=null)}function J(e,t){let r=W.get(e);if(r)for(let e of r)e(t)}let Y=null,X="firebase-installations-store",Z=null;function ee(){return Z||(Z=(0,R.openDB)("firebase-installations-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(X)}})),Z}async function et(e,t){let r=H(e),n=(await ee()).transaction(X,"readwrite"),i=n.objectStore(X),s=await i.get(r);return await i.put(t,r),await n.done,s&&s.fid===t.fid||Q(e,t.fid),t}async function er(e){let t=H(e),r=(await ee()).transaction(X,"readwrite");await r.objectStore(X).delete(t),await r.done}async function en(e,t){let r=H(e),n=(await ee()).transaction(X,"readwrite"),i=n.objectStore(X),s=await i.get(r),a=t(s);return void 0===a?await i.delete(r):await i.put(a,r),await n.done,a&&(!s||s.fid!==a.fid)&&Q(e,a.fid),a}async function ei(e){let t,r=await en(e.appConfig,r=>{let n=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(F.create("app-offline"))};let r={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},n=es(e,r);return{installationEntry:r,registrationPromise:n}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:ea(e)}:{installationEntry:t}}(e,el(r||{fid:function(){try{var e;let t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;let r=(e=t,btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22));return G.test(r)?r:""}catch{return""}}(),registrationStatus:0}));return t=n.registrationPromise,n.installationEntry});return""===r.fid?{installationEntry:await t}:{installationEntry:r,registrationPromise:t}}async function es(e,t){try{let r=await z(e,t);return et(e.appConfig,r)}catch(r){throw V(r)&&409===r.customData.serverCode?await er(e.appConfig):await et(e.appConfig,{fid:t.fid,registrationStatus:0}),r}}async function ea(e){let t=await eo(e.appConfig);for(;1===t.registrationStatus;)await K(100),t=await eo(e.appConfig);if(0===t.registrationStatus){let{installationEntry:t,registrationPromise:r}=await ei(e);return r||t}return t}function eo(e){return en(e,e=>{if(!e)throw F.create("installation-not-found");return el(e)})}function el(e){var t;return 1===(t=e).registrationStatus&&t.registrationTime+1e4<Date.now()?{fid:e.fid,registrationStatus:0}:e}async function eu({appConfig:e,heartbeatServiceProvider:t},r){let n=function(e,{fid:t}){return`${U(e)}/${t}/authTokens:generate`}(e,r),i=function(e,{refreshToken:t}){var r;let n=j(e);return n.append("Authorization",(r=t,`${M} ${r}`)),n}(e,r),s=t.getImmediate({optional:!0});if(s){let e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}let a={method:"POST",headers:i,body:JSON.stringify({installation:{sdkVersion:L,appId:e.appId}})},o=await $(()=>fetch(n,a));if(o.ok)return B(await o.json());throw await q("Generate Auth Token",o)}async function eh(e,t=!1){let r,n=await en(e.appConfig,n=>{var i,s,a;let o;if(!ep(n))throw F.create("not-registered");let l=n.authToken;if(!t&&2===(i=l).requestStatus&&(s=i,!((o=Date.now())<s.creationTime)&&!(s.creationTime+s.expiresIn<o+36e5)))return n;if(1===l.requestStatus)return r=ec(e,t),n;{let t;if(!navigator.onLine)throw F.create("app-offline");let i=(a=n,t={requestStatus:1,requestTime:Date.now()},{...a,authToken:t});return r=ef(e,i),i}});return r?await r:n.authToken}async function ec(e,t){let r=await ed(e.appConfig);for(;1===r.authToken.requestStatus;)await K(100),r=await ed(e.appConfig);let n=r.authToken;return 0===n.requestStatus?eh(e,t):n}function ed(e){return en(e,e=>{var t;if(!ep(e))throw F.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+1e4<Date.now()?{...e,authToken:{requestStatus:0}}:e})}async function ef(e,t){try{let r=await eu(e,t),n={...t,authToken:r};return await et(e.appConfig,n),r}catch(r){if(V(r)&&(401===r.customData.serverCode||404===r.customData.serverCode))await er(e.appConfig);else{let r={...t,authToken:{requestStatus:0}};await et(e.appConfig,r)}throw r}}function ep(e){return void 0!==e&&2===e.registrationStatus}async function eg(e){let{installationEntry:t,registrationPromise:r}=await ei(e);return r?r.catch(console.error):eh(e).catch(console.error),t.fid}async function em(e,t=!1){return await ey(e),(await eh(e,t)).token}async function ey(e){let{registrationPromise:t}=await ei(e);t&&await t}function ew(e){return F.create("missing-app-config-values",{valueName:e})}let ev="installations";(0,d._registerComponent)(new p.Component(ev,e=>{let t=e.getProvider("app").getImmediate(),r=function(e){if(!e||!e.options)throw ew("App Configuration");if(!e.name)throw ew("App Name");for(let t of["projectId","apiKey","appId"])if(!e.options[t])throw ew(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t),n=(0,d._getProvider)(t,"heartbeat");return{app:t,appConfig:r,heartbeatServiceProvider:n,_delete:()=>Promise.resolve()}},"PUBLIC")),(0,d._registerComponent)(new p.Component("installations-internal",e=>{let t=e.getProvider("app").getImmediate(),r=(0,d._getProvider)(t,ev).getImmediate();return{getId:()=>eg(r),getToken:e=>em(r,e)}},"PRIVATE")),(0,d.registerVersion)(O,P),(0,d.registerVersion)(O,P,"esm2020");let eb="analytics",e_="https://www.googletagmanager.com/gtag/js",eI=new N.Logger("@firebase/analytics"),eE=new f.ErrorFactory("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function eT(e){if(!e.startsWith(e_)){let t=eE.create("invalid-gtag-resource",{gtagURL:e});return eI.warn(t.message),""}return e}function eS(e){return Promise.all(e.map(e=>e.catch(e=>e)))}async function eC(e,t,r,n,i,s){let a=n[i];try{if(a)await t[a];else{let e=(await eS(r)).find(e=>e.measurementId===i);e&&await t[e.appId]}}catch(e){eI.error(e)}e("config",i,s)}async function eA(e,t,r,n,i){try{let s=[];if(i&&i.send_to){let e=i.send_to;Array.isArray(e)||(e=[e]);let n=await eS(r);for(let r of e){let e=n.find(e=>e.measurementId===r),i=e&&t[e.appId];if(i)s.push(i);else{s=[];break}}}0===s.length&&(s=Object.values(t)),await Promise.all(s),e("event",n,i||{})}catch(e){eI.error(e)}}let ek=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};async function ex(e){let{appId:t,apiKey:r}=e,n={method:"GET",headers:new Headers({Accept:"application/json","x-goog-api-key":r})},i="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",t),s=await fetch(i,n);if(200!==s.status&&304!==s.status){let e="";try{let t=await s.json();t.error?.message&&(e=t.error.message)}catch(e){}throw eE.create("config-fetch-failed",{httpStatus:s.status,responseMessage:e})}return s.json()}async function eD(e,t=ek,r){let{appId:n,apiKey:i,measurementId:s}=e.options;if(!n)throw eE.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:n};throw eE.create("no-api-key")}let a=t.getThrottleMetadata(n)||{backoffCount:0,throttleEndTimeMillis:Date.now()},o=new eR;return setTimeout(async()=>{o.abort()},void 0!==r?r:6e4),eN({appId:n,apiKey:i,measurementId:s},a,o,t)}async function eN(e,{throttleEndTimeMillis:t,backoffCount:r},n,i=ek){let{appId:s,measurementId:a}=e;try{var o,l;await (o=n,l=t,new Promise((e,t)=>{let r=setTimeout(e,Math.max(l-Date.now(),0));o.addEventListener(()=>{clearTimeout(r),t(eE.create("fetch-throttle",{throttleEndTimeMillis:l}))})}))}catch(e){if(a)return eI.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${e?.message}]`),{appId:s,measurementId:a};throw e}try{let t=await ex(e);return i.deleteThrottleMetadata(s),t}catch(l){if(!function(e){if(!(e instanceof f.FirebaseError)||!e.customData)return!1;let t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(l)){if(i.deleteThrottleMetadata(s),a)return eI.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${l?.message}]`),{appId:s,measurementId:a};throw l}let t=503===Number(l?.customData?.httpStatus)?(0,f.calculateBackoffMillis)(r,i.intervalMillis,30):(0,f.calculateBackoffMillis)(r,i.intervalMillis),o={throttleEndTimeMillis:Date.now()+t,backoffCount:r+1};return i.setThrottleMetadata(s,o),eI.debug(`Calling attemptFetch again in ${t} millis`),eN(e,o,n,i)}}class eR{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function eO(e,t,r,n,i){if(i&&i.global)return void e("event",r,n);{let i=await t;e("event",r,{...n,send_to:i})}}async function eP(e,t,r,n){if(n&&n.global){let t={};for(let e of Object.keys(r))t[`user_properties.${e}`]=r[e];return e("set",t),Promise.resolve()}e("config",await t,{update:!0,user_properties:r})}async function eL(){if(!(0,f.isIndexedDBAvailable)())return eI.warn(eE.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await (0,f.validateIndexedDBOpenable)()}catch(e){return eI.warn(eE.create("indexeddb-unavailable",{errorInfo:e?.toString()}).message),!1}return!0}async function eM(e,n,i,s,a,o,l){var u,h;let c,d,f,p,g=eD(e);g.then(t=>{i[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&eI.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(e=>eI.error(e)),n.push(g);let m=eL().then(e=>e?s.getId():void 0),[y,w]=await Promise.all([g,m]);!function(e){for(let t of Object.values(window.document.getElementsByTagName("script")))if(t.src&&t.src.includes(e_)&&t.src.includes(e))return t;return null}(o)&&(u=y.measurementId,h={createScriptURL:eT},window.trustedTypes&&(c=window.trustedTypes.createPolicy("firebase-js-sdk-policy",h)),d=c,f=document.createElement("script"),p=`${e_}?l=${o}&id=${u}`,f.src=d?d?.createScriptURL(p):p,f.async=!0,document.head.appendChild(f)),r&&(a("consent","default",r),r=void 0),a("js",new Date);let v=l?.config??{};return v.origin="firebase",v.update=!0,null!=w&&(v.firebase_id=w),a("config",y.measurementId,v),t&&(a("set",t),t=void 0),y.measurementId}class eF{constructor(e){this.app=e}_delete(){return delete eV[this.app.options.appId],Promise.resolve()}}let eV={},eU=[],eB={},eq="dataLayer",ej=!1;async function e$(){if((0,f.isBrowserExtension)()||!(0,f.areCookiesEnabled)()||!(0,f.isIndexedDBAvailable)())return!1;try{return await (0,f.validateIndexedDBOpenable)()}catch(e){return!1}}let ez="@firebase/analytics",eK="0.10.19";(0,d._registerComponent)(new p.Component(eb,(e,{options:t})=>(function(e,t,r){let s=[];if((0,f.isBrowserExtension)()&&s.push("This is a browser extension environment."),(0,f.areCookiesEnabled)()||s.push("Cookies are not available."),s.length>0){let e=s.map((e,t)=>`(${t+1}) ${e}`).join(" "),t=eE.create("invalid-analytics-context",{errorInfo:e});eI.warn(t.message)}let a=e.options.appId;if(!a)throw eE.create("no-app-id");if(!e.options.apiKey)if(e.options.measurementId)eI.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw eE.create("no-api-key");if(null!=eV[a])throw eE.create("already-exists",{id:a});if(!ej){var o,l;let e,t;e=[],Array.isArray(window[eq])?e=window[eq]:window[eq]=e;let{wrappedGtag:r,gtagCore:s}=(o="gtag",t=function(){window[eq].push(arguments)},window[o]&&"function"==typeof window[o]&&(t=window[o]),window[o]=(l=t,async function(e,...t){try{if("event"===e){let[e,r]=t;await eA(l,eV,eU,e,r)}else if("config"===e){let[e,r]=t;await eC(l,eV,eU,eB,e,r)}else if("consent"===e){let[e,r]=t;l("consent",e,r)}else if("get"===e){let[e,r,n]=t;l("get",e,r,n)}else if("set"===e){let[e]=t;l("set",e)}else l(e,...t)}catch(e){eI.error(e)}}),{gtagCore:t,wrappedGtag:window[o]});i=r,n=s,ej=!0}return eV[a]=eM(e,eU,eB,t,n,eq,r),new eF(e)})(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t),"PUBLIC")),(0,d._registerComponent)(new p.Component("analytics-internal",function(e){try{let t=e.getProvider(eb).getImmediate();return{logEvent:(e,r,n)=>{var s;return s=t,void(s=(0,f.getModularInstance)(s),eO(i,eV[s.app.options.appId],e,r,n).catch(e=>eI.error(e)))},setUserProperties:(e,r)=>{var n;return n=t,void(n=(0,f.getModularInstance)(n),eP(i,eV[n.app.options.appId],e,r).catch(e=>eI.error(e)))}}}catch(e){throw eE.create("interop-component-reg-failed",{reason:e})}},"PRIVATE")),(0,d.registerVersion)(ez,eK),(0,d.registerVersion)(ez,eK,"esm2020");let eG=(0,u.getApps)().length?(0,u.getApp)():(0,u.initializeApp)({apiKey:"AIzaSyDgdSeApfy-CFiOCaQPnWdha50MJmARFFY",authDomain:"luxaarlearning.firebaseapp.com",projectId:"luxaarlearning",storageBucket:"luxaarlearning.firebasestorage.app",messagingSenderId:"961293373315",appId:"1:961293373315:web:c35162fdd80cdcad6fb0b6",measurementId:"G-0FLYPXNK9Y"}),eH=(0,h.getAuth)(eG),eW=(0,c.getFirestore)(eG);!function(e=(0,d.getApp)(),t){e=(0,f.getModularInstance)(e);let r=(0,d._getProvider)(e,D).getImmediate({identifier:void 0}),n=(0,f.getDefaultEmulatorHostnameAndPort)("storage");n&&function(e,t,r,n={}){!function(e,t,r,n={}){e.host=`${t}:${r}`;let i=(0,f.isCloudWorkstation)(t);i&&((0,f.pingServer)(`https://${e.host}/b`),(0,f.updateEmulatorBanner)("Storage",!0)),e._isUsingEmulator=!0,e._protocol=i?"https":"http";let{mockUserToken:s}=n;s&&(e._overrideAuthToken="string"==typeof s?s:(0,f.createMockUserToken)(s,e.app.options.projectId))}(e,t,r,n)}(r,...n)}(eG),new h.GoogleAuthProvider,new h.GithubAuthProvider;e$().then(e=>{e&&function(e=(0,d.getApp)()){e=(0,f.getModularInstance)(e);let t=(0,d._getProvider)(e,eb);t.isInitialized()?t.getImmediate():function(e,t={}){let r=(0,d._getProvider)(e,eb);if(r.isInitialized()){if(r.getImmediate(),(0,f.deepEqual)(t,r.getOptions()))return;throw eE.create("already-initialized")}r.initialize({options:t})}(e)}(eG)}),e.s(["auth",()=>eH,"db",()=>eW],67426)}]);